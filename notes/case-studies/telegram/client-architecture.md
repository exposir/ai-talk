# Telegram å®¢æˆ·ç«¯æ¶æ„æ·±åº¦è§£æ

> æ·±å…¥å‰–æ Telegram "æè‡´é€Ÿåº¦" èƒŒåçš„å·¥ç¨‹å®ç°

## 1. å·¥ç¨‹å“²å­¦ï¼šNative First

åœ¨ React Nativeã€Flutter ç­‰è·¨å¹³å°æ¡†æ¶ç››è¡Œçš„ä»Šå¤©ï¼ŒTelegram å§‹ç»ˆåšæŒ **"Native
First"ï¼ˆåŸç”Ÿä¼˜å…ˆï¼‰** çš„å·¥ç¨‹å“²å­¦ã€‚

**ä¸ºä»€ä¹ˆä¸é€‰æ‹©è·¨å¹³å°æ¡†æ¶ï¼Ÿ**

| è€ƒé‡ç»´åº¦     | Native å®ç°çš„ä¼˜åŠ¿                          | è·¨å¹³å°æ¡†æ¶çš„ç—›ç‚¹              |
| ------------ | ------------------------------------------ | ----------------------------- |
| **å¯åŠ¨é€Ÿåº¦** | æ¯«ç§’çº§å†·å¯åŠ¨                               | éœ€è¦åŠ è½½ JS Bundle æˆ– Dart VM |
| **æ»šåŠ¨æ€§èƒ½** | 60fps / 120fps ä¸èˆ¬é¡ºæ»‘                    | å¤æ‚åˆ—è¡¨å®¹æ˜“æ‰å¸§              |
| **å†…å­˜å ç”¨** | æä½ï¼ˆC++ æ ¸å¿ƒä¼˜åŒ–ï¼‰                       | è¾ƒé«˜ï¼Œæ˜“è§¦å‘ OOM              |
| **UI ç»†èŠ‚**  | å®Œç¾è´´åˆå¹³å°è§„èŒƒï¼ˆiOS æ¨¡ç³Šã€Android æ¶Ÿæ¼ªï¼‰ | éš¾ä»¥åšåˆ°åƒç´ çº§è¿˜åŸ            |
| **ç”µæ± ç»­èˆª** | é«˜æ•ˆåˆ©ç”¨ç¡¬ä»¶ç‰¹æ€§                           | CPU å ç”¨è¾ƒé«˜                  |

Telegram å›¢é˜Ÿè®¤ä¸ºï¼Œ**åªæœ‰æ¦¨å¹²æ¯ä¸ªå¹³å°çš„åŸç”Ÿç‰¹æ€§ï¼Œæ‰èƒ½æä¾›æè‡´çš„ç”¨æˆ·ä½“éªŒ**ã€‚

---

## 2. å®˜æ–¹å®¢æˆ·ç«¯æ¶æ„è¯¦è§£

Telegram çš„ä¸åŒå¹³å°å®¢æˆ·ç«¯å¹¶éç®€å•çš„ "æ¢çš®"ï¼Œè€Œæ˜¯é’ˆå¯¹è¯¥å¹³å°ç‰¹æ€§é‡æ–°è®¾è®¡çš„å·¥ç¨‹è‰ºæœ¯å“ã€‚

### ğŸ iOS (The Flagship)

iOS ç‰ˆé€šå¸¸è¢«è§†ä¸º Telegram çš„æ——èˆ°ä½“éªŒï¼Œå…¶æµç•…åº¦ä¸šç•Œé—»åã€‚

- **è¯­è¨€**ï¼šObjective-Cï¼ˆæ ¸å¿ƒå†å²ä»£ç ï¼‰+ Swiftï¼ˆæ–°åŠŸèƒ½ï¼‰
- **æ ¸å¿ƒç»„ä»¶**ï¼š
  - **MTProtoKit**ï¼šå®Œå…¨é‡å†™çš„ Objective-C ç½‘ç»œå±‚ï¼Œé TDLibã€‚ä¸“ä¸º iOS çš„åå°æœºåˆ¶å’Œç½‘ç»œç‰¹æ€§ä¼˜åŒ–ã€‚
  - **AsyncDisplayKit (Texture) çš„é­”æ”¹ç‰ˆ**ï¼š
    - Telegram å¹¶æœªç›´æ¥ä½¿ç”¨å®˜æ–¹ Textureï¼Œè€Œæ˜¯ç»´æŠ¤äº†ä¸€ä¸ª**æ·±åº¦å®šåˆ¶çš„åˆ†æ”¯**ã€‚
    - **æ ¸å¿ƒç²¾ç®€**ï¼šåªä¿ç•™äº†æ ¸å¿ƒçš„ Node ç³»ç»Ÿï¼ˆçº¦ 35% ä»£ç ï¼‰ï¼Œå»é™¤äº† Flexbox å¸ƒå±€å¼•æ“ã€Yoga å¼•æ“å’Œ ASTableNode ç­‰é‡é‡çº§ç»„ä»¶ã€‚
    - **æ‰‹åŠ¨å¸ƒå±€**ï¼šä¸ºäº†æè‡´æ€§èƒ½ï¼ŒTelegram æ‘’å¼ƒäº†è‡ªåŠ¨å¸ƒå±€ï¼Œå¤§é‡ä½¿ç”¨æ‰‹åŠ¨è®¡ç®— Frame çš„æ–¹å¼ï¼Œé…åˆ
      `asyncLayout` æ–¹æ³•åœ¨åå°çº¿ç¨‹é¢„è®¡ç®—å¸ƒå±€ã€‚
    - **åˆ—è¡¨å€’ç½®**ï¼šèŠå¤©åˆ—è¡¨é€šè¿‡æ—‹è½¬ 180Â° çš„ `ListView`
      å®ç°ï¼Œç”±åº•å‘ä¸Šæ’åˆ—ï¼Œç¡®ä¿æ–°æ¶ˆæ¯è‡ªç„¶å‡ºç°åœ¨åº•éƒ¨ã€‚
  - **æ¸²æŸ“ä¼˜åŒ–**ï¼šå¤§é‡çš„æ–‡æœ¬è®¡ç®—ã€å›¾ç‰‡è§£ç éƒ½åœ¨åå°çº¿ç¨‹å®Œæˆï¼Œä¸»çº¿ç¨‹ä»…è´Ÿè´£æäº¤æ¸²æŸ“æŒ‡ä»¤ã€‚

> **ğŸ”— æºç å‚è€ƒ**ï¼š[Telegram-iOS GitHub](https://github.com/TelegramMessenger/Telegram-iOS)
> | [Texture å®˜æ–¹æ–‡æ¡£](https://texturegroup.org/)

### ğŸ¤– Android (Official vs X)

Android ç”Ÿæ€å­˜åœ¨è‘—åçš„ "åŒå®¢æˆ·ç«¯" ç­–ç•¥ï¼Œå±•ç¤ºäº†ä¸¤ç§ä¸åŒçš„æ¶æ„æ€è·¯ã€‚

#### å®˜æ–¹ç‰ˆ (Telegram for Android)

- **å®šä½**ï¼šç¨³å®šã€å…¼å®¹æ€§å¥½ã€åŠŸèƒ½æœ€å…¨ã€‚
- **æ¶æ„**ï¼š
  - **è¯­è¨€**ï¼šJava (ä¸»è¦) + C++ (JNI)ã€‚
  - **æ ¸å¿ƒ**ï¼šç›´æ¥å®ç° MTProtoï¼ŒUI å±‚å¤§é‡ä½¿ç”¨è‡ªå®šä¹‰ Viewã€‚
  - **å¯å¤ç°æ„å»º (Reproducible Builds)**ï¼š
    - Telegram æ˜¯å°‘æ•°æ”¯æŒ Android å¯å¤ç°æ„å»ºçš„ä¸»æµ Appã€‚
    - ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Docker ç¯å¢ƒï¼ŒåŸºäºå…¬å¼€æºç ç¼–è¯‘å‡ºä¸ Google
      Play ä¸€æ¨¡ä¸€æ ·çš„ APKã€‚
    - éªŒè¯å·¥å…·ï¼š`apkdiff.py`
      å¯å¯¹æ¯”è‡ªç¼–è¯‘åŒ…ä¸å®˜æ–¹åŒ…çš„äºŒè¿›åˆ¶å·®å¼‚ï¼ˆé€šå¸¸ä»…ç­¾åä¸åŒï¼‰ã€‚

#### Telegram X

- **å®šä½**ï¼šå®éªŒæ€§ã€æ›´ç°ä»£ã€åŠ¨ç”»æ›´å¤šã€‚
- **æ¶æ„**ï¼š**åŸºäº TDLib**ã€‚
- **è®¾è®¡ç›®æ ‡**ï¼šéªŒè¯ TDLib åœ¨ Android ä¸Šçš„æ€§èƒ½ï¼Œå¹¶å°è¯•é€šè¿‡ C++ å…±äº«æ›´å¤šé€»è¾‘ã€‚
- **äº¤äº’**ï¼šæ‹¥æœ‰æ›´æµç•…çš„æ‰‹åŠ¿æ“ä½œå’Œå³æ—¶å¤œé—´æ¨¡å¼åˆ‡æ¢ã€‚

> **ğŸ”— æºç å‚è€ƒ**ï¼š[Telegram Android](https://github.com/DrKLO/Telegram) |
> [Reproducible Builds æŒ‡å—](https://core.telegram.org/reproducible-builds)

### ğŸŒ Web (K & Z)

Telegram Web ä¸ä»…ä»…æ˜¯ç½‘é¡µï¼Œæ›´æ˜¯ **WebAssembly (WASM)**
çš„æ•™ç§‘ä¹¦çº§åº”ç”¨ã€‚ç”±äºå†å²åŸå› ï¼ˆLightweight Client Contestï¼‰ï¼Œå­˜åœ¨ä¸¤ä¸ªå®˜æ–¹ç‰ˆæœ¬ã€‚

- **Web Z (Z ç‰ˆæœ¬)**ï¼š
  - **æ¡†æ¶**ï¼š**Teact**
    (è‡ªç ”çš„ç±» React æ¡†æ¶ï¼Œæ›´è½»é‡ï¼Œå»é™¤äº† React çš„å…¼å®¹æ€§åŒ…è¢±) + TypeScriptã€‚
  - **åè®®**ï¼šè‡ªå®šä¹‰ MTProto JS å®ç°ã€‚
- **Web K (K ç‰ˆæœ¬)**ï¼š
  - **æ¡†æ¶**ï¼šåŸç”Ÿ TypeScriptï¼Œæ— é‡å‹æ¡†æ¶ä¾èµ–ï¼Œæ¶æ„æ›´æ¥è¿‘ "Vanilla JS"ã€‚
- **WASM çš„æ·±åº¦åº”ç”¨**ï¼š
  - **åŠ å¯†è§£å¯†**ï¼šAES-IGEã€SHA-256 ç­‰é«˜é¢‘åŠ å¯†æ“ä½œç¼–è¯‘ä¸º WASM æ¨¡å—ï¼Œæ€§èƒ½æ¥è¿‘åŸç”Ÿä»£ç ã€‚
  - **åª’ä½“å¤„ç†**ï¼šOpus éŸ³é¢‘ç¼–ç å™¨ã€RLottie åŠ¨ç”»æ¸²æŸ“å™¨å‡è¿è¡Œåœ¨ WASM ä¸­ï¼Œè§£å†³äº† JS å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„æ€§èƒ½ç“¶é¢ˆã€‚

> **ğŸ”— æºç å‚è€ƒ**ï¼š[Web Z æºç ](https://github.com/Ajaxy/telegram-tt) |
> [Web K æºç ](https://github.com/morethanwords/tweb)

---

## 3. TDLibï¼šé€šç”¨å®¢æˆ·ç«¯å¼•æ“

**TDLib (Telegram Database Library)**
æ˜¯ Telegram å¼€æ”¾ç»™ç¬¬ä¸‰æ–¹å¼€å‘è€…çš„"æ ¸æ­¦å™¨"ã€‚å®ƒå°†å¤æ‚çš„ MTProto åè®®ã€æœ¬åœ°å­˜å‚¨ã€ç½‘ç»œåŒæ­¥å°è£…æˆäº†ä¸€ä¸ªé»‘ç›’ã€‚

### æ¶æ„å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Third-Party Client UI            â”‚
â”‚         (Swift / Kotlin / JS / Python)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ JSON / TL-Object Interface
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      TDLib (C++)         â”‚
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚ â”‚    Actor Model       â”‚ â”‚  â† æ ¸å¿ƒå¹¶å‘æ¨¡å‹
          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â”‚            â”‚             â”‚
          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚ â”‚NetQueryâ”‚  â”‚ â”‚SQLite3 â”‚ â”‚  â† æœ¬åœ°æ•°æ®åº“
          â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚
          â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
                 â”‚     â”‚       â”‚
        MTProto  â–¼     â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           Telegram Cloud              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡ï¼šActor Model

TDLib çš„é«˜æ€§èƒ½æºäºå…¶å†…éƒ¨å®ç°çš„ **Actor å¹¶å‘æ¨¡å‹**ï¼š

1.  **æ— é”å¹¶å‘**ï¼šæ¯ä¸ª Actor éƒ½æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œå•å…ƒï¼Œæ‹¥æœ‰ç§æœ‰çŠ¶æ€ã€‚Actor ä¹‹é—´**ç»ä¸å…±äº«å†…å­˜**ï¼Œåªé€šè¿‡æ¶ˆæ¯ä¼ é€’äº¤äº’ã€‚
2.  **é¿å…æ­»é”**ï¼šç”±äºæ¶ˆé™¤äº†å…±äº«çŠ¶æ€å’Œé”ç«äº‰ï¼ŒTDLib å‡ ä¹å½»åº•æœç»äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¸¸è§çš„æ­»é”é—®é¢˜ã€‚
3.  **é«˜ååé‡**ï¼šè¿™ç§æ¨¡å‹éå¸¸é€‚åˆå¤„ç†å¤§é‡çš„å¹¶å‘ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚åŒæ—¶åŠ è½½æˆç™¾ä¸Šåƒä¸ªèŠå¤©ä¼šè¯ï¼‰ã€‚

### å¼€å‘è€…æ¥å£

TDLib å¯¹å¤–æš´éœ²æå…¶ç®€å•çš„æ¥å£ï¼Œç±»ä¼¼äº Redux çš„å•å‘æ•°æ®æµï¼š

- **`send(function)`**ï¼šå‘é€è¯·æ±‚ï¼ˆå¦‚ `sendMessage`, `getChats`ï¼‰ã€‚
- **`receive()`**ï¼šè½®è¯¢è·å–æ›´æ–°ï¼ˆUpdatesï¼‰ï¼Œæ‰€æœ‰æ•°æ®å˜æ›´ï¼ˆæ–°æ¶ˆæ¯ã€ç”¨æˆ·ä¸Šçº¿ï¼‰éƒ½é€šè¿‡æ­¤æ¥å£å¼‚æ­¥æ¨é€ã€‚

> **ğŸ”— å®˜æ–¹æ–‡æ¡£**ï¼š[TDLib æ ¸å¿ƒæ¦‚å¿µ](https://core.telegram.org/tdlib) |
> [GitHub ä»“åº“](https://github.com/tdlib/td)

---

## 4. æ€»ç»“ï¼šTelegram çš„å·¥ç¨‹å¯ç¤º

1.  **æŒæ§æ ¸å¿ƒæŠ€æœ¯æ ˆ**ï¼šä¸ºäº†æè‡´ä½“éªŒï¼Œä¸æƒœç»´æŠ¤å®šåˆ¶ç‰ˆçš„ UI æ¡†æ¶ï¼ˆiOS
    Texture æ”¹ç‰ˆï¼‰å’Œ Web æ¡†æ¶ï¼ˆTeactï¼‰ã€‚
2.  **æ€§èƒ½è‡³ä¸Š**ï¼šå°†ç¹é‡çš„è®¡ç®—ï¼ˆåŠ å¯†ã€å¸ƒå±€ã€åª’ä½“å¤„ç†ï¼‰ä»ä¸»çº¿ç¨‹å‰¥ç¦»ï¼Œåˆ©ç”¨ C++ /
    WASM / Background Threads è§£å†³ã€‚
3.  **å¼€æ”¾ä¸é€æ˜**ï¼šé€šè¿‡å¼€æºå®¢æˆ·ç«¯ä»£ç å’Œæ”¯æŒå¯å¤ç°æ„å»ºï¼Œå»ºç«‹äº†æé«˜çš„å®‰å…¨ä¿¡ä»»åº¦ã€‚

---

## å‚è€ƒæ–‡çŒ®ä¸é“¾æ¥

- **å®˜æ–¹èµ„æº**
  - [Telegram Apps Source Code](https://telegram.org/apps#source-code)
  - [Reproducible Builds for Android](https://core.telegram.org/reproducible-builds)
  - [TDLib - Telegram Database Library](https://core.telegram.org/tdlib)

- **æŠ€æœ¯åˆ†æ**
  - [AsyncDisplayKit (Texture) å®˜æ–¹æ–‡æ¡£](https://texturegroup.org/)
  - [Telegram iOS æ¶æ„åˆ†æ (Hubo.dev)](https://hubo.dev/blog/telegram-ios-architecture/)
  - [Citizen Lab å¯¹å¾®ä¿¡å®‰å…¨æ€§çš„åˆ†æ (ä½œä¸ºå¯¹æ¯”å‚è€ƒ)](https://citizenlab.ca/2020/05/wechat-surveillance-explained/)
