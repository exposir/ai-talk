# å‰ç«¯çŠ¶æ€ç®¡ç†åº“æ·±åº¦åˆ†æä¸â€œå¥‡ç‚¹â€æ„æƒ³

> å›é¡¾äººç±»æ‰€æœ‰ä»£ç åº“ï¼Œå‰ç«¯é¢†åŸŸçš„çŠ¶æ€ç®¡ç†ä»æ¥æ²¡æœ‰"å®Œç¾"çš„æ–¹æ¡ˆã€‚è¿™ä»½æ–‡æ¡£åˆ†æäº†ç°æœ‰æ–¹æ¡ˆçš„æ ¸å¿ƒé—®é¢˜ï¼Œå¹¶æ¢è®¨â€œå¥‡ç‚¹â€çŠ¶æ€ç®¡ç†ç³»ç»Ÿçš„è®¾è®¡æ€è·¯ã€‚

---

## é›¶ã€çŠ¶æ€ç®¡ç†åº“å…¨æ™¯å›¾

| æ´¾ç³»                | åº“              | ä½œè€…/ç»„ç»‡                | Stars  | æ ¸å¿ƒæ€æƒ³                    | è¶…å¤§å‹é¡¹ç›®é€‚é… |
| :------------------ | :-------------- | :----------------------- | :----- | :-------------------------- | :------------- |
| **Flux æ¶æ„æ´¾**     | Redux           | Dan Abramov / Redux Team | â­ 60k | å•ä¸€æ•°æ®æº + çº¯å‡½æ•° Reducer | ä¹…ç»è€ƒéªŒ       |
|                     | Redux Toolkit   | Redux Team               | â­ 10k | Redux å®˜æ–¹ç®€åŒ–ç‰ˆ            | æ¨è           |
|                     | Zustand         | Pmndrs (Dai Shi)         | â­ 40k | æç®€ Fluxï¼Œæ—  Provider      | é…åˆåˆ†å±‚æ¶æ„   |
| **åŸå­åŒ–æ´¾**        | Jotai           | Pmndrs (Dai Shi)         | â­ 17k | è‡ªåº•å‘ä¸Šçš„åŸå­ç»„åˆ          | éœ€è§„èŒƒçº¦æŸ     |
|                     | Recoil âš ï¸       | Meta (Facebook)          | â­ 19k | å·²åœæ­¢ç»´æŠ¤                  | ä¸æ¨è         |
|                     | Nano Stores     | Evil Martians            | â­ 5k  | æ¡†æ¶æ— å…³ï¼Œ< 1KB             | åŠŸèƒ½æœ‰é™       |
| **Proxy å“åº”å¼æ´¾**  | MobX            | Michel Weststrate        | â­ 27k | é€æ˜å‡½æ•°å¼å“åº”ç¼–ç¨‹          | éšå¼ä¾èµ–éš¾è¿½è¸ª |
|                     | MobX-State-Tree | Michel Weststrate        | â­ 7k  | ç»“æ„åŒ–ç±»å‹ + å¿«ç…§           | ä¸“ä¸ºå¤æ‚åœºæ™¯   |
|                     | Valtio          | Pmndrs (Dai Shi)         | â­ 9k  | åƒ Vue ä¸€æ ·å¯å˜             | ä¸­å°å‹æ›´é€‚åˆ   |
| **Signal ç»†ç²’åº¦æ´¾** | Preact Signals  | Preact Team              | â­ 4k  | ç»•è¿‡ VDOM Diff              | ç”Ÿæ€ä¸æˆç†Ÿ     |
|                     | Legend-State    | Legend App               | â­ 3k  | å¼ºè°ƒæ€§èƒ½ä¼˜åŠ¿                | ç¤¾åŒºè¾ƒå°       |
|                     | Solid.js        | Ryan Carniato            | â­ 30k | ç¼–è¯‘æ—¶ + æ—  VDOM            | æ¡†æ¶çº§æ–¹æ¡ˆ     |
| **çŠ¶æ€æœºæ´¾**        | XState          | Stately (D. Khourshid)   | â­ 26k | W3C SCXML æ ‡å‡†å®ç° [^1]     | å…³é”®ä¸šåŠ¡é¦–é€‰   |
|                     | Robot           | Matthew Phillips         | â­ 2k  | æç®€ FSMï¼Œ< 1KB             | åŠŸèƒ½å¤ªç®€       |
| **æœåŠ¡ç«¯çŠ¶æ€æ´¾**    | TanStack Query  | Tanner Linsley           | â­ 40k | æœåŠ¡ç«¯çŠ¶æ€ = ç¼“å­˜           | å¿…å¤‡ç»„ä»¶       |
|                     | SWR             | Vercel                   | â­ 30k | Stale-While-Revalidate      | åŠŸèƒ½è¾ƒå°‘       |
|                     | RTK Query       | Redux Team               | -      | Redux ç”Ÿæ€æ–¹æ¡ˆ              | Redux é¡¹ç›®é¦–é€‰ |
| **RxJS æµå¼æ´¾**     | RxJS            | ReactiveX / Ben Lesh     | â­ 30k | ä¸€åˆ‡çš†æµ                    | å¤æ‚å¼‚æ­¥å¿…å¤‡   |
|                     | Elf             | ngneat                   | â­ 2k  | åŸºäº RxJS çš„ Store          | ç¤¾åŒºè¾ƒå°       |
|                     | Akita           | Datorama                 | â­ 4k  | å®ä½“ç®¡ç†                    | Angular å¤§å‹   |
| **CRDT åä½œæ´¾**     | Yjs             | Kevin Jahns              | â­ 15k | æ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹          | åä½œåœºæ™¯å”¯ä¸€   |
|                     | Automerge       | Ink & Switch             | â­ 3k  | JSON å‹å¥½ CRDT              | æ€§èƒ½ç•¥é€Š       |
|                     | Liveblocks      | Liveblocks Inc.          | -      | CRDT + BaaS                 | å¼€ç®±å³ç”¨       |
| **GraphQL æ´¾**      | Apollo Client   | Apollo GraphQL           | â­ 19k | å½’ä¸€åŒ–ç¼“å­˜                  | GraphQL æ ‡é…   |
|                     | Relay           | Meta (Facebook)          | â­ 18k | ç¼–è¯‘æœŸä¼˜åŒ–                  | Facebook çº§åˆ«  |
|                     | URQL            | urql-graphql             | â­ 9k  | è½»é‡çº§ GraphQL              | ä¸­å‹é¡¹ç›®       |
| **å…¶ä»–ç‰¹è‰²**        | Effector        | Dmitry Boldyrev          | â­ 5k  | å¤šå‘æ•°æ®æµ                  | ç±»å‹å®Œç¾       |
|                     | Hookstate       | Andrey Konstantinov      | â­ 2k  | Proxy + Hook æç®€           | ä¸­å°å‹         |
|                     | Overmind        | Cerebral                 | â­ 1k  | Flux + FSM + Proxy èåˆ     | ç¤¾åŒºä¸æ´»è·ƒ     |
| **é¢†åŸŸä¸“ç”¨**        | React Hook Form | Bill Luo                 | â­ 40k | è¡¨å•çŠ¶æ€                    | è¡¨å•å¿…å¤‡       |
|                     | TanStack Router | Tanner Linsley           | â­ 7k  | URL å³çŠ¶æ€                  | ç±»å‹å®‰å…¨è·¯ç”±   |
|                     | TanStack Table  | Tanner Linsley           | â­ 24k | è¡¨æ ¼çŠ¶æ€                    | å¤æ‚è¡¨æ ¼å¿…å¤‡   |
|                     | RxDB / Dexie    | D. Meyer / D. Fahlander  | -      | æœ¬åœ°æ•°æ®åº“                  | ç¦»çº¿ä¼˜å…ˆåœºæ™¯   |

> **è¯´æ˜**:
> Stars æ•°æ®ä¸º 2026 å¹´ 1 æœˆç²—ç•¥é‡çº§ï¼›è¶…å¤§å‹é¡¹ç›®é€‚é…åŸºäºç¤¾åŒºå®è·µç»éªŒè¯„ä¼°ã€‚åº“åç§°é“¾æ¥å·²çœç•¥ä»¥æå‡è¡¨æ ¼å¯è¯»æ€§ï¼Œè¯¦è§åç»­å„ç« èŠ‚çš„è¯¦ç»†ä»‹ç»ã€‚

### å¿«é€Ÿé€‰æ‹©æŒ‡å—

| åœºæ™¯               | æ¨èæ–¹æ¡ˆ              | ç†ç”±                   |
| :----------------- | :-------------------- | :--------------------- |
| **ç®€å•é¡¹ç›®**       | Zustand               | æç®€ APIï¼Œ< 1KB        |
| **å¤§å‹ä¼ä¸šåº”ç”¨**   | Zustand + React Query | å®¢æˆ·ç«¯/æœåŠ¡ç«¯åˆ†ç¦»      |
| **å¤æ‚äº¤äº’é€»è¾‘**   | XState                | çŠ¶æ€æœºå¯è§†åŒ–ã€æ•°å­¦è¯æ˜ |
| **æè‡´æ€§èƒ½**       | Legend-State / Jotai  | Signal ç»†ç²’åº¦æ›´æ–°      |
| **å¤šäººåä½œ**       | Yjs + Liveblocks      | CRDT å†²çªè‡ªåŠ¨è§£å†³      |
| **GraphQL é¡¹ç›®**   | Apollo / URQL         | å½’ä¸€åŒ–ç¼“å­˜             |
| **Redux é—ç•™é¡¹ç›®** | Redux Toolkit         | å®˜æ–¹ç°ä»£åŒ–æ–¹æ¡ˆ         |

### è§„æ¨¡é€‚é…è¯„ä¼°ç»´åº¦

| ç»´åº¦         | å…³æ³¨ç‚¹                       | å°å‹é¡¹ç›®åå¥½   | è¶…å¤§å‹é¡¹ç›®åå¥½                |
| :----------- | :--------------------------- | :------------- | :---------------------------- |
| **å¿ƒæ™ºæ¨¡å‹** | éœ€è¦æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µæ•°é‡       | æ¦‚å¿µå°‘ã€ä¸Šæ‰‹å¿« | æ¦‚å¿µå¯åˆ†å±‚ã€å¯æ¸è¿›å¼•å…¥        |
| **å¯è§‚æµ‹æ€§** | è°ƒè¯•/æ—¶é—´æ—…è¡Œ/çŠ¶æ€å¯è§†åŒ–     | ç®€æ´æ—¥å¿—å³å¯   | DevTools å®Œæ•´ã€å®¡è®¡èƒ½åŠ›å¼º     |
| **ä¸€è‡´æ€§**   | æœ¬åœ°/æœåŠ¡ç«¯/åä½œçŠ¶æ€èƒ½å¦ç»Ÿä¸€ | å…è®¸å¤šåº“ç»„åˆ   | å•ä¸€æ¨¡å‹æˆ–ä½æ‘©æ“¦æ•´åˆ          |
| **è¿ç§»æˆæœ¬** | ä»ç°æœ‰æ–¹æ¡ˆè¿ç§»çš„é—¨æ§›         | ç›´æ¥æ›¿æ¢ Hook  | å¯å¢é‡æ¥å…¥ã€æ”¯æŒåˆ†å±‚/åˆ†åŸŸè¿ç§» |
| **æ€§èƒ½æ¨¡å‹** | æ¸²æŸ“/è®¢é˜…å¼€é”€æ˜¯å¦å¯é¢„æµ‹      | é»˜è®¤å¤Ÿå¿«       | ç»†ç²’åº¦è®¢é˜…ã€å¯æ§æ›´æ–°è¾¹ç•Œ      |
| **ç»„ç»‡åä½œ** | å¤šå›¢é˜Ÿåä½œã€è¾¹ç•Œåˆ’åˆ†ã€è§„èŒƒåŒ– | è½»è§„èŒƒ         | çº¦å®šæ¸…æ™°ã€å·¥å…·é“¾é…å¥—          |

[^1]:
    **ä»€ä¹ˆæ˜¯çŠ¶æ€æœºï¼Ÿ**
    çŠ¶æ€æœº (FSM) æ˜¯æŒ‡"ç³»ç»Ÿåªèƒ½å¤„äºæœ‰é™ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼Œé€šè¿‡äº‹ä»¶è§¦å‘çŠ¶æ€è½¬æ¢"çš„æ¨¡å‹ã€‚ä¾‹å¦‚äº¤é€šç¯åªèƒ½æ˜¯çº¢/é»„/ç»¿ä¸‰ä¸ªçŠ¶æ€ï¼ŒæŒ‰å›ºå®šè§„åˆ™åˆ‡æ¢ã€‚**ä¸ºä»€ä¹ˆå‰ç«¯å°‘è§ï¼Ÿ**
    å‰ç«¯ä» jQuery è„šæœ¬å‘å±•è€Œæ¥ï¼Œä¹ æƒ¯ç”¨ `isLoading/isError`
    ç­‰å¸ƒå°”å€¼ç»„åˆè¡¨ç¤ºçŠ¶æ€ï¼Œä½†è¿™ä¼šäº§ç”Ÿ"ä¸å¯èƒ½çŠ¶æ€"çš„ Bugï¼ˆå¦‚
    `isLoading=true && isError=true`
    åŒæ—¶ä¸ºçœŸï¼‰ã€‚çŠ¶æ€æœºå¼ºåˆ¶ä½ æ˜¾å¼å®šä¹‰æ‰€æœ‰åˆæ³•çŠ¶æ€å’Œè½¬æ¢è§„åˆ™ï¼Œä»æ ¹æœ¬ä¸Šæ¶ˆé™¤è¿™ç±»é—®é¢˜ã€‚**SCXML**
    æ˜¯ W3C åˆ¶å®šçš„çŠ¶æ€æœºæè¿°æ ‡å‡†ï¼Œæºäº 1987 å¹´ David
    Harel çš„ Statecharts è®ºæ–‡ï¼ŒXState ä¸¥æ ¼éµå¾ªæ­¤è§„èŒƒå®ç°ã€‚

---

## ä¸€ã€å‰ç«¯çŠ¶æ€ç®¡ç†åº“å¤§å…¨ï¼šå®ç°åŸç†ä¸æ ¸å¿ƒæ€æƒ³

> å¯¼è¯»ï¼šæŒ‰èŒƒå¼åˆ†ç±»æ¢³ç†å®ç°åŸç†ï¼Œå»ºç«‹å…¨å±€è®¤çŸ¥ä¸å¯¹æ¯”æ¡†æ¶ã€‚

> æœ¬ç« èŠ‚æ”¶å½•äº†å‰ç«¯ç”Ÿæ€ä¸­**æ‰€æœ‰ä¸»æµåŠå°ä¼—**çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼ŒæŒ‰æŠ€æœ¯èŒƒå¼åˆ†ç±»ï¼Œæ·±å…¥è§£ææ¯ä¸ªåº“çš„åº•å±‚å®ç°å’Œè®¾è®¡å“²å­¦ã€‚

---

### 1.1 Flux æ¶æ„æ´¾ç³»

#### Redux (2015)

| ç»´åº¦         | å†…å®¹                                                                                                       |
| :----------- | :--------------------------------------------------------------------------------------------------------- |
| **GitHub**   | [reduxjs/redux](https://github.com/reduxjs/redux) â­ 60k+                                                  |
| **æ ¸å¿ƒæ€æƒ³** | å•ä¸€æ•°æ®æº + çº¯å‡½æ•° Reducer + ä¸å¯å˜æ›´æ–°                                                                   |
| **å®ç°åŸç†** | åŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚Store æŒæœ‰å…¨å±€çŠ¶æ€æ ‘ï¼Œé€šè¿‡ `dispatch(action)` è§¦å‘ Reducer è®¡ç®—æ–°çŠ¶æ€ï¼Œå†é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… |
| **æ•°æ®æµ**   | `View â†’ dispatch(Action) â†’ Reducer(state, action) â†’ newState â†’ View`                                       |
| **ä¼˜ç‚¹**     | å¯é¢„æµ‹æ€§å¼ºã€æ—¶é—´æ—…è¡Œè°ƒè¯•ã€ä¸­é—´ä»¶ç”Ÿæ€ä¸°å¯Œ                                                                   |
| **ç¼ºç‚¹**     | æ ·æ¿ä»£ç å¤šã€å­¦ä¹ æ›²çº¿é™¡ã€å°é¡¹ç›®è¿‡åº¦è®¾è®¡                                                                     |

```javascript
// Redux æ ¸å¿ƒåŸç†ç®€åŒ–å®ç°
function createStore(reducer) {
  let state;
  let listeners = [];

  const getState = () => state;
  const dispatch = (action) => {
    state = reducer(state, action); // çº¯å‡½æ•°è®¡ç®—æ–°çŠ¶æ€
    listeners.forEach((l) => l()); // é€šçŸ¥è®¢é˜…è€…
  };
  const subscribe = (listener) => {
    listeners.push(listener);
    return () => {
      listeners = listeners.filter((l) => l !== listener);
    };
  };

  dispatch({ type: '@@INIT' });
  return { getState, dispatch, subscribe };
}
```

---

#### Redux Toolkit (RTK)

| ç»´åº¦         | å†…å®¹                                                                                     |
| :----------- | :--------------------------------------------------------------------------------------- |
| **GitHub**   | [reduxjs/redux-toolkit](https://github.com/reduxjs/redux-toolkit) â­ 10k+                |
| **æ ¸å¿ƒæ€æƒ³** | Redux å®˜æ–¹"ç”µæ± å…¨åŒ…"ç‰ˆï¼Œå†…ç½® Immer + Thunk + DevTools                                    |
| **å®ç°åŸç†** | åœ¨ Redux åŸºç¡€ä¸Šï¼Œ`createSlice` è‡ªåŠ¨ç”Ÿæˆ action creators å’Œ reducerï¼ŒImmer å…è®¸"å¯å˜"å†™æ³• |
| **ä¼˜ç‚¹**     | å¤§å¹…å‡å°‘æ ·æ¿ä»£ç ã€TypeScript å‹å¥½                                                        |
| **ç¼ºç‚¹**     | ä»ç»§æ‰¿ Redux çš„å¤æ‚å¿ƒæ™ºæ¨¡å‹                                                              |

```javascript
// RTK çš„ createSlice åº•å±‚ç”¨ Immer åŒ…è£…
const slice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    // çœ‹èµ·æ¥æ˜¯å¯å˜æ“ä½œï¼Œå®é™… Immer è½¬ä¸ºä¸å¯å˜
    increment: (state) => {
      state.value += 1;
    },
  },
});
```

---

#### Zustand (Pmndrs, 2019)

| ç»´åº¦         | å†…å®¹                                                                                  |
| :----------- | :------------------------------------------------------------------------------------ |
| **GitHub**   | [pmndrs/zustand](https://github.com/pmndrs/zustand) â­ 40k+                           |
| **æ ¸å¿ƒæ€æƒ³** | æç®€ Fluxï¼Œå»æ‰ Redux çš„æ‰€æœ‰ä»ªå¼æ„Ÿ                                                    |
| **å®ç°åŸç†** | åŸºäºé—­åŒ…çš„å‘å¸ƒ-è®¢é˜…ã€‚ç”¨ `useSyncExternalStore` ä¸ React åŒæ­¥ï¼ŒSelector å®ç°ç»†ç²’åº¦è®¢é˜… |
| **ä¼˜ç‚¹**     | API æç®€ (< 1KB)ã€æ—  Providerã€æ”¯æŒä¸­é—´ä»¶                                             |
| **ç¼ºç‚¹**     | æ²¡æœ‰å†…ç½®çš„ action ç±»å‹çº¦æŸ                                                            |

```javascript
// Zustand æ ¸å¿ƒå®ç° (ç®€åŒ–)
const createStore = (createState) => {
  let state;
  const listeners = new Set();

  const setState = (partial) => {
    const nextState = typeof partial === 'function' ? partial(state) : partial;
    if (!Object.is(nextState, state)) {
      state = Object.assign({}, state, nextState);
      listeners.forEach((l) => l(state));
    }
  };

  const getState = () => state;
  const subscribe = (listener) => {
    listeners.add(listener);
    return () => listeners.delete(listener);
  };

  state = createState(setState, getState);
  return { setState, getState, subscribe };
};
```

---

### 1.2 åŸå­åŒ–çŠ¶æ€æ´¾ç³» (Atomic State)

#### Jotai (Pmndrs, 2020)

| ç»´åº¦         | å†…å®¹                                                                                               |
| :----------- | :------------------------------------------------------------------------------------------------- |
| **GitHub**   | [pmndrs/jotai](https://github.com/pmndrs/jotai) â­ 17k+                                            |
| **æ ¸å¿ƒæ€æƒ³** | åŸå­åŒ– + è‡ªåº•å‘ä¸Šã€‚çŠ¶æ€æ˜¯ç‹¬ç«‹çš„"åŸå­"ï¼Œå¯ç»„åˆæ´¾ç”Ÿ                                                  |
| **å®ç°åŸç†** | æ¯ä¸ª atom æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒStore ç»´æŠ¤ atom â†’ value çš„ WeakMapã€‚è¯»å–æ—¶å»ºç«‹ä¾èµ–å›¾ï¼Œå†™å…¥æ—¶è§¦å‘ä¾èµ–æ›´æ–° |
| **ä¼˜ç‚¹**     | ç»†ç²’åº¦æ›´æ–°ã€æ—  Provider å¯é€‰ã€React Suspense åŸç”Ÿæ”¯æŒ                                              |
| **ç¼ºç‚¹**     | è°ƒè¯•æ—¶éš¾ä»¥æŸ¥çœ‹å®Œæ•´çŠ¶æ€æ ‘                                                                           |

```javascript
// Jotai atom æœ¬è´¨æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡
const countAtom = atom(0); // { init: 0, read: ..., write: ... }

// æ´¾ç”Ÿ atom
const doubleAtom = atom((get) => get(countAtom) * 2);

// Store å†…éƒ¨ç»“æ„
// Map<Atom, { value, dependents: Set<Atom>, listeners: Set<Function> }>
```

---

#### Recoil (2020) âš ï¸ å·²åœæ­¢ç»´æŠ¤

| ç»´åº¦         | å†…å®¹                                                                                  |
| :----------- | :------------------------------------------------------------------------------------ |
| **GitHub**   | [facebookexperimental/Recoil](https://github.com/facebookexperimental/Recoil) â­ 19k+ |
| **æ ¸å¿ƒæ€æƒ³** | åŸå­åŒ– + å›¾ä¾èµ–ã€‚ä¸ Jotai ç±»ä¼¼ä½†æ›´é‡                                                  |
| **å®ç°åŸç†** | åŸºäºæœ‰å‘å›¾çš„ä¾èµ–è¿½è¸ªï¼ŒSelector èŠ‚ç‚¹ç¼“å­˜è®¡ç®—ç»“æœ                                       |
| **çŠ¶æ€**     | **âš ï¸ 2024 å¹´å·²å®£å¸ƒåœæ­¢ç»´æŠ¤ï¼Œå»ºè®®è¿ç§»è‡³ Jotai**                                        |

---

#### Nano Stores (Evil Martians)

| ç»´åº¦         | å†…å®¹                                                                     |
| :----------- | :----------------------------------------------------------------------- |
| **GitHub**   | [nanostores/nanostores](https://github.com/nanostores/nanostores) â­ 5k+ |
| **æ ¸å¿ƒæ€æƒ³** | æ¡†æ¶æ— å…³çš„æç®€åŸå­åŒ–                                                     |
| **å®ç°åŸç†** | çº¯ JS å®ç°çš„å‘å¸ƒ-è®¢é˜…ï¼Œæ¯ä¸ª store æ˜¯ç‹¬ç«‹çš„å¯è®¢é˜…å¯¹è±¡                     |
| **ä¼˜ç‚¹**     | < 1KBã€æ— ä¾èµ–ã€React/Vue/Svelte é€šç”¨                                     |
| **ç¼ºç‚¹**     | åŠŸèƒ½æç®€ï¼Œå¤æ‚åœºæ™¯éœ€ç»„åˆå¤šä¸ªåº“                                           |

```javascript
// Nano Stores æç®€å®ç°
import { atom, computed } from 'nanostores';

const count = atom(0);
const double = computed(count, (n) => n * 2);

count.subscribe((value) => console.log(value));
count.set(count.get() + 1);
```

---

### 1.3 Proxy å“åº”å¼æ´¾ç³»

#### MobX (2015)

| ç»´åº¦         | å†…å®¹                                                                                          |
| :----------- | :-------------------------------------------------------------------------------------------- |
| **GitHub**   | [mobxjs/mobx](https://github.com/mobxjs/mobx) â­ 27k+                                         |
| **æ ¸å¿ƒæ€æƒ³** | é€æ˜å‡½æ•°å¼å“åº”ç¼–ç¨‹ (TFRP)ã€‚ç”¨ OOP å†™æ³•ï¼Œè‡ªåŠ¨è¿½è¸ªä¾èµ–                                          |
| **å®ç°åŸç†** | ä½¿ç”¨ `Proxy`ï¼ˆæˆ– ES5 çš„ `Object.defineProperty`ï¼‰æ‹¦æˆªå±æ€§è®¿é—®ã€‚è¯»å–æ—¶æ”¶é›†ä¾èµ–ï¼Œå†™å…¥æ—¶è§¦å‘æ›´æ–° |
| **ä¼˜ç‚¹**     | å†™æ³•è‡ªç„¶ï¼ˆç›´æ¥èµ‹å€¼ï¼‰ã€è‡ªåŠ¨ç»†ç²’åº¦æ›´æ–°                                                          |
| **ç¼ºç‚¹**     | éšå¼é­”æ³•å¤šã€è°ƒè¯•å›°éš¾ã€è£…é¥°å™¨è¯­æ³•äº‰è®®                                                          |

```javascript
// MobX å“åº”å¼åŸç†
const handler = {
  get(target, prop, receiver) {
    trackDependency(target, prop); // æ”¶é›†ä¾èµ–
    return Reflect.get(target, prop, receiver);
  },
  set(target, prop, value, receiver) {
    Reflect.set(target, prop, value, receiver);
    triggerReactions(target, prop); // è§¦å‘æ›´æ–°
    return true;
  },
};
const observable = new Proxy(rawObject, handler);
```

---

#### MobX-State-Tree (MST)

| ç»´åº¦         | å†…å®¹                                                                         |
| :----------- | :--------------------------------------------------------------------------- |
| **GitHub**   | [mobxjs/mobx-state-tree](https://github.com/mobxjs/mobx-state-tree) â­ 6.9k+ |
| **æ ¸å¿ƒæ€æƒ³** | MobX + ç»“æ„åŒ–ç±»å‹ç³»ç»Ÿ + å¿«ç…§ + æ—¶é—´æ—…è¡Œ                                      |
| **å®ç°åŸç†** | åœ¨ MobX åŸºç¡€ä¸Šå¢åŠ  Schema æ ¡éªŒã€è‡ªåŠ¨åºåˆ—åŒ–ã€è¡¥ä¸å†å²                         |
| **ä¼˜ç‚¹**     | å¤æ‚åµŒå¥—æ•°æ®çš„ç»ˆææ–¹æ¡ˆã€ç±»å‹è¿è¡Œæ—¶æ ¡éªŒ                                       |
| **ç¼ºç‚¹**     | å­¦ä¹ æ›²çº¿æé«˜ã€æ‰“åŒ…ä½“ç§¯å¤§                                                     |

---

#### Valtio (Pmndrs, 2021)

| ç»´åº¦         | å†…å®¹                                                              |
| :----------- | :---------------------------------------------------------------- |
| **GitHub**   | [pmndrs/valtio](https://github.com/pmndrs/valtio) â­ 8.5k+        |
| **æ ¸å¿ƒæ€æƒ³** | ç”¨ Proxy è®© React çŠ¶æ€åƒ Vue ä¸€æ ·å¯å˜                             |
| **å®ç°åŸç†** | `proxy()` è¿”å› Proxy å¯¹è±¡ï¼Œ`useSnapshot()` åœ¨æ¸²æŸ“æ—¶åˆ›å»ºä¸å¯å˜å¿«ç…§ |
| **ä¼˜ç‚¹**     | å†™æ³•æç®€ã€æ—  action æ¦‚å¿µ                                          |
| **ç¼ºç‚¹**     | Proxy çš„éšå¼è¡Œä¸ºå¯èƒ½å¯¼è‡´å›°æƒ‘                                      |

```javascript
import { proxy, useSnapshot } from 'valtio';

const state = proxy({ count: 0 });

// ç›´æ¥ä¿®æ”¹
state.count++;

// ç»„ä»¶ä¸­ä½¿ç”¨
function Counter() {
  const snap = useSnapshot(state); // è‡ªåŠ¨è¿½è¸ª
  return <div>{snap.count}</div>;
}
```

---

### 1.4 Signal ç»†ç²’åº¦å“åº”å¼æ´¾ç³»

#### Preact Signals

| ç»´åº¦         | å†…å®¹                                                             |
| :----------- | :--------------------------------------------------------------- |
| **GitHub**   | [preactjs/signals](https://github.com/preactjs/signals) â­ 3.5k+ |
| **æ ¸å¿ƒæ€æƒ³** | ç»•è¿‡ VDOM Diffï¼Œç›´æ¥æ›´æ–° DOM èŠ‚ç‚¹                                |
| **å®ç°åŸç†** | Signal æ˜¯ä¸€ä¸ªå¸¦å€¼çš„ç›’å­ï¼Œè¯»å–æ—¶è‡ªåŠ¨è®¢é˜…ï¼Œå†™å…¥æ—¶ç›´æ¥æ›´æ–°è®¢é˜…è€…    |
| **ä¼˜ç‚¹**     | æè‡´æ€§èƒ½ã€æ¯” `useMemo` æ›´ç»†ç²’åº¦                                  |
| **ç¼ºç‚¹**     | ç ´å React å•å‘æ•°æ®æµå“²å­¦                                        |

```javascript
// Signal æ ¸å¿ƒæ¦‚å¿µ
const count = signal(0);
const double = computed(() => count.value * 2);

// è¯»å–è‡ªåŠ¨å»ºç«‹ä¾èµ–
effect(() => console.log(count.value));

// å†™å…¥è§¦å‘æ›´æ–°
count.value++; // effect è‡ªåŠ¨æ‰§è¡Œ
```

---

#### Legend-State

| ç»´åº¦         | å†…å®¹                                                                         |
| :----------- | :--------------------------------------------------------------------------- |
| **GitHub**   | [LegendApp/legend-state](https://github.com/LegendApp/legend-state) â­ 2.5k+ |
| **æ ¸å¿ƒæ€æƒ³** | å¼ºè°ƒæ€§èƒ½ä¸ç»†ç²’åº¦å“åº”å¼ï¼ˆæ€§èƒ½å®£ç§°éœ€ä»¥åŸºå‡†æµ‹è¯•éªŒè¯ï¼‰                           |
| **å®ç°åŸç†** | Proxy æ‹¦æˆª + ç»†ç²’åº¦ Signal + è‡ªåŠ¨æŒä¹…åŒ–                                      |
| **ä¼˜ç‚¹**     | æè‡´æ€§èƒ½ã€å†…ç½® LocalStorage/AsyncStorage åŒæ­¥                                |
| **ç¼ºç‚¹**     | ç›¸å¯¹å°ä¼—ï¼Œç”Ÿæ€æœ‰é™                                                           |

---

#### Solid.js Signals (æ¡†æ¶çº§å‚è€ƒ)

| ç»´åº¦         | å†…å®¹                                                         |
| :----------- | :----------------------------------------------------------- |
| **GitHub**   | [solidjs/solid](https://github.com/solidjs/solid) â­ 30k+    |
| **æ ¸å¿ƒæ€æƒ³** | ç¼–è¯‘æ—¶ + ç»†ç²’åº¦å“åº”å¼ï¼Œæ—  VDOM                               |
| **å®ç°åŸç†** | ç¼–è¯‘å™¨å°† JSX è½¬æ¢ä¸ºçœŸå® DOM æ“ä½œï¼ŒSignal ç›´æ¥ç»‘å®šåˆ° DOM èŠ‚ç‚¹ |
| **æ„ä¹‰**     | æ¡†æ¶çº§å“åº”å¼å‚è€ƒï¼Œå¯¹ React ç”Ÿæ€æœ‰å¯å‘                        |

---

### 1.5 æœ‰é™çŠ¶æ€æœºæ´¾ç³» (FSM / Statecharts)

#### XState (Stately, 2017)

| ç»´åº¦         | å†…å®¹                                                            |
| :----------- | :-------------------------------------------------------------- |
| **GitHub**   | [statelyai/xstate](https://github.com/statelyai/xstate) â­ 26k+ |
| **æ ¸å¿ƒæ€æƒ³** | W3C SCXML æ ‡å‡†å®ç°ï¼ŒçŠ¶æ€å›¾ (Statecharts) å¯è§†åŒ–                 |
| **å®ç°åŸç†** | ç”¨é…ç½®å¯¹è±¡æè¿°çŠ¶æ€æœºï¼ŒInterpreter è§£æäº‹ä»¶å¹¶æ‰§è¡Œè½¬æ¢            |
| **é€‚ç”¨åœºæ™¯** | å¤æ‚äº¤äº’æµç¨‹ã€æ”¯ä»˜ã€è¿æ¥ç®¡ç†ã€æ¸¸æˆé€»è¾‘                          |
| **ä¼˜ç‚¹**     | æ•°å­¦å¯è¯æ˜ã€å¯è§†åŒ–å³ä»£ç ã€Actor æ¨¡å‹                            |
| **ç¼ºç‚¹**     | å­¦ä¹ æ›²çº¿é«˜ã€ç®€å•åœºæ™¯è¿‡åº¦è®¾è®¡                                    |

```javascript
// XState çŠ¶æ€æœºå®šä¹‰
const machine = createMachine({
  id: 'auth',
  initial: 'idle',
  context: { retries: 0 },
  states: {
    idle: {
      on: { LOGIN: 'loading' },
    },
    loading: {
      invoke: {
        src: 'loginService',
        onDone: 'success',
        onError: 'failure',
      },
    },
    success: { type: 'final' },
    failure: {
      on: {
        RETRY: {
          target: 'loading',
          actions: assign({ retries: (ctx) => ctx.retries + 1 }),
        },
      },
    },
  },
});
```

---

#### Robot (å°å‹ FSM)

| ç»´åº¦         | å†…å®¹                                                         |
| :----------- | :----------------------------------------------------------- |
| **GitHub**   | [matthewp/robot](https://github.com/matthewp/robot) â­ 1.8k+ |
| **æ ¸å¿ƒæ€æƒ³** | æç®€æœ‰é™çŠ¶æ€æœº                                               |
| **ä¼˜ç‚¹**     | < 1KBã€å‡½æ•°å¼ APIã€æ— é…ç½®å¯¹è±¡                                |
| **é€‚ç”¨åœºæ™¯** | ç®€å•çš„çŠ¶æ€åˆ‡æ¢é€»è¾‘                                           |

---

### 1.6 æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†æ´¾ç³» (Server State)

#### TanStack Query (React Query)

| ç»´åº¦         | å†…å®¹                                                                        |
| :----------- | :-------------------------------------------------------------------------- |
| **GitHub**   | [TanStack/query](https://github.com/TanStack/query) â­ 40k+                 |
| **æ ¸å¿ƒæ€æƒ³** | æœåŠ¡ç«¯çŠ¶æ€æ˜¯"ç¼“å­˜"è€Œé"åº”ç”¨çŠ¶æ€"                                            |
| **å®ç°åŸç†** | Query Cache å­˜å‚¨è¯·æ±‚ç»“æœï¼Œç”¨ staleTime/cacheTime æ§åˆ¶ç¼“å­˜ç­–ç•¥ï¼Œè‡ªåŠ¨åå°åˆ·æ–° |
| **ä¼˜ç‚¹**     | å½»åº•è§£å†³ loading/error/data ä¸‰æ€ã€ä¹è§‚æ›´æ–°ã€è‡ªåŠ¨é‡è¯•                        |
| **ç¼ºç‚¹**     | åªç®¡æœåŠ¡ç«¯çŠ¶æ€ï¼Œå®¢æˆ·ç«¯çŠ¶æ€ä»éœ€å…¶ä»–åº“                                        |

```javascript
// React Query æ ¸å¿ƒæ¦‚å¿µ
const { data, isLoading, error } = useQuery({
  queryKey: ['users', userId],
  queryFn: () => fetchUser(userId),
  staleTime: 5 * 60 * 1000, // 5 åˆ†é’Ÿå†…ä¸é‡æ–°è·å–
});

// ä¹è§‚æ›´æ–°
useMutation({
  mutationFn: updateUser,
  onMutate: async (newData) => {
    await queryClient.cancelQueries(['users', userId]);
    const previous = queryClient.getQueryData(['users', userId]);
    queryClient.setQueryData(['users', userId], newData); // ä¹è§‚æ›´æ–°
    return { previous };
  },
  onError: (err, newData, context) => {
    queryClient.setQueryData(['users', userId], context.previous); // å›æ»š
  },
});
```

---

#### SWR (Vercel)

| ç»´åº¦                 | å†…å®¹                                                |
| :------------------- | :-------------------------------------------------- |
| **GitHub**           | [vercel/swr](https://github.com/vercel/swr) â­ 30k+ |
| **æ ¸å¿ƒæ€æƒ³**         | Stale-While-Revalidate ç¼“å­˜ç­–ç•¥                     |
| **å®ç°åŸç†**         | å…ˆè¿”å›ç¼“å­˜æ•°æ®ï¼ŒåŒæ—¶åå°é‡æ–°éªŒè¯                    |
| **å¯¹æ¯” React Query** | API æ›´ç®€æ´ï¼Œä½†åŠŸèƒ½è¾ƒå°‘ï¼ˆæ—  Mutationã€æ—  DevToolsï¼‰  |

---

#### RTK Query (Redux Toolkit)

| ç»´åº¦         | å†…å®¹                           |
| :----------- | :----------------------------- |
| **æ ¸å¿ƒæ€æƒ³** | Redux ç”Ÿæ€çš„æœåŠ¡ç«¯çŠ¶æ€æ–¹æ¡ˆ     |
| **å®ç°åŸç†** | åœ¨ Redux Store å†…ç®¡ç† API ç¼“å­˜ |
| **ä¼˜ç‚¹**     | ä¸ Redux æ— ç¼é›†æˆ              |
| **ç¼ºç‚¹**     | ç»‘å®š Redux ç”Ÿæ€                |

---

### 1.7 RxJS / Observable æ´¾ç³»

#### RxJS

| ç»´åº¦         | å†…å®¹                                                        |
| :----------- | :---------------------------------------------------------- |
| **GitHub**   | [ReactiveX/rxjs](https://github.com/ReactiveX/rxjs) â­ 30k+ |
| **æ ¸å¿ƒæ€æƒ³** | ä¸€åˆ‡çš†æµ (Everything is a Stream)                           |
| **å®ç°åŸç†** | Observable è¡¨ç¤ºéšæ—¶é—´æ¨é€çš„å€¼åºåˆ—ï¼ŒOperators å¯¹æµè¿›è¡Œå˜æ¢   |
| **ä¼˜ç‚¹**     | å¤„ç†å¤æ‚å¼‚æ­¥é€»è¾‘çš„ç»ˆæå·¥å…·                                  |
| **ç¼ºç‚¹**     | å­¦ä¹ æ›²çº¿æé™¡ã€React é›†æˆéœ€è¦èƒ¶æ°´å±‚                          |

```javascript
// RxJS æ ¸å¿ƒæ¦‚å¿µ
const clicks$ = fromEvent(button, 'click');
const positions$ = clicks$.pipe(
  throttleTime(1000),
  map((e) => ({ x: e.clientX, y: e.clientY })),
  distinctUntilChanged(),
);
positions$.subscribe((pos) => console.log(pos));
```

---

#### Elf (RxJS çŠ¶æ€ç®¡ç†)

| ç»´åº¦         | å†…å®¹                                                 |
| :----------- | :--------------------------------------------------- |
| **GitHub**   | [ngneat/elf](https://github.com/ngneat/elf) â­ 1.5k+ |
| **æ ¸å¿ƒæ€æƒ³** | åŸºäº RxJS çš„æ¨¡å—åŒ–çŠ¶æ€ç®¡ç†                           |
| **ä¼˜ç‚¹**     | ä¸º RxJS ç”¨æˆ·æä¾›å¼€ç®±å³ç”¨çš„ Store æ¨¡å¼                |

---

#### Akita

| ç»´åº¦         | å†…å®¹                                                         |
| :----------- | :----------------------------------------------------------- |
| **GitHub**   | [datorama/akita](https://github.com/datorama/akita) â­ 3.7k+ |
| **æ ¸å¿ƒæ€æƒ³** | åŸºäº RxJS çš„å®ä½“ç®¡ç†                                         |
| **é€‚ç”¨åœºæ™¯** | Angular é¡¹ç›®æˆ– RxJS é‡åº¦ç”¨æˆ·                                 |

---

### 1.8 CRDT / åä½œçŠ¶æ€æ´¾ç³»

#### Yjs

| ç»´åº¦         | å†…å®¹                                               |
| :----------- | :------------------------------------------------- |
| **GitHub**   | [yjs/yjs](https://github.com/yjs/yjs) â­ 15k+      |
| **æ ¸å¿ƒæ€æƒ³** | CRDT (æ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹) å®ç°å¤šäººå®æ—¶åä½œ         |
| **å®ç°åŸç†** | æ¯ä¸ªæ“ä½œæºå¸¦å”¯ä¸€ ID å’Œå› æœä¾èµ–ï¼Œåˆå¹¶æ—¶è‡ªåŠ¨è§£å†³å†²çª |
| **ä¼˜ç‚¹**     | ç¦»çº¿ä¼˜å…ˆã€P2P æ”¯æŒã€ä¸ä¸»æµç¼–è¾‘å™¨é›†æˆ               |
| **ç¼ºç‚¹**     | åªè§£å†³åä½œé—®é¢˜ï¼Œä¸æ˜¯é€šç”¨çŠ¶æ€ç®¡ç†                   |

```javascript
import * as Y from 'yjs';
import { WebsocketProvider } from 'y-websocket';

const doc = new Y.Doc();
const ymap = doc.getMap('shared-state');

// æœ¬åœ°ä¿®æ”¹è‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰å®¢æˆ·ç«¯
ymap.set('count', 42);

// ç›‘å¬è¿œç¨‹å˜æ›´
ymap.observe((event) => {
  console.log('Changed:', event.changes);
});
```

---

#### Automerge

| ç»´åº¦         | å†…å®¹                                                                 |
| :----------- | :------------------------------------------------------------------- |
| **GitHub**   | [automerge/automerge](https://github.com/automerge/automerge) â­ 3k+ |
| **æ ¸å¿ƒæ€æƒ³** | JSON å‹å¥½çš„ CRDT                                                     |
| **å¯¹æ¯” Yjs** | API æ›´ç®€æ´ï¼Œä½†æ€§èƒ½ç•¥é€Šäº Yjs                                         |

---

#### Liveblocks

| ç»´åº¦         | å†…å®¹                                    |
| :----------- | :-------------------------------------- |
| **å®˜ç½‘**     | [liveblocks.io](https://liveblocks.io/) |
| **æ ¸å¿ƒæ€æƒ³** | CRDT + åç«¯å³æœåŠ¡ (BaaS)                |
| **ä¼˜ç‚¹**     | å¼€ç®±å³ç”¨çš„åä½œåŸºç¡€è®¾æ–½                  |

---

### 1.9 GraphQL å®¢æˆ·ç«¯æ´¾ç³»

#### Apollo Client

| ç»´åº¦         | å†…å®¹                                                                                  |
| :----------- | :------------------------------------------------------------------------------------ |
| **GitHub**   | [apollographql/apollo-client](https://github.com/apollographql/apollo-client) â­ 19k+ |
| **æ ¸å¿ƒæ€æƒ³** | GraphQL + å½’ä¸€åŒ–ç¼“å­˜                                                                  |
| **å®ç°åŸç†** | å°† GraphQL å“åº”æ‹å¹³åˆ° ID ç´¢å¼•çš„ç¼“å­˜ä¸­ï¼Œè‡ªåŠ¨æ›´æ–°å¼•ç”¨                                   |
| **ä¼˜ç‚¹**     | è‡ªåŠ¨ç¼“å­˜ã€ä¹è§‚ UIã€Fragment Colocation                                                |
| **ç¼ºç‚¹**     | æ‰“åŒ…ä½“ç§¯å¤§ã€é…ç½®å¤æ‚                                                                  |

---

#### Relay (Meta)

| ç»´åº¦         | å†…å®¹                                                        |
| :----------- | :---------------------------------------------------------- |
| **GitHub**   | [facebook/relay](https://github.com/facebook/relay) â­ 18k+ |
| **æ ¸å¿ƒæ€æƒ³** | ç¼–è¯‘æœŸä¼˜åŒ–çš„ GraphQL å®¢æˆ·ç«¯                                 |
| **ä¼˜ç‚¹**     | æè‡´æ€§èƒ½ã€ä¸ React æ·±åº¦é›†æˆ                                 |
| **ç¼ºç‚¹**     | å­¦ä¹ æ›²çº¿æé«˜ã€éœ€è¦å®Œæ•´çš„ç¼–è¯‘å·¥å…·é“¾                          |

---

#### URQL

| ç»´åº¦            | å†…å®¹                                                               |
| :-------------- | :----------------------------------------------------------------- |
| **GitHub**      | [urql-graphql/urql](https://github.com/urql-graphql/urql) â­ 8.5k+ |
| **æ ¸å¿ƒæ€æƒ³**    | è½»é‡çº§ GraphQL å®¢æˆ·ç«¯                                              |
| **å¯¹æ¯” Apollo** | æ›´å°ã€æ›´æ¨¡å—åŒ–ã€å¯æ’æ‹”çš„ç¼“å­˜                                       |

---

### 1.10 å…¶ä»–ç‰¹è‰²æ–¹æ¡ˆ

#### Effector (ä¿„ç½—æ–¯)

| ç»´åº¦         | å†…å®¹                                                               |
| :----------- | :----------------------------------------------------------------- |
| **GitHub**   | [effector/effector](https://github.com/effector/effector) â­ 4.5k+ |
| **æ ¸å¿ƒæ€æƒ³** | å¤šå‘æ•°æ®æµ + å¼ºç±»å‹æ¨æ–­                                            |
| **å®ç°åŸç†** | Store/Event/Effect ä¸‰ä½ä¸€ä½“ï¼Œæ•°æ®æµæ˜¾å¼å£°æ˜                        |
| **ä¼˜ç‚¹**     | ç±»å‹å®Œç¾ã€æ€§èƒ½æé«˜                                                 |
| **ç¼ºç‚¹**     | å›½å†…å°‘è§ã€API ç¹ç                                                 |

```javascript
import { createStore, createEvent, createEffect } from 'effector';

const increment = createEvent();
const $counter = createStore(0).on(increment, (n) => n + 1);

const fetchUser = createEffect(async (id) => {
  const res = await fetch(`/api/users/${id}`);
  return res.json();
});
```

---

#### Hookstate

| ç»´åº¦         | å†…å®¹                                                               |
| :----------- | :----------------------------------------------------------------- |
| **GitHub**   | [avkonst/hookstate](https://github.com/avkonst/hookstate) â­ 1.6k+ |
| **æ ¸å¿ƒæ€æƒ³** | åŸºäº Proxy çš„æç®€ React Hook                                       |
| **ä¼˜ç‚¹**     | é›¶æ ·æ¿ä»£ç ã€æ·±åº¦åµŒå¥—å¯¹è±¡æ€§èƒ½ä¼˜å¼‚                                   |

---

#### Overmind

| ç»´åº¦         | å†…å®¹                                                               |
| :----------- | :----------------------------------------------------------------- |
| **GitHub**   | [cerebral/overmind](https://github.com/cerebral/overmind) â­ 1.3k+ |
| **æ ¸å¿ƒæ€æƒ³** | èåˆ Flux + Statechart + Proxy çš„é‡å¿ƒä¹‹ä½œ                          |
| **ç‰¹è‰²**     | å†…ç½® DevToolsã€å¯è§†åŒ–çŠ¶æ€æµ                                        |

---

### 1.11 é¢†åŸŸä¸“ç”¨çŠ¶æ€ç®¡ç†

| é¢†åŸŸ           | ä»£è¡¨åº“                        | è¯´æ˜                         |
| :------------- | :---------------------------- | :--------------------------- |
| **è¡¨å•çŠ¶æ€**   | React Hook Form, Formik       | è¡¨å•éªŒè¯ã€å­—æ®µçŠ¶æ€ã€æäº¤å¤„ç† |
| **è·¯ç”±çŠ¶æ€**   | TanStack Router, React Router | URL å³çŠ¶æ€ï¼Œæµè§ˆå™¨å†å²ç®¡ç†   |
| **è¡¨æ ¼çŠ¶æ€**   | TanStack Table                | åˆ†é¡µã€æ’åºã€ç­›é€‰ã€è¡Œé€‰æ‹©     |
| **æœ¬åœ°æ•°æ®åº“** | RxDB, PouchDB, Dexie          | ç¦»çº¿ä¼˜å…ˆã€IndexedDB å°è£…     |
| **åŠ¨ç”»çŠ¶æ€**   | Framer Motion, React Spring   | åŸºäºç‰©ç†çš„åŠ¨ç”»çŠ¶æ€æœº         |

---

### 1.12 å†å²é—ç•™æ–¹æ¡ˆ (ä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨)

| åº“                 | çŠ¶æ€               | æ›¿ä»£æ–¹æ¡ˆ      |
| :----------------- | :----------------- | :------------ |
| **Recoil**         | âš ï¸ åœæ­¢ç»´æŠ¤ (2024) | Jotai         |
| **Redux (Legacy)** | âš ï¸ è¿‡æ—¶            | Redux Toolkit |
| **Flux (Library)** | ğŸª¦ å·²åºŸå¼ƒ          | ä»»æ„ç°ä»£æ–¹æ¡ˆ  |
| **Alt.js**         | ğŸª¦ å·²åºŸå¼ƒ          | Zustand       |
| **Reflux**         | ğŸª¦ å·²åºŸå¼ƒ          | Zustand       |

---

## äºŒã€ç°æœ‰å‰ç«¯çŠ¶æ€ç®¡ç†åº“çš„æ ¸å¿ƒé—®é¢˜

> å¯¼è¯»ï¼šå½’çº³å½“ä¸‹æ–¹æ¡ˆçš„ç»“æ„æ€§é—®é¢˜ï¼Œä¸ºåæ–‡è®¾è®¡ç›®æ ‡æä¾›ä¾æ®ã€‚

### 2.1 èŒƒå¼å‰²è£‚ (Paradigm Fragmentation)

| é—®é¢˜                   | å…·ä½“è¡¨ç°                                                                            |
| :--------------------- | :---------------------------------------------------------------------------------- |
| **æµæ´¾å¤ªå¤šï¼Œé€‰æ‹©ç–²åŠ³** | Fluxã€Atomicã€Proxyã€FSMã€Signalã€CRDT... å¼€å‘è€…éœ€è¦å­¦ä¹ å¤šç§å¿ƒæ™ºæ¨¡å‹                |
| **ä¸åŒåº“è§£å†³ä¸åŒé—®é¢˜** | Zustand ç®¡æœ¬åœ°çŠ¶æ€ã€React Query ç®¡æœåŠ¡ç«¯ã€XState ç®¡é€»è¾‘æµã€Yjs ç®¡åä½œâ€”â€”éœ€è¦"ç»„åˆæ‹³" |
| **èƒ¶æ°´ä»£ç æ— ç©·å°½**     | åº“ä¸åº“ä¹‹é—´çš„é›†æˆéœ€è¦å¤§é‡æ ·æ¿ä»£ç                                                     |

### 2.2 æŠ½è±¡å±‚çº§æ··ä¹± (Abstraction Confusion)

- **Redux**ï¼šæŠ½è±¡å¤ªé‡ï¼Œæ¦‚å¿µç¹å¤š (Actionã€Reducerã€Middlewareã€Selector...)
- **Context API**ï¼šæŠ½è±¡å¤ªè½»ï¼Œæ€§èƒ½ç¾éš¾ï¼Œæ— æ³• scale
- **Signal**ï¼šæŠ½è±¡å¤ªåº•å±‚ï¼Œæ”¾å¼ƒäº† React è°ƒå’Œæœºåˆ¶ï¼Œé»‘é­”æ³•
- **MobX**ï¼šæŠ½è±¡å¤ªéšå¼ï¼Œè£…é¥°å™¨é­”æ³•è®©è°ƒè¯•å›°éš¾

### 2.3 æœåŠ¡ç«¯/å®¢æˆ·ç«¯çŠ¶æ€äºŒå…ƒå¯¹ç«‹

React Query è™½ç„¶ä¼Ÿå¤§ï¼Œä½†å®ƒåˆ›é€ äº†ä¸€ä¸ªæ–°é—®é¢˜ï¼š**ä½ éœ€è¦ä¸¤å¥—å¿ƒæ™ºæ¨¡å‹**ã€‚

- ã€Œè¿™ä¸ªæ•°æ®æ˜¯æœåŠ¡ç«¯çš„è¿˜æ˜¯å®¢æˆ·ç«¯çš„ï¼Ÿã€
- ã€Œæˆ‘è¯¥ `useQuery` è¿˜æ˜¯ `useState`ï¼Ÿã€
- ã€Œä¹è§‚æ›´æ–°æ€ä¹ˆåšï¼ŸæœåŠ¡ç«¯çŠ¶æ€å’Œæœ¬åœ° UI çŠ¶æ€æ€ä¹ˆåŒæ­¥ï¼Ÿã€

### 2.4 é€»è¾‘ä¸æ•°æ®çš„å¼ºè€¦åˆ

XState æ˜¯ä¸ªä¾‹å¤–ï¼Œä½†å¤§å¤šæ•°åº“æŠŠ"æ•°æ®å­˜å‚¨"å’Œ"ä¸šåŠ¡é€»è¾‘æµç¨‹"æ··åœ¨ä¸€èµ·ï¼š

- çŠ¶æ€å˜æ›´é€»è¾‘åˆ†æ•£åœ¨ reducerã€actionã€ç»„ä»¶å„å¤„
- éš¾ä»¥å›ç­”ã€Œç³»ç»Ÿç°åœ¨å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Ÿä¸‹ä¸€æ­¥å¯ä»¥åšä»€ä¹ˆï¼Ÿã€

### 2.5 æ—¶é—´æ—…è¡Œä¸å¯é¢„æµ‹æ€§çš„ä»£ä»·

- Redux DevTools çš„"æ—¶é—´æ—…è¡Œ"å¾ˆé…·ï¼Œä½†ä»£ä»·æ˜¯**ä¸å¯å˜æ•°æ® + çº¯å‡½æ•°**çš„å¼ºçº¦æŸ
- Immer åªæ˜¯è¯­æ³•ç³–ï¼Œåº•å±‚ä»ç„¶æ˜¯æ·±æ‹·è´ï¼Œæ€§èƒ½å¼€é”€å·¨å¤§

### 2.6 å¤šäººåä½œæ˜¯ afterthought

- Yjs/CRDT è™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„"å¹¶è¡Œä¸–ç•Œ"
- æ²¡æœ‰ä¸€ä¸ªåº“èƒ½åŸç”Ÿæ”¯æŒï¼š"æˆ‘æƒ³è®©è¿™ä¸ªçŠ¶æ€æ—¢èƒ½æœ¬åœ°ä¿®æ”¹ï¼Œåˆèƒ½å¤šäººåä½œ"

---

## ä¸‰ã€ã€Œç†æƒ³ã€çš„çŠ¶æ€ç®¡ç†åº“åº”è¯¥é•¿ä»€ä¹ˆæ ·ï¼Ÿ

> å¯¼è¯»ï¼šæ˜ç¡®å¥‡ç‚¹çš„ç›®æ ‡/éç›®æ ‡/çº¦æŸä¸ä»·å€¼åˆ¤æ–­æ ‡å‡†ã€‚

### 3.1 ç›®æ ‡ (Goals)

- **å•ä¸€å¿ƒæ™ºæ¨¡å‹**ï¼šæœ¬åœ°/æœåŠ¡ç«¯/åä½œçŠ¶æ€å…±äº«ç»Ÿä¸€æŠ½è±¡
- **å¯è§‚æµ‹ä¸å¯è°ƒè¯•**ï¼šçŠ¶æ€å˜åŒ–å¯è¿½è¸ªï¼Œå¯è§†åŒ–ä¸æ—¥å¿—å¯ç”¨
- **é€»è¾‘ä¸æ•°æ®è§£è€¦**ï¼šä¸šåŠ¡æµç¨‹ä¸æ•°æ®å­˜å‚¨åˆ†å±‚ï¼Œå½¼æ­¤å¯ç»„åˆ
- **æ€§èƒ½å¯é¢„æµ‹**ï¼šç»†ç²’åº¦æ›´æ–°ï¼Œå¯æ§çš„è®¢é˜…è¾¹ç•Œä¸è°ƒåº¦ç­–ç•¥
- **è·¨å›¢é˜Ÿå¯æ‰©å±•**ï¼šæ”¯æŒåˆ†åŸŸä¸åˆ†å±‚æ²»ç†ï¼Œå…è®¸æ¸è¿›æ¥å…¥

### 3.2 éç›®æ ‡ (Non-goals)

- **ä¸æ›¿ä»£ä¸šåŠ¡æ•°æ®æº**ï¼šGraphQL/REST å®¢æˆ·ç«¯ä»æ˜¯ç‹¬ç«‹å±‚
- **ä¸åŒ…åŠé¢†åŸŸå»ºæ¨¡**ï¼šé¢†åŸŸè§„åˆ™ä»ç”±åº”ç”¨å±‚è´Ÿè´£
- **ä¸å¼ºç»‘å®šæ¡†æ¶**ï¼šä¿ç•™æ¡†æ¶é€‚é…å±‚ï¼Œæ ¸å¿ƒä¿æŒæ¡†æ¶æ— å…³

### 3.3 ç¡¬çº¦æŸ (Constraints)

- **å¹¶å‘ä¸ SSR å®‰å…¨**ï¼šé€‚é…å¹¶å‘æ¸²æŸ“ä¸æµå¼ SSR çš„ç”Ÿå‘½å‘¨æœŸ
- **å¯æ ‘æ‘‡**ï¼šæ ¸å¿ƒè¶³å¤Ÿå°ï¼Œæ‰©å±•èƒ½åŠ›æŒ‰éœ€å¼•å…¥
- **è°ƒåº¦ç¡®å®šæ€§**ï¼šæ‰¹å¤„ç†ä¸å¼‚æ­¥è¡Œä¸ºå¯é¢„æµ‹ï¼Œé¿å…éšå¼é­”æ³•
- **éš”ç¦»æ€§**ï¼šSSR è¯·æ±‚çº§éš”ç¦»ï¼Œé¿å…è·¨è¯·æ±‚çŠ¶æ€æ±¡æŸ“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç†æƒ³çŠ¶æ€ç®¡ç†åº“çš„ç‰¹å¾                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. å•ä¸€å¿ƒæ™ºæ¨¡å‹      â”‚ æ— è®ºæœ¬åœ°/æœåŠ¡ç«¯/åä½œçŠ¶æ€ï¼ŒAPI ä¸€è‡´         â”‚
â”‚  2. å£°æ˜å¼é€»è¾‘æµ      â”‚ å†…ç½® FSM/Statechartï¼ŒçŠ¶æ€è½¬æ¢å¯è§†åŒ–        â”‚
â”‚  3. ç»†ç²’åº¦å“åº”å¼      â”‚ Signal-like æ€§èƒ½ï¼Œæ— éœ€æ‰‹åŠ¨ä¼˜åŒ–             â”‚
â”‚  4. åä½œåŸç”Ÿæ”¯æŒ      â”‚ å¯é€‰å¼€å¯ CRDTï¼Œæ— éœ€åˆ‡æ¢åº“                  â”‚
â”‚  5. ç±»å‹å®‰å…¨          â”‚ TypeScript ä¼˜å…ˆï¼Œç¼–è¯‘æœŸæ•è·é”™è¯¯            â”‚
â”‚  6. å¼€å‘è€…ä½“éªŒ        â”‚ ä½é…ç½®æˆæœ¬ï¼Œ5 åˆ†é’Ÿä¸Šæ‰‹                      â”‚
â”‚  7. æ¡†æ¶æ— å…³          â”‚ React/Vue/Svelte/Solid é€šç”¨                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€â€œå¥‡ç‚¹â€çŠ¶æ€ç®¡ç†ç³»ç»Ÿè®¾è®¡æ„æƒ³

> æœ¬æ–‡å°†è¿™ä¸€é¢å‘æœªæ¥çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿå‘½åä¸ºâ€œå¥‡ç‚¹â€(Singularity)ã€‚
> å¯¼è¯»ï¼šç»™å‡ºè®¾è®¡åŸåˆ™ã€æ¶æ„åˆ†å±‚ä¸ API è®¾è®¡ã€‚

### 4.1 è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€æŠ½è±¡**ï¼šè®¾è®¡é€šç”¨ã€ŒState Nodeã€åŸè¯­ï¼Œå¯è¡¨è¾¾åŸå­ã€æ´¾ç”Ÿã€å¼‚æ­¥ã€åä½œçŠ¶æ€
2. **é€»è¾‘åˆ†ç¦»**ï¼šæŠŠ"æ•°æ®"ä¸"çŠ¶æ€æœº"ä½œä¸ºä¸¤ä¸ªæ­£äº¤ç»´åº¦
3. **æ¸è¿›å¢å¼º**ï¼šç®€å•åœºæ™¯æç®€ APIï¼Œå¤æ‚åœºæ™¯å¯æ’æ‹”æ‰©å±•
4. **å¯è§‚æµ‹æ€§ä¼˜å…ˆ**ï¼šæ‰€æœ‰çŠ¶æ€å˜æ›´å¯åºåˆ—åŒ–ã€å¯å›æ”¾

### 4.2 æŠ€æœ¯é€‰å‹

- **å“åº”å¼æ ¸å¿ƒ**ï¼šåŸºäº Signal çš„ç»†ç²’åº¦è®¢é˜…
- **é€»è¾‘å±‚**ï¼šå€Ÿé‰´ XState çš„ Statechartï¼Œä½†æ›´è½»é‡
- **åä½œå±‚**ï¼šå¯é€‰é›†æˆ Yjs
- **TypeScript**ï¼šç±»å‹æ¨æ–­é©±åŠ¨çš„ API è®¾è®¡

### 4.2.1 æ–¹æ¡ˆå¯¹æ¯”ä¸å–èˆ

| æ–¹æ¡ˆ               | ä¼˜åŠ¿                   | ä»£ä»·/é£é™©                    | å–èˆç»“è®º                   |
| :----------------- | :--------------------- | :--------------------------- | :------------------------- |
| **Signal**         | ç»†ç²’åº¦æ›´æ–°ã€æ€§èƒ½å¯é¢„æµ‹ | éœ€è¦é€‚é… React ç­‰æ¡†æ¶è°ƒåº¦    | ä½œä¸ºæ ¸å¿ƒå“åº”å¼åŸè¯­         |
| **Proxy**          | å†™æ³•è‡ªç„¶ã€ä¾µå…¥æ€§ä½     | éšå¼ä¾èµ–éš¾è¿½è¸ªã€è°ƒè¯•æˆæœ¬é«˜   | ä»…ä½œä¸ºå¯é€‰è¯­æ³•ç³–           |
| **Observable**     | å¼‚æ­¥å»ºæ¨¡èƒ½åŠ›å¼º         | å¿ƒæ™ºè´Ÿæ‹…å¤§ã€ç»„ä»¶é›†æˆéœ€èƒ¶æ°´å±‚ | ç”¨äºå¼‚æ­¥å±‚ï¼Œä¸ä½œä¸ºæ ¸å¿ƒçŠ¶æ€ |
| **Immutable Tree** | å¯é¢„æµ‹ã€åˆ©äºæ—¶é—´æ—…è¡Œ   | æ€§èƒ½ä¸å¿ƒæ™ºæˆæœ¬é«˜             | ç”¨äº DevToolsï¼Œè€Œéå¼ºçº¦æŸ  |

### 4.2.2 ç«äº‰ä¼˜åŠ¿ä¸å¿…ç„¶æƒè¡¡

- **æ˜æ˜¾æ›´å¼º**ï¼šç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹ã€é€»è¾‘/æ•°æ®è§£è€¦ã€åä½œåŸç”Ÿã€å¯è§‚æµ‹åè®®
- **å¯é¢„æœŸåŠ£åŠ¿**ï¼šåˆæœŸç”Ÿæ€ä¸æˆç†Ÿã€è¿ç§»éœ€è¦æ¡¥æ¥å±‚ã€æ¦‚å¿µè¾¹ç•Œæ›´å¤æ‚
- **æ€§èƒ½ä¸æ‰¿è¯ºå‹å€’æ€§é¢†å…ˆ**ï¼šç›®æ ‡æ˜¯ç¨³å®šå¯é¢„æµ‹ï¼Œè€Œéç»å¯¹è·‘åˆ†ç¬¬ä¸€

### 4.2.3 ä¸ä¸»æµæ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

| æ–¹æ¡ˆ              | ç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹ | å¯è§‚æµ‹æ€§ | é€»è¾‘/æ•°æ®è§£è€¦ | åä½œåŸç”Ÿ | è¿ç§»æˆæœ¬ |
| :---------------- | :----------: | :------: | :-----------: | :------: | :------: |
| **Redux Toolkit** |      â—       |    â—     |       â—       |    âœ•     |    â—     |
| **Zustand**       |      â—       |    â—     |       âœ•       |    âœ•     |    â—     |
| **Jotai**         |      â—       |    â—     |       âœ•       |    âœ•     |    â—     |
| **XState**        |      âœ•       |    â—     |       â—       |    âœ•     |    â—     |
| **React Query**   |      âœ•       |    â—     |       âœ•       |    âœ•     |    â—     |
| **Yjs**           |      âœ•       |    â—     |       âœ•       |    â—     |    âœ•     |
| **å¥‡ç‚¹**          |      â—       |    â—     |       â—       |    â—     |    â—     |

> å›¾ä¾‹ï¼šâ— å¼ºï¼Œâ— ä¸­ï¼Œâœ• å¼±ã€‚è¿ç§»æˆæœ¬è¶Šä½è¶Šå¥½ã€‚

### 4.3 API è®¾è®¡ (MVP)

```typescript
// æ¢¦æƒ³ä¸­çš„ API
import { atom, machine, atomAsync, atomSync } from 'singularity';

// 1. åŸå­çŠ¶æ€ (like Jotai)
const countAtom = atom(0);

// 2. å£°æ˜å¼çŠ¶æ€æœº (like XState, ä½†æ›´ç®€æ´)
const authMachine = machine({
  initial: 'idle',
  states: {
    idle: { on: { LOGIN: 'loading' } },
    loading: { on: { SUCCESS: 'authenticated', FAILURE: 'error' } },
    authenticated: { on: { LOGOUT: 'idle' } },
    error: { on: { RETRY: 'loading' } },
  },
});

// 3. æœåŠ¡ç«¯çŠ¶æ€ (like React Query, ä½†ç»Ÿä¸€ API)
const userAtom = atomAsync(fetchUser, { key: 'user:1' });

// 4. åä½œçŠ¶æ€ (CRDT built-in)
const docAtom = atomSync({ title: '', content: '' }, { id: 'doc:1' });
```

### 4.4 æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Framework Adapters                    â”‚
â”‚              (React / Vue / Svelte / Solid)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     State Layer                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Atom Core  â”‚  Machine    â”‚  Sync (CRDT)        â”‚  â”‚
â”‚   â”‚  (Signal)   â”‚  (FSM)      â”‚  (Yjs Integration)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Scheduler & Effects                    â”‚
â”‚            (Batching, Async, Subscriptions)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    DevTools Protocol                     â”‚
â”‚         (Time Travel, State Inspector, Logging)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 è¿ç§»ç­–ç•¥

- **å…¼å®¹å±‚**ï¼šæä¾›å¯¹ Redux/Zustand/Jotai çš„è¯»å–é€‚é…
- **åˆ†åŸŸè¿ç§»**ï¼šä»éæ ¸å¿ƒæ¨¡å—å¼€å§‹æ›¿æ¢ï¼Œæ”¯æŒå¹¶è¡Œè¿è¡Œ
- **å…±å­˜æœŸ**ï¼šæä¾›æ¡¥æ¥å·¥å…·ï¼Œå…è®¸æ—§çŠ¶æ€ä¸æ–°çŠ¶æ€äº’æ“ä½œ

#### è¿ç§»ç¤ºä¾‹ (Redux -> State Node)

```typescript
// legacy store
const legacyStore = configureStore({ reducer });

// bridge: read-only snapshot to State Node
const legacyState = fromStore(() => legacyStore.getState(), legacyStore.subscribe);
```

---

## äº”ã€å®æ–½è·¯çº¿å›¾

> å¯¼è¯»ï¼šå°†å®ç°æ‹†æˆé˜¶æ®µï¼Œä¾¿äºé‡Œç¨‹ç¢‘ç®¡ç†ä¸é£é™©æ§åˆ¶ã€‚

## å…­ã€æœ¯è¯­ä¸å®šä¹‰

> å¯¼è¯»ï¼šç»Ÿä¸€å…³é”®æœ¯è¯­ï¼Œå‡å°‘æ­§ä¹‰ã€‚

- **State Node**ï¼šå¯è®¢é˜…ã€å¯ç»„åˆçš„çŠ¶æ€å•å…ƒï¼ˆatom/computed/async/syncï¼‰ã€‚
- **Batch**ï¼šåœ¨å•ä¸€æ‰¹æ¬¡ä¸­åˆå¹¶å¤šæ¬¡å†™å…¥å¹¶ç»Ÿä¸€é€šçŸ¥ã€‚
- **TraceEvent**ï¼šå¯è§‚æµ‹äº‹ä»¶æµè®°å½•ã€‚


## ä¸ƒã€QA

> å¯¼è¯»ï¼šè®°å½•å…³é”®é—®ç­”ï¼Œå›ç­”åŸºäºæœ¬æ–‡æ—¢æœ‰å†…å®¹ä¸æ˜ç¡®çº¦æŸã€‚

> æœ¬èŠ‚è®°å½•å¯¹è¯ä¸­çš„å…³é”®é—®ç­”ï¼Œå›ç­”åŸºäºæœ¬æ–‡æ—¢æœ‰å†…å®¹ä¸æ˜ç¡®çº¦æŸã€‚

### 7.1 ç›®å‰ä¸–ç•Œä¸Šæ²¡æœ‰æˆ‘è¿™æ ·çš„é¡¹ç›®å—ï¼Ÿå¦‚æœæœ‰ç±»ä¼¼çš„ï¼Œæˆ‘è¿™ä¸ªå°±æ— æ„ä¹‰äº†ï¼Ÿ

**ç­”**ï¼šä¸æ˜¯æ²¡æœ‰â€œç±»ä¼¼ç‚¹â€ï¼Œä½†ç›®å‰çœ‹ä¸åˆ°ä¸€ä¸ªé¡¹ç›®åŒæ—¶æ»¡è¶³æœ¬æ–‡çš„å…³é”®çº¦æŸã€‚ç°æœ‰æ–¹æ¡ˆå¤§å¤šåªè¦†ç›–å•ç‚¹èƒ½åŠ›ï¼šä¾‹å¦‚ XState å¼ºåœ¨é€»è¾‘å±‚ï¼ŒReact Query å¼ºåœ¨å¼‚æ­¥/ç¼“å­˜ï¼ŒYjs å¼ºåœ¨åä½œï¼ŒSignal ç”Ÿæ€å¼ºåœ¨ç»†ç²’åº¦æ›´æ–°ã€‚ä½ çš„æ–‡æ¡£è¦è§£å†³çš„æ˜¯â€œç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹ + é€»è¾‘/æ•°æ®è§£è€¦ + åä½œåŸç”Ÿ + å¯è§‚æµ‹åè®® + è¿ç§»å¯è¡Œâ€çš„ç»„åˆé—®é¢˜ï¼Œè¿™ç§æ•´ä½“æ€§ç›®å‰å¤šä¾èµ–å¤šåº“æ‹¼æ¥è€Œéå•ä¸€ä½“ç³»ã€‚  
â€œæ— æ„ä¹‰â€ä¸å¦ä¸å–å†³äºâ€œæœ‰æ²¡æœ‰ç±»ä¼¼â€ï¼Œè€Œå–å†³äºä½ èƒ½å¦æä¾›ä¸¤ä¸ªå¯éªŒè¯çš„ä»·å€¼ï¼š  
1) **ç»Ÿä¸€æ€§**ï¼šç”¨åŒä¸€å¥—åŸè¯­è¦†ç›–æœ¬åœ°/æœåŠ¡ç«¯/åä½œçŠ¶æ€ï¼Œå‡å°‘æ¨¡å‹åˆ‡æ¢ä¸èƒ¶æ°´ä»£ç ï¼›  
2) **è¿ç§»å¯è¡Œæ€§**ï¼šè®©ç°æœ‰é¡¹ç›®èƒ½æ¸è¿›æ¥å…¥ï¼Œè€Œä¸æ˜¯æ¨å€’é‡æ¥ã€‚  
å¦‚æœè¿™ä¸¤ç‚¹åœ¨çœŸå®é¡¹ç›®é‡Œæˆç«‹ï¼Œå³ä¾¿å­˜åœ¨éƒ¨åˆ†ç›¸ä¼¼çš„æ–¹æ¡ˆï¼Œä½ çš„é¡¹ç›®ä»ç„¶æœ‰æ˜ç¡®ä»·å€¼ã€‚

### 7.2 æˆ‘çš„é¡¹ç›®èƒ½å¦æ”¯æŒç®€å•é¡¹ç›®å’Œè¶…å¤§å‹å‰ç«¯æ¶æ„é¡¹ç›®ï¼Ÿ

**ç­”**ï¼šä»æ–‡æ¡£ç›®æ ‡ä¸çº¦æŸæ¥çœ‹ï¼Œè®¾è®¡æ˜¯â€œå¯åŒæ—¶è¦†ç›–â€ï¼Œä½†æˆç«‹ä¸å¦å–å†³äºä¸¤æ¡è·¯å¾„æ˜¯å¦éƒ½èƒ½è¢«éªŒè¯ã€‚  
å¯¹**ç®€å•é¡¹ç›®**ï¼Œå…³é”®æ˜¯â€œä½å¿ƒæ™ºã€ä½é…ç½®ã€ä½ä½“ç§¯â€ã€‚æ–‡æ¡£ä¸­å·²ç»å¼ºè°ƒâ€œæ¸è¿›å¢å¼ºâ€â€œä½é…ç½®æˆæœ¬â€â€œå¯æ ‘æ‘‡â€ï¼Œå¹¶åœ¨è·¯çº¿å›¾ä¸­æŠŠ `atom/computed/batch` å®šä¹‰ä¸ºæœ€å°å¯ç”¨åŸè¯­ã€‚å¦‚æœæœ€ç»ˆ API èƒ½åšåˆ°â€œåªç”¨ atom ä¹Ÿä¸éœ€è¦ç†è§£æœºå™¨/åä½œå±‚â€ï¼Œå¹¶ä¸”é»˜è®¤æ€§èƒ½è¶³å¤Ÿï¼Œé‚£å°±èƒ½èƒœä»»å°é¡¹ç›®ã€‚  
å¯¹**è¶…å¤§å‹é¡¹ç›®**ï¼Œå…³é”®æ˜¯â€œå¯è§‚æµ‹æ€§ã€åˆ†åŸŸæ²»ç†ã€ä¸€è‡´æ€§ä¸æ€§èƒ½â€ã€‚å¦‚æœä½ æ˜ç¡®åªé¢å‘æœªæ¥æ–°é¡¹ç›®ï¼Œ**è¿ç§»è·¯å¾„ä¸æ˜¯å¿…éœ€æ¡ä»¶**ï¼Œä½†ä»éœ€è¦æ»¡è¶³ï¼š  
1) **å¯è§‚æµ‹æ€§**è¦†ç›–è·¨å›¢é˜Ÿåä½œçš„å®¡è®¡éœ€æ±‚ï¼ˆæ—¶é—´çº¿ã€å›æ”¾ã€ä¾èµ–å›¾ï¼‰ã€‚  
2) **åˆ†åŸŸæ²»ç†**å¯è®©ä¸åŒå›¢é˜Ÿåœ¨è¾¹ç•Œå†…ç‹¬ç«‹æ¼”è¿›ã€‚  
3) **ä¸€è‡´æ€§ä¸æ€§èƒ½**åœ¨ 1k+ è®¢é˜…ã€å¹¶å‘æ›´æ–°ä¸ SSR åœºæ™¯ä¸‹ç¨³å®šã€‚  
å› æ­¤ï¼Œç­”æ¡ˆæ˜¯â€œè®¾è®¡ä¸Šå¯æ”¯æŒï¼Œä½†å¿…é¡»é€šè¿‡åŸå‹ä¸çœŸå®é¡¹ç›®éªŒè¯â€ã€‚è‹¥ M0/M1 demo åœ¨å°é¡¹ç›®ä¸­ä¿æŒæç®€ä½“éªŒï¼ŒåŒæ—¶åœ¨å¤§å‹æ¶æ„ä¸­è¯æ˜å¯è§‚æµ‹ä¸åˆ†åŸŸæ²»ç†èƒ½åŠ›ï¼Œé‚£ä¹ˆä¸¤ç«¯éƒ½æˆç«‹ã€‚

### 7.3 èƒ½å¦åŒæ—¶æ”¯æŒ Vue å’Œ Reactï¼Ÿ

**ç­”**ï¼šå¯ä»¥ï¼Œä½†éœ€è¦æŠŠâ€œæ ¸å¿ƒâ€ä¸â€œé€‚é…å™¨â€ä¸¥æ ¼åˆ†å±‚ã€‚æ–‡æ¡£é‡Œå·²ç»å®šä¹‰äº† `@singularity/core` ä¸æ¡†æ¶é€‚é…å™¨çš„åŒ…ç»“æ„ï¼Œè¿™ç§æ¶æ„å¤©ç„¶æ”¯æŒå¤šæ¡†æ¶ï¼š  
1) **æ ¸å¿ƒå±‚**åªè´Ÿè´£çŠ¶æ€åŸè¯­ã€è°ƒåº¦ã€å¯è§‚æµ‹åè®®ï¼Œä¸ä¾èµ–ä»»ä½•æ¡†æ¶ï¼›  
2) **é€‚é…å™¨å±‚**åˆ†åˆ«å¯¹æ¥ React/Vue çš„æ¸²æŸ“ä¸è®¢é˜…æœºåˆ¶ã€‚  
å¯è¡Œæ€§å–å†³äºé€‚é…å™¨çš„è´¨é‡ä¸ä¸€è‡´æ€§è¯­ä¹‰èƒ½å¦ä¿æŒä¸€è‡´ï¼Œä½†ä»æ¶æ„ä¸Šæ˜¯å¯è¡Œä¸”ç¬¦åˆæœ¬æ–‡çº¦æŸçš„ã€‚

### 7.4 å¿ƒæ™ºæ¨¡å‹å’Œä¸Šæ‰‹éš¾åº¦èƒ½å¦æä¸ºç®€æ˜“ï¼Ÿ

**ç­”**ï¼šå¯ä»¥è®¾è®¡å¾—æç®€ï¼Œä½†å‰ææ˜¯â€œé»˜è®¤è·¯å¾„è¶³å¤ŸçŸ­ã€è¿›é˜¶åŠŸèƒ½å¯æ¨è¿Ÿç†è§£â€ã€‚æ–‡æ¡£å·²å¼ºè°ƒâ€œæ¸è¿›å¢å¼ºâ€â€œä½é…ç½®æˆæœ¬â€å’Œæœ€å°åŸè¯­ï¼Œè¿™æ„å‘³ç€æ–°ç”¨æˆ·åªéœ€ç†è§£ `atom/computed/batch` å°±èƒ½å®Œæˆå¤§å¤šæ•°å°é¡¹ç›®éœ€æ±‚ã€‚  
éš¾åº¦çš„å…³é”®ä¸åœ¨æ¦‚å¿µæ•°é‡ï¼Œè€Œåœ¨**æ˜¯å¦å¼ºè¿«ç†è§£å¤æ‚å±‚**ã€‚åªè¦çŠ¶æ€æœºã€åä½œã€å¼‚æ­¥ç¼“å­˜éƒ½ä¿æŒâ€œæŒ‰éœ€å¯ç”¨â€ï¼Œå¹¶ä¸”é»˜è®¤æ¡ˆä¾‹ä¸æ¶‰åŠå®ƒä»¬ï¼Œä¸Šæ‰‹å°±èƒ½ä¿æŒæç®€ã€‚  
æ‰€ä»¥ï¼Œç»“è®ºæ˜¯â€œå¯ä»¥åšåˆ°æç®€â€ï¼Œä½†éœ€è¦åœ¨ API è®¾è®¡ä¸æ–‡æ¡£ä¸­æ˜ç¡®**é»˜è®¤è·¯å¾„**ä¸**è¿›é˜¶è·¯å¾„**çš„è¾¹ç•Œã€‚

---


> å¯¼è¯»ï¼šå°†å®ç°æ‹†æˆé˜¶æ®µï¼Œä¾¿äºé‡Œç¨‹ç¢‘ç®¡ç†ä¸é£é™©æ§åˆ¶ã€‚

### Phase 1: æ ¸å¿ƒåŸè¯­ (Week 1-2)

- [ ] å®ç° `atom()` - åŸºäº Signal çš„å“åº”å¼åŸå­
- [ ] å®ç° `computed()` - æ´¾ç”ŸçŠ¶æ€
- [ ] å®ç°åŸºç¡€è®¢é˜…æœºåˆ¶
- [ ] æœ€å°å¯è§‚æµ‹æ€§ï¼šå˜æ›´æ—¥å¿—ä¸è®¢é˜…ç»Ÿè®¡æ¥å£

### Phase 2: çŠ¶æ€æœºé›†æˆ (Week 3-4)

- [ ] å®ç° `machine()` - è½»é‡çº§ FSM
- [ ] çŠ¶æ€æœºä¸ atom çš„ç»‘å®š
- [ ] å‰¯ä½œç”¨è°ƒåº¦ä¸å–æ¶ˆè¯­ä¹‰ (effect lifecycle)
- [ ] å¯è§†åŒ–å·¥å…·æ¥å£

### Phase 3: å¼‚æ­¥ä¸æœåŠ¡ç«¯çŠ¶æ€ (Week 5-6)

- [ ] å®ç° `atomAsync()` - å¼‚æ­¥æ•°æ®è·å–
- [ ] ç¼“å­˜ç­–ç•¥ä¸ä¹è§‚æ›´æ–°
- [ ] é”™è¯¯è¾¹ç•Œå¤„ç†
- [ ] CRDT å…¼å®¹æ•°æ®æ¨¡å‹ PoC (éªŒè¯åºåˆ—åŒ–ä¸åˆå¹¶ç­–ç•¥)

### Phase 4: åä½œæ”¯æŒ (Week 7-8)

- [ ] å®ç° `atomSync()` - CRDT é›†æˆ
- [ ] Yjs é€‚é…å™¨
- [ ] å†²çªè§£å†³ç­–ç•¥

### Phase 5: æ¡†æ¶é€‚é… (Week 9-10)

- [ ] React é€‚é…å™¨ (`@singularity/react`) - æœ€å°å¯ç”¨ç‰ˆæœ¬
- [ ] DevTools æ‰©å±•
- [ ] Vue é€‚é…å™¨ (`@singularity/vue`)

### é‡Œç¨‹ç¢‘ (M0/M1/M2)

- **M0 (Week 2)**ï¼š`atom()`/`computed()` å¯ç”¨ï¼Œæœ€å°å¯è§‚æµ‹æ€§å®Œæˆ
- **M1 (Week 6)**ï¼š`machine()`/`atomAsync()` å¯ç”¨ï¼Œeffect è¯­ä¹‰ç¨³å®š
- **M2 (Week 10)**ï¼š`atomSync()` ä¸ React é€‚é…å™¨å¯ç”¨ï¼ŒDevTools å¯ç”¨

### å…³é”®é£é™©ä¸ä¾èµ–

- **CRDT è®¾è®¡å‰ç½®**ï¼šæ•°æ®æ¨¡å‹ä¸€æ—¦å®šå‹ï¼ŒåæœŸæ”¹åŠ¨æˆæœ¬é«˜
- **è°ƒåº¦ä¸€è‡´æ€§**ï¼šå¹¶å‘æ¸²æŸ“/SSR ä¸å¼‚æ­¥å–æ¶ˆè¯­ä¹‰è¦é¿å…æ­§ä¹‰
- **ç”Ÿæ€æ¥å…¥æˆæœ¬**ï¼šè¿ç§»ç­–ç•¥ä¸æ¡¥æ¥å±‚å¿…é¡»åŒæ—¶éªŒè¯

### äº¤ä»˜é£é™©ä¸è½åœ°ç­–ç•¥

**é«˜é£é™© 1ï¼šåä½œå±‚ CRDT æ€§èƒ½ä¸æ•°æ®æ¨¡å‹**
- **ç­–ç•¥**ï¼šå…ˆåšæœ€å°å¯ç”¨ PoCï¼ˆå°è§„æ¨¡æ–‡æ¡£/å°‘é‡å­—æ®µï¼‰ï¼ŒéªŒè¯åˆå¹¶ä¸å›æ”¾ã€‚
- **äº¤ä»˜ä¿éšœ**ï¼šCRDT ä½œä¸º M2 å¯é€‰èƒ½åŠ›ï¼Œé»˜è®¤å…³é—­ã€‚

**é«˜é£é™© 2ï¼šDevTools å…¨é‡æ—¶é—´çº¿æ€§èƒ½**
- **ç­–ç•¥**ï¼šé»˜è®¤å¯ç”¨ `minimal` é‡‡æ ·æ¨¡å¼ï¼Œä»…è®°å½• write/async äº‹ä»¶ã€‚
- **äº¤ä»˜ä¿éšœ**ï¼šå…¨é‡æ—¶é—´çº¿ä½œä¸ºå®éªŒåŠŸèƒ½ï¼Œå…ˆä¿è¯å¯¼å‡ºä¸å›æ”¾ã€‚

**é«˜é£é™© 3ï¼šå¼‚æ­¥ç¼“å­˜/å–æ¶ˆ/è¿‡æœŸè¾¹ç•Œ**
- **ç­–ç•¥**ï¼šå…ˆé”å®šæœ€å°è¯­ä¹‰ï¼ˆå»é‡ + å–æ¶ˆ + staleTimeï¼‰ï¼Œä¸å¼•å…¥å¤æ‚ç­–ç•¥ã€‚
- **äº¤ä»˜ä¿éšœ**ï¼šå¤æ‚ç­–ç•¥ï¼ˆé‡è¯•é€€é¿ã€ä¹è§‚å›æ»šï¼‰åç½®åˆ°æ¬¡ç‰ˆæœ¬ã€‚

### é‡Œç¨‹ç¢‘éªŒæ”¶æ ‡å‡†

- **M0 é€šè¿‡**ï¼šåŸè¯­ API è¦†ç›–åŸºæœ¬ç”¨ä¾‹ï¼Œå˜æ›´æ—¥å¿—å¯è¿½è¸ªï¼Œè®¢é˜…ç»Ÿè®¡å¯å¯¼å‡º
- **M1 é€šè¿‡**ï¼šçŠ¶æ€æœº/å¼‚æ­¥åœºæ™¯æœ‰æœ€å°ç¤ºä¾‹ï¼Œeffect ç”Ÿå‘½å‘¨æœŸæ–‡æ¡£æ¸…æ™°
- **M2 é€šè¿‡**ï¼šReact é€‚é…å™¨å®Œæˆæœ€å° demoï¼ŒDevTools å¯æŸ¥çœ‹çŠ¶æ€è½¨è¿¹

### Demo åœºæ™¯æ¸…å•

- **M0 Demo**ï¼šè®¡æ•°å™¨ + æ´¾ç”ŸçŠ¶æ€ + æ‰¹é‡æ›´æ–°æ¼”ç¤º
- **M1 Demo**ï¼šç™»å½•çŠ¶æ€æœº + å¼‚æ­¥è¯·æ±‚ + å–æ¶ˆä¸é‡è¯•
- **M2 Demo**ï¼šå¤šäººåä½œæ–‡æ¡£ + React ç»„ä»¶é›†æˆ + DevTools å›æ”¾

### Demo éªŒæ”¶æ­¥éª¤

- **M0 Demo**ï¼šç‚¹å‡» 100 æ¬¡ç´¯è®¡æ›´æ–°ä¸€æ¬¡æ¸²æŸ“ï¼Œæ—¥å¿—å¯å¯¼å‡ºä¸º JSON
- **M1 Demo**ï¼šè§¦å‘ç™»å½•åç«‹å³å–æ¶ˆï¼ŒçŠ¶æ€æœºå›åˆ° idle ä¸”æ— æ‚¬æŒ‚è¯·æ±‚
- **M2 Demo**ï¼šä¸¤ç«¯åŒæ—¶ç¼–è¾‘ï¼Œå†²çªè‡ªåŠ¨åˆå¹¶ï¼Œæ—¶é—´çº¿å¯å›æ”¾

### æ€§èƒ½åŸºçº¿ (åˆç‰ˆ)

- **è®¢é˜…å¼€é”€**ï¼š1k è®¢é˜…ä¸‹æ›´æ–°å»¶è¿Ÿç¨³å®šï¼Œå¯è§‚æµ‹æ—¥å¿—ä¸æ˜¾è‘—æ‹–æ…¢æ¸²æŸ“
- **æ‰¹å¤„ç†æ€§èƒ½**ï¼šè¿ç»­ 1k æ¬¡æ›´æ–°åˆå¹¶ä¸ºå•æ¬¡æ¸²æŸ“
- **å¼‚æ­¥åå**ï¼šå¹¶å‘ 100 ä¸ªè¯·æ±‚æ—¶å–æ¶ˆè¯­ä¹‰ç¨³å®šã€æ— å†…å­˜æ³„æ¼

### Benchmark ç¯å¢ƒä¸å£å¾„ (åˆç‰ˆ)

- **ç¯å¢ƒ**ï¼šMacBook Pro M1 / 16GB / Chrome Stable
- **åœºæ™¯**ï¼š1k è®¢é˜…ã€1k è¿ç»­æ›´æ–°ã€100 å¹¶å‘å¼‚æ­¥è¯·æ±‚
- **å£å¾„**ï¼šä½¿ç”¨ Performance API ç»Ÿè®¡æ›´æ–°è€—æ—¶ï¼Œè®°å½•å‡å€¼ä¸ P95

### Benchmark é‡‡æ ·è„šæœ¬ (ç¤ºä¾‹)

```typescript
// pseudo-benchmark for devtools panel or playground
const marks: number[] = [];

function measure(label: string, fn: () => void) {
  const start = performance.now();
  fn();
  const end = performance.now();
  marks.push(end - start);
  console.log(label, end - start);
}

measure('batch-1000', () => {
  batch(() => {
    for (let i = 0; i < 1000; i += 1) {
      counterAtom.set((n) => n + 1);
    }
  });
});

const p95 = marks.sort((a, b) => a - b)[Math.floor(marks.length * 0.95)];
console.log('p95', p95);
```

---

## é™„å½• Aã€æŠ€æœ¯æ–¹æ¡ˆä¸å®æ–½çº²è¦ (å¯ç›´æ¥ç”¨äºå¼€å‘)

### æ–¹æ¡ˆæ¦‚è¿°

- **å®šä½**ï¼šä»¥ç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹è¦†ç›–æœ¬åœ°/å¼‚æ­¥/åä½œçŠ¶æ€
- **æ ¸å¿ƒèƒ½åŠ›**ï¼šç»†ç²’åº¦å“åº” + å¯é¢„æµ‹è°ƒåº¦ + å¯è§‚æµ‹åè®®
- **è·¨æ¡†æ¶**ï¼šæ ¸å¿ƒæ— æ¡†æ¶ä¾èµ–ï¼Œé€‚é…å±‚å¯¹æ¥ React/Vue

### æ ¸å¿ƒæ¨¡å—ä¸èŒè´£

| æ¨¡å— | è´£ä»» | å…³é”®æ¥å£ |
| :--- | :--- | :------- |
| **Core** | åŸè¯­ã€ä¾èµ–å›¾ã€è®¢é˜… | `atom/computed/batch/effect` |
| **Async** | ç¼“å­˜/å»é‡/å–æ¶ˆ | `atomAsync` |
| **Machine** | é€»è¾‘æµä¸çŠ¶æ€è½¬ç§» | `machine` |
| **Sync** | åä½œä¸åˆå¹¶ | `atomSync` |
| **DevTools** | äº‹ä»¶ä¸å¿«ç…§ | `TraceEvent/TraceExport` |
| **Adapters** | æ¡†æ¶è®¢é˜…é€‚é… | `useAtom/useAtomRef` |

### è°ƒåº¦ä¸ä¸€è‡´æ€§ç»†åˆ™

- **æ‰¹æ¬¡å¿«ç…§**ï¼šåŒæ‰¹æ¬¡å†…è¯»åˆ°æ‰¹æ¬¡èµ·ç‚¹çŠ¶æ€
- **æ›´æ–°é¡ºåº**ï¼šå†™å…¥ -> computed -> effect -> é€šçŸ¥
- **å¼‚æ­¥è§„åˆ™**ï¼šåŒ key å»é‡ï¼›è¿‡æœŸå“åº”ä¸¢å¼ƒ
- **åä½œåˆå¹¶**ï¼šCRDT åˆå¹¶ï¼Œä¸ä¿è¯ LWW

### DevTools äº‹ä»¶æ¨¡å‹

```typescript
type TraceExport = {
  protocolVersion: string;
  events: TraceEvent[];
  snapshots: TraceSnapshot[];
};
```

**è½åœ°è¦æ±‚**ï¼š
- äº‹ä»¶å¿…é¡»å¯åºåˆ—åŒ–
- æ”¯æŒæœ€å°é‡‡æ ·æ¨¡å¼ `minimal`
- å¯¼å‡ºå†…å®¹åŒ…å«ç‰ˆæœ¬å­—æ®µ

---

## é™„å½• Bã€å®ç°è·¯çº¿å›¾ (å·¥ç¨‹çº§ç»†åŒ–)

### Phase 1: Core MVP (Week 1-2)

- [ ] atom/computed/batch/effect åŸå‹
- [ ] ä¾èµ–å›¾è¿½è¸ªä¸è®¢é˜…æœºåˆ¶
- [ ] TraceEvent é‡‡é›†ï¼ˆwrite/effectï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼šå¾ªç¯ä¾èµ–ã€batch åˆå¹¶

### Phase 2: Machine MVP (Week 3-4)

- [ ] machine çŠ¶æ€æœºæ‰§è¡Œå™¨
- [ ] entry/exit è¯­ä¹‰ + FIFO äº‹ä»¶å¤„ç†
- [ ] effect ç”Ÿå‘½å‘¨æœŸå®šä¹‰
- [ ] Demoï¼šç™»å½•çŠ¶æ€æœº

### Phase 3: Async MVP (Week 5-6)

- [ ] atomAsync å»é‡/å–æ¶ˆ/staleTime
- [ ] error/status åŸå­
- [ ] Demoï¼šè¯·æ±‚ + å–æ¶ˆ + é‡è¯•
- [ ] Benchmarkï¼šå¹¶å‘ 100 è¯·æ±‚

### Phase 4: Sync PoC (Week 7-8)

- [ ] atomSync åŸå‹
- [ ] CRDT åˆå¹¶ PoCï¼ˆå°è§„æ¨¡ï¼‰
- [ ] TraceEvent åŒæ­¥å›æ”¾
- [ ] Demoï¼šåä½œæ–‡æ¡£å°æ ·

### Phase 5: Adapters + DevTools (Week 9-10)

- [ ] React æœ€å° Hook é€‚é…å™¨
- [ ] Vue ref é€‚é…å™¨
- [ ] DevTools é¢æ¿åŸå‹
- [ ] æ€§èƒ½é‡‡æ ·æ¨¡å¼

---

## é™„å½• Cã€æ¶æ„å›¾ (å·¥ç¨‹è½åœ°è§†è§’)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Framework Adapters                    â”‚
â”‚              (React / Vue / Svelte / Solid)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     State Layer                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Atom Core  â”‚  Machine    â”‚  Sync (CRDT)        â”‚  â”‚
â”‚   â”‚  (Signal)   â”‚  (FSM)      â”‚  (Yjs Integration)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Scheduler & Effects                    â”‚
â”‚            (Batching, Async, Subscriptions)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    DevTools Protocol                     â”‚
â”‚         (Time Travel, State Inspector, Logging)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é™„å½• Dã€é‡Œç¨‹ç¢‘ä¸éªŒæ”¶æ ‡å‡† (å·¥ç¨‹ç‰ˆ)

### M0 (Week 2)

- atom/computed/batch å¯è¿è¡Œ
- TraceEvent é‡‡é›† write/effect
- Demoï¼šè®¡æ•°å™¨ + batch æ¸²æŸ“åˆå¹¶

### M1 (Week 6)

- machine + atomAsync å¯è¿è¡Œ
- effect ç”Ÿå‘½å‘¨æœŸä¸ error æ¨¡å‹ç¨³å®š
- Demoï¼šç™»å½•æµç¨‹ + å¼‚æ­¥å–æ¶ˆ

### M2 (Week 10)

- atomSync PoC å¯é€‰å¯ç”¨
- React é€‚é…å™¨æœ€å°ç‰ˆæœ¬å¯ç”¨
- DevTools é¢æ¿å¯å›æ”¾

---

## é™„å½• Eã€äº§å‡ºç‰©æ¨¡æ¿ (å·¥ç¨‹çº§)

### æ¨¡æ¿ Aï¼šé˜¶æ®µäº¤ä»˜è¯´æ˜

```
é˜¶æ®µ:
èŒƒå›´:
å®Œæˆé¡¹:
æœªå®Œæˆé¡¹:
é£é™©:
ä¸‹ä¸€æ­¥:
```

### æ¨¡æ¿ Bï¼šAPI å˜æ›´è®°å½•

```
ç‰ˆæœ¬:
å˜æ›´ç±»å‹: æ–°å¢ / ä¿®æ”¹ / åˆ é™¤
API åç§°:
å˜æ›´è¯´æ˜:
è¿ç§»æŒ‡å¼•:
é£é™©:
```

### æ¨¡æ¿ Cï¼šBenchmark æŠ¥å‘Š

```
ç¯å¢ƒ:
åœºæ™¯:
æ•°æ®è§„æ¨¡:
å‡å€¼:
P95:
å†…å­˜å·®:
ç»“è®º:
```

### æ¨¡æ¿ Dï¼šDemo éªŒæ”¶æŠ¥å‘Š

```
Demo:
éªŒæ”¶é¡¹:
ç»“æœ:
å¤±è´¥åŸå› :
ä¿®å¤è®¡åˆ’:
```

### æ¨¡æ¿ Eï¼šå‘å¸ƒæ¸…å•

```
ç‰ˆæœ¬:
æ ¸å¿ƒ API:
æ–‡æ¡£:
æµ‹è¯•:
å…¼å®¹æ€§:
å·²çŸ¥é—®é¢˜:
```

## å…«ã€API ç»†èŠ‚ä¸ä¸€è‡´æ€§è¯­ä¹‰

> å¯¼è¯»ï¼šç»†åŒ– API ä¸ä¸€è‡´æ€§è¯­ä¹‰ï¼Œä¸ºå®ç°æä¾›ç¡¬è§„åˆ™ã€‚

### 8.1 çŠ¶æ€ç±»å‹ä¸ç”Ÿå‘½å‘¨æœŸ

- **atom**ï¼šå¯å˜çš„åŸå­å€¼ï¼Œå…è®¸åŒæ­¥æ›´æ–°ä¸è®¢é˜…
- **computed**ï¼šæ´¾ç”Ÿå€¼ï¼Œä¾èµ–å›¾è‡ªåŠ¨è¿½è¸ªï¼Œåªè¯»
- **async atom**ï¼šå¸¦ç¼“å­˜ä¸å–æ¶ˆè¯­ä¹‰çš„å¼‚æ­¥çŠ¶æ€
- **sync atom**ï¼šä¸ CRDT ç»‘å®šçš„åä½œçŠ¶æ€ï¼Œå¯é€‰æ‹©ç¦»çº¿åˆå¹¶

### 8.2 ä¸€è‡´æ€§è¯­ä¹‰ (åˆç‰ˆ)

- **è¯»ä¸€è‡´æ€§**ï¼šåŒä¸€æ‰¹æ¬¡å†…è¯»åˆ°çš„æ˜¯æ‰¹æ¬¡å¼€å§‹æ—¶çš„å¿«ç…§
- **å†™åˆå¹¶**ï¼šåŒä¸€æ‰¹æ¬¡å†…å¤šæ¬¡å†™åˆå¹¶ä¸ºä¸€æ¬¡é€šçŸ¥
- **å¼‚æ­¥å–æ¶ˆ**ï¼šæ–°è¯·æ±‚è§¦å‘æ—¶å¯å–æ¶ˆæ—§è¯·æ±‚ï¼Œé¿å…è¿‡æœŸå†™å…¥
- **åä½œåˆå¹¶**ï¼šå†²çªæŒ‰ CRDT è§„åˆ™åˆå¹¶ï¼Œç»“æœå¯å›æ”¾

### 8.3 é”™è¯¯æ¨¡å‹

- **åŒæ­¥é”™è¯¯**ï¼šæŠ›å‡ºåˆ°è°ƒç”¨æ–¹ï¼Œå¯ç”±è¾¹ç•Œç»„ä»¶æ•è·
- **å¼‚æ­¥é”™è¯¯**ï¼šä¿å­˜åœ¨çŠ¶æ€èŠ‚ç‚¹çš„ error å­—æ®µï¼Œå¯è®¢é˜…
- **åä½œé”™è¯¯**ï¼šç½‘ç»œ/åˆå¹¶å¤±è´¥ä»¥äº‹ä»¶æµæš´éœ²ï¼Œä¸é˜»æ–­æœ¬åœ°å†™å…¥

### 8.4 æœ€å°å®ç°æ¸…å• (MVP)

- **æ ¸å¿ƒ**ï¼šatom/computed + è®¢é˜… + æ‰¹å¤„ç†
- **è°ƒåº¦**ï¼šeffect ç”Ÿå‘½å‘¨æœŸä¸å–æ¶ˆè¯­ä¹‰
- **å¯è§‚æµ‹æ€§**ï¼šå˜æ›´æ—¥å¿— + è®¢é˜…ç»Ÿè®¡ + æ—¶é—´çº¿æ¥å£
- **é€‚é…å™¨**ï¼šReact æœ€å° Hook å±‚

### 8.5 Async ç¼“å­˜ä¸å¤±æ•ˆç­–ç•¥ (åˆç‰ˆ)

- **ç¼“å­˜é”®**ï¼š`atomAsync(fetcher, { key })` æ˜¾å¼ keyï¼Œé¿å…éšå¼ä¾èµ–
- **staleTime**ï¼šè¿‡æœŸå‰è¯»ç¼“å­˜ï¼Œè¿‡æœŸåè¿”å›ç¼“å­˜å¹¶è§¦å‘åˆ·æ–°
- **cacheTime**ï¼šæ— äººè®¢é˜…åå»¶è¿Ÿå›æ”¶
- **retry**ï¼šå¯é…ç½®é‡è¯•æ¬¡æ•°ä¸é€€é¿ç­–ç•¥
- **optimistic**ï¼šå…è®¸å…ˆå†™å…¥æœ¬åœ°å€¼ï¼Œå¤±è´¥æ—¶å›æ»š
- **dedupe**ï¼šåŒ key å¹¶å‘è¯·æ±‚åˆå¹¶ä¸ºå•æ¬¡ç½‘ç»œè°ƒç”¨

### 8.6 DevTools åè®® (æœ€å°å­—æ®µ)

```typescript
type TraceEvent = {
  id: string;
  ts: number;
  type: 'read' | 'write' | 'effect' | 'async' | 'sync';
  nodeId: string;
  payload?: unknown;
  batchId?: string;
  error?: string;
};

type TraceSnapshot = {
  nodes: Record<string, unknown>;
  edges: Array<{ from: string; to: string }>;
};
```

### 8.7 SSR ä¸å¹¶å‘æ¸²æŸ“è¯­ä¹‰ (åˆç‰ˆ)

- **è¯·æ±‚éš”ç¦»**ï¼šæ¯ä¸ª SSR è¯·æ±‚æ‹¥æœ‰ç‹¬ç«‹ store å®ä¾‹
- **æƒ°æ€§åˆå§‹åŒ–**ï¼šåªæœ‰è¢«è®¿é—®çš„èŠ‚ç‚¹æ‰åˆ›å»º
- **hydration**ï¼šå®¢æˆ·ç«¯ä¼˜å…ˆä½¿ç”¨æœåŠ¡ç«¯å¿«ç…§ï¼Œé¿å…é—ªçƒ
- **å¹¶å‘ä¸€è‡´æ€§**ï¼šå¹¶å‘æ¸²æŸ“ä¸­è¯»åˆ°ä¸€è‡´å¿«ç…§ï¼Œæäº¤åå†è§¦å‘é€šçŸ¥

---

## ä¹ã€ç‰ˆæœ¬åŒ–ä¸å‘å¸ƒç­–ç•¥

> å¯¼è¯»ï¼šè¯´æ˜åŒ…ç»“æ„ä¸ç‰ˆæœ¬ç­–ç•¥ï¼Œæ˜ç¡®å‘å¸ƒèŠ‚å¥ã€‚

### 9.1 åŒ…ç»“æ„

- `@singularity/core`ï¼šæ ¸å¿ƒåŸè¯­ä¸è°ƒåº¦
- `@singularity/react`ï¼šReact é€‚é…å™¨
- `@singularity/devtools`ï¼šDevTools åè®®ä¸é¢æ¿
- `@singularity/sync`ï¼šåä½œå±‚ (CRDT é€‚é…)

### 9.2 è¯­ä¹‰ç‰ˆæœ¬ä¸å…¼å®¹æ‰¿è¯º

- **0.x**ï¼šAPI å¯å¿«é€Ÿè¿­ä»£ï¼Œä¸ä¿è¯å…¼å®¹
- **1.0**ï¼šæ ¸å¿ƒ API ç¨³å®šï¼Œç ´åæ€§å˜æ›´æŒ‰ä¸»ç‰ˆæœ¬å‘å¸ƒ
- **é€‚é…å™¨**ï¼šä¸æ ¸å¿ƒç‰ˆæœ¬å¯¹é½ï¼Œä¿æŒåŒä¸€ä¸»ç‰ˆæœ¬

### 9.3 å‘å¸ƒèŠ‚å¥

- **æ ¸å¿ƒä¼˜å…ˆ**ï¼šæ ¸å¿ƒç¨³å®šåå†æ‰©å±•é€‚é…å™¨ä¸åä½œå±‚
- **beta é€šé“**ï¼šæä¾› `-beta` ç‰ˆæœ¬ç”¨äºè¯•éªŒæ–°è¯­ä¹‰

### 9.4 å…¼å®¹ä¸å¼ƒç”¨ç­–ç•¥

- **å¼ƒç”¨å‘¨æœŸ**ï¼šè‡³å°‘ä¸€ä¸ªæ¬¡ç‰ˆæœ¬å‘¨æœŸçš„ deprecate æç¤º
- **æ–‡æ¡£åŒæ­¥**ï¼šå¼ƒç”¨è¯´æ˜ä¸è¿ç§»æŒ‡å¼•åŒæ—¶å‘å¸ƒ
- **LTS**ï¼šæ ¸å¿ƒç¨³å®šåå¯è€ƒè™‘ LTS åˆ†æ”¯

---

## åã€æ–‡æ¡£ç»“æ„å»ºè®®

> å¯¼è¯»ï¼šè§„åˆ’å¯¹å¤–æ–‡æ¡£ç»“æ„ï¼Œä¾¿äºä¼ æ’­ä¸ä½¿ç”¨ã€‚

### 10.1 å¿«é€Ÿä¸Šæ‰‹

- 5 åˆ†é’Ÿå…¥é—¨ï¼šatom/computed/batch
- ç¬¬ä¸€ä¸ªçŠ¶æ€æœº + å¼‚æ­¥è¯·æ±‚

### 10.2 æ¦‚å¿µæ¨¡å‹

- State Node æŠ½è±¡
- é€»è¾‘å±‚ä¸æ•°æ®å±‚
- ä¸€è‡´æ€§ä¸è°ƒåº¦è¯­ä¹‰

### 10.3 è¿ç§»æŒ‡å—

- Redux / Zustand / Jotai è¿ç§»è·¯å¾„
- å…±å­˜ä¸æ¡¥æ¥ç­–ç•¥

### 10.4 è°ƒè¯•ä¸æ€§èƒ½

- DevTools ä½¿ç”¨
- æ€§èƒ½åŸºçº¿ä¸ä¼˜åŒ–å»ºè®®

### 10.5 æ–‡æ¡£ç»„ç»‡å»ºè®®

- **å¯¼èˆª**ï¼šæ¦‚å¿µ > å¿«é€Ÿä¸Šæ‰‹ > API > å®è·µ
- **ç‰ˆæœ¬**ï¼šæ¯ä¸ªç‰ˆæœ¬ä¿ç•™å¯¹åº”æ–‡æ¡£å¿«ç…§

---

## åä¸€ã€æ–‡æ¡£è¯„å®¡ä¸æ”¹è¿›å»ºè®®

> å¯¼è¯»ï¼šè¯„å®¡ä¸åæ€åŒºï¼Œä¸ä½œä¸ºæœ€ç»ˆè§„èŒƒã€‚

> æœ¬ç« èŠ‚ä¸º AI è¾…åŠ©ç”Ÿæˆçš„æ–‡æ¡£è¯„å®¡ï¼Œæ—¨åœ¨æä¾›å®¢è§‚çš„è´¨é‡è¯„ä¼°ä¸å¯æ‰§è¡Œçš„æ”¹è¿›å»ºè®®ã€‚

### 11.1 æ–‡æ¡£è´¨é‡è¯„ä¼°

| ç»´åº¦         |    è¯„åˆ†    | è¯„ä»·                                   |
| :----------- | :--------: | :------------------------------------- |
| **å®Œæ•´æ€§**   | â­â­â­â­â­ | å‡ ä¹æ¶µç›–äº†æ‰€æœ‰ä¸»æµå’Œå°ä¼—æ–¹æ¡ˆï¼Œåˆ†ç±»åˆç† |
| **æ·±åº¦**     |  â­â­â­â­  | æ¯ä¸ªåº“éƒ½æœ‰æ ¸å¿ƒåŸç†ä»£ç ç¤ºä¾‹ï¼Œéå¸¸å®ç”¨   |
| **å‰ç»æ€§**   | â­â­â­â­â­ | "å¥‡ç‚¹æ„æƒ³"éƒ¨åˆ†æœ‰ç‹¬åˆ°è§è§£               |
| **å®ç”¨æ€§**   |  â­â­â­â­  | å¿«é€Ÿé€‰æ‹©æŒ‡å—ã€è¿ç§»ç­–ç•¥éƒ½å¾ˆåŠ¡å®         |
| **å¯æ‰§è¡Œæ€§** |   â­â­â­   | è·¯çº¿å›¾è¾ƒä¹è§‚ï¼Œéœ€æ›´å¤šé£é™©ç¼“å†²           |

### 11.2 æ ¸å¿ƒäº®ç‚¹

1. **é—®é¢˜è¯Šæ–­ç²¾å‡†**
   - å‡†ç¡®æŠ“ä½"èŒƒå¼å‰²è£‚"ç—›ç‚¹ï¼šZustand ç®¡æœ¬åœ°ã€React
     Query ç®¡æœåŠ¡ç«¯ã€XState ç®¡é€»è¾‘ã€Yjs ç®¡åä½œâ€”â€”éœ€è¦"ç»„åˆæ‹³"
   - "è¿™ä¸ªæ•°æ®æ˜¯æœåŠ¡ç«¯çš„è¿˜æ˜¯å®¢æˆ·ç«¯çš„ï¼Ÿ"è¿™ä¸ªé—®é¢˜æ¯å¤©å›°æ‰°æ— æ•°å¼€å‘è€…

2. **"å¥‡ç‚¹"çš„å®šä½æ¸…æ™°**

   ```
   ç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹ > å¯è§‚æµ‹æ€§ > é€»è¾‘/æ•°æ®è§£è€¦ > åä½œåŸç”Ÿ
   ```

   å››ä¸ªç›®æ ‡æ’åºåˆç†ï¼Œä½“ç°äº†**ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜**è€Œéç¼ç¼è¡¥è¡¥çš„æ€è·¯ã€‚

3. **API è®¾è®¡åŠ¡å®**
   ```typescript
   const docAtom = atomSync({ title: '', content: '' }, { id: 'doc:1' });
   ```
   "æ¸è¿›å¢å¼º"çš„ API è®¾è®¡ï¼ˆ`atom` â†’ `atomAsync` â†’ `atomSync`ï¼‰æ˜¯æ­£ç¡®çš„æ–¹å‘ã€‚

### 11.3 æ½œåœ¨é£é™©ä¸å»ºè®®

#### é£é™© 1ï¼šæ—¶é—´è¡¨è¿‡äºä¹è§‚

- **é—®é¢˜**ï¼š10 å‘¨ä»é›¶åˆ° React é€‚é…å™¨ + DevTools + CRDT åä½œï¼Ÿè¿™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„
- **å»ºè®®**ï¼šM0 å‘¨æœŸç¿»å€ï¼ŒCRDT é›†æˆä½œä¸º v1.1 è€Œé v1.0 ç›®æ ‡

#### é£é™© 2ï¼š"ç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹"çš„æ‚–è®º

- **é—®é¢˜**ï¼šæ–‡æ¡£è¿½æ±‚"ä¸€ä¸ªæŠ½è±¡è§£å†³æ‰€æœ‰é—®é¢˜"ï¼Œä½†å†å²è¯æ˜â€”â€”ä¸€æ—¦æŠ½è±¡è¶³å¤Ÿé€šç”¨ï¼Œå®ƒå°±ä¼šå˜å¾—å’Œ Redux ä¸€æ ·å¤æ‚
- **å»ºè®®**ï¼šæ˜ç¡®"ä¸ç»Ÿä¸€ä»€ä¹ˆ"â€”â€”ä¾‹å¦‚è¡¨å•çŠ¶æ€ã€åŠ¨ç”»çŠ¶æ€å¯èƒ½å°±ä¸è¯¥ç»Ÿä¸€

#### é£é™© 3ï¼šSignal vs React è°ƒå’Œæœºåˆ¶

- **é—®é¢˜**ï¼šæ–‡æ¡£æåˆ°"Signal ç ´å React å•å‘æ•°æ®æµå“²å­¦"ï¼Œä½†åˆé€‰æ‹© Signal ä½œä¸ºæ ¸å¿ƒ
- **éœ€è§£å†³**ï¼š
  - å¦‚ä½•ä¸ `useTransition`ã€`Suspense` ç­‰å¹¶å‘ç‰¹æ€§å…¼å®¹ï¼Ÿ
- **å»ºè®®**ï¼šå¢åŠ ä¸€èŠ‚"React é€‚é…æŒ‘æˆ˜"ä¸“é—¨è®¨è®ºæ­¤é—®é¢˜

#### é£é™© 4ï¼šç¼ºå°‘"å¤±è´¥æ¡ä»¶"å®šä¹‰

- **é—®é¢˜**ï¼šè·¯çº¿å›¾åªå®šä¹‰äº†"å¦‚ä½•æˆåŠŸ"ï¼Œæ²¡æœ‰å®šä¹‰"ä½•æ—¶åº”è¯¥æ”¾å¼ƒ"
  - å¦‚æœ M1 å»¶æœŸ 4 å‘¨æ€ä¹ˆåŠï¼Ÿ
  - å¦‚æœ CRDT é›†æˆè¯æ˜ä¸å¯è¡Œæ€ä¹ˆåŠï¼Ÿ
- **å»ºè®®**ï¼šå¢åŠ  Kill Criteria ç« èŠ‚

### 11.4 è¡¥å……å»ºè®®

#### å»ºè®® 1ï¼šå¢åŠ "ç«å“è·Ÿè¸ª"ç« èŠ‚

- **Legend-State** å’Œ **TanStack Store**ï¼ˆTanner
  Linsley å³å°†å‘å¸ƒï¼‰éƒ½åœ¨æœç±»ä¼¼æ–¹å‘åŠªåŠ›
- éœ€è¦æŒç»­è·Ÿè¸ªå®ƒä»¬çš„è¿›å±•ï¼Œé¿å…é‡å¤é€ è½®å­

#### å»ºè®® 2ï¼šå¢åŠ "çœŸå®æ¡ˆä¾‹ä¼˜å…ˆ"ç­–ç•¥

åœ¨å†™ä»£ç ä¹‹å‰ï¼Œå…ˆç”¨ç°æœ‰åº“ç»„åˆ"æ¨¡æ‹Ÿ"å‡ºç›®æ ‡ APIï¼š

```typescript
// ç”¨ Zustand + React Query + XState ç»„åˆï¼Œæ¨¡æ‹Ÿå‡ºç›®æ ‡ API
const { atom, machine } = createNextStateSimulator(zustand, reactQuery, xstate);
```

è¿™æ ·å¯ä»¥**éªŒè¯ API è®¾è®¡æ˜¯å¦çœŸçš„è§£å†³é—®é¢˜**ï¼Œå†å†³å®šæ˜¯å¦ä»å¤´å®ç°ã€‚

#### å»ºè®® 3ï¼šè¡¥å……"æ¸è¿›å¼é‡‡ç”¨"ç¤ºä¾‹

ä¼ä¸šä¸ä¼šä¸€æ¬¡æ€§è¿ç§»ã€‚éœ€è¦ä¸€ä¸ª**å¯ä»¥å’Œ Redux/Zustand å…±å­˜**çš„æœ€å°æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯"å…¨æœ‰æˆ–å…¨æ— "ã€‚

```typescript
// ç¤ºä¾‹ï¼šæ¡¥æ¥å±‚å…è®¸æ–°æ—§çŠ¶æ€å…±å­˜
import { bridge } from '@singularity/compat';

// å°†ç°æœ‰ Zustand store æ¡¥æ¥ä¸º State Node
const legacyCounter = bridge.zustand(useCounterStore);

// æ–°ä»£ç å¯ä»¥ç›´æ¥è®¢é˜…
const double = computed(() => legacyCounter.get().count * 2);
```

#### å»ºè®® 4ï¼šè°ƒæ•´é‡Œç¨‹ç¢‘èŠ‚å¥

| åŸè®¡åˆ’       | å»ºè®®è°ƒæ•´            | ç†ç”±                     |
| :----------- | :------------------ | :----------------------- |
| M0 (Week 2)  | M0 (Week 4)         | å¯è§‚æµ‹æ€§æ¯”é¢„æœŸå¤æ‚       |
| M1 (Week 6)  | M1 (Week 10)        | å¼‚æ­¥å–æ¶ˆè¯­ä¹‰éœ€è¦å……åˆ†æµ‹è¯• |
| M2 (Week 10) | M2 (Week 16) / v1.1 | CRDT åº”ä½œä¸ºç‹¬ç«‹ç‰ˆæœ¬å‘å¸ƒ  |

### 11.5 æ‰§è¡Œå»ºè®®æ€»ç»“

1. **ç æ‰ 50% çš„èŒƒå›´**ï¼šå…ˆåšå¥½ `atom` + `computed` + React é€‚é…å™¨
2. **CRDT ä½œä¸º v2 ç›®æ ‡**ï¼šä¸è¦åœ¨ v1 é‡Œå†’é™©
3. **æ‰¾ä¸€ä¸ªçœŸå®é¡¹ç›®è¯•ç‚¹**ï¼šç”¨å®é™…åé¦ˆé©±åŠ¨è¿­ä»£
4. **å¢åŠ ç«å“è·Ÿè¸ª**ï¼šLegend-State / TanStack Store çš„è¿›å±•å¯èƒ½æ”¹å˜å†³ç­–
5. **å®šä¹‰å¤±è´¥æ¡ä»¶**ï¼šæ˜ç¡®ä½•æ—¶åº”è¯¥æ”¾å¼ƒæˆ–è½¬å‘

---


## åäºŒã€å¥‡ç‚¹æŠ€æœ¯è§„æ ¼

> å¯¼è¯»ï¼šå°†è§„æ ¼å˜æˆå¯æ‰§è¡Œè§„èŒƒçš„æ ¸å¿ƒç« èŠ‚ã€‚

### 12.1 æ ¸å¿ƒ API è§„èŒƒ (Core)

```typescript
type Atom<T> = {
  id: string;
  get(): T;
  set(next: T | ((prev: T) => T)): void;
  subscribe(listener: () => void): () => void;
};

type ReadonlyAtom<T> = Pick<Atom<T>, 'id' | 'get' | 'subscribe'>;

type Computed<T> = {
  id: string;
  get(): T;
  subscribe(listener: () => void): () => void;
};

type BatchFn = (fn: () => void) => void;

type Effect = {
  dispose(): void;
};

export function atom<T>(initial: T): Atom<T>;
export function computed<T>(read: () => T): Computed<T>;
export function batch(fn: () => void): void;
export function effect(fn: () => void): Effect;
export function fromStore<T>(
  getState: () => T,
  subscribe: (fn: () => void) => () => void,
): ReadonlyAtom<T>;
export function fromHook<T>(useStore: () => T): ReadonlyAtom<T>;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- `atom.set` åœ¨æ‰¹æ¬¡ä¸­åˆå¹¶é€šçŸ¥ï¼Œæ‰¹æ¬¡ç»“æŸåç»Ÿä¸€è§¦å‘ã€‚
- `computed` åªè¯»ï¼Œä¾èµ–è¿½è¸ªåœ¨ `get()` æ—¶å»ºç«‹ã€‚
- `effect` åœ¨ä¾èµ–å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œï¼Œå¹¶å…è®¸æ˜¾å¼ `dispose()`ã€‚

**API æ˜ç»†**ï¼š

**`atom<T>(initial: T): Atom<T>`**
- **ç”¨é€”**ï¼šåˆ›å»ºå¯è¯»å†™çš„åŸå­çŠ¶æ€ã€‚
- **å‚æ•°**ï¼š`initial` åˆå§‹å€¼ï¼Œå…è®¸ä»»æ„å¯åºåˆ—åŒ–æˆ–ä¸å¯åºåˆ—åŒ–å¯¹è±¡ã€‚
- **è¿”å›**ï¼š`Atom<T>`ï¼Œæä¾› `get/set/subscribe`ã€‚
- **é”™è¯¯**ï¼šæ— æ˜¾å¼é”™è¯¯ï¼›ä¸å»ºè®®åœ¨ `computed` ä¸­è°ƒç”¨ `set`ã€‚
- **ç¤ºä¾‹**ï¼š

```typescript
const count = atom(0);
count.set((n) => n + 1);
```

**`computed<T>(read: () => T): Computed<T>`**
- **ç”¨é€”**ï¼šåˆ›å»ºåªè¯»æ´¾ç”ŸçŠ¶æ€ã€‚
- **å‚æ•°**ï¼š`read` è¯»å–å‡½æ•°ï¼Œä¾èµ–é€šè¿‡ `get()` è‡ªåŠ¨è¿½è¸ªã€‚
- **è¿”å›**ï¼š`Computed<T>`ï¼Œæä¾› `get/subscribe`ã€‚
- **é”™è¯¯**ï¼šè‹¥å‘ç”Ÿå¾ªç¯ä¾èµ–ï¼ŒæŠ›å‡ºé”™è¯¯å¹¶ä¸­æ­¢æœ¬æ¬¡è®¡ç®—ã€‚
- **ç¤ºä¾‹**ï¼š

```typescript
const total = computed(() => price.get() * (1 + tax.get()));
```

**`batch(fn: () => void): void`**
- **ç”¨é€”**ï¼šåˆå¹¶æ‰¹é‡æ›´æ–°ï¼Œå‡å°‘é€šçŸ¥ä¸æ¸²æŸ“ã€‚
- **è¯­ä¹‰**ï¼šåµŒå¥— batch åˆå¹¶ä¸ºå•ä¸€æ‰¹æ¬¡ï¼›æ‰¹æ¬¡ç»“æŸç»Ÿä¸€é€šçŸ¥ã€‚
- **ç¤ºä¾‹**ï¼š

```typescript
batch(() => {
  a.set(1);
  b.set(2);
});
```

**`effect(fn: () => void): Effect`**
- **ç”¨é€”**ï¼šåˆ›å»ºå‰¯ä½œç”¨ï¼Œä¾èµ–å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œã€‚
- **è¿”å›**ï¼š`Effect`ï¼Œæä¾› `dispose()` è§£é™¤è®¢é˜…ã€‚
- **æ³¨æ„**ï¼šeffect å†…éƒ¨è‹¥äº§ç”ŸåŒæ­¥é”™è¯¯ï¼Œå°†è®°å½•åˆ° TraceEventã€‚
- **ç¤ºä¾‹**ï¼š

```typescript
const e = effect(() => console.log(total.get()));
e.dispose();
```

**`fromStore<T>(getState, subscribe): ReadonlyAtom<T>`**
- **ç”¨é€”**ï¼šå°†å¤–éƒ¨ store ä»¥åªè¯»æ–¹å¼æ¡¥æ¥ä¸º Atomã€‚
- **å‚æ•°**ï¼š
  - `getState`ï¼šè¯»å–å¤–éƒ¨çŠ¶æ€å¿«ç…§ã€‚
  - `subscribe`ï¼šè®¢é˜…å¤–éƒ¨å˜åŒ–ã€‚
- **è¿”å›**ï¼šåªè¯» `ReadonlyAtom<T>`ï¼Œä¸æ”¯æŒ `set`ã€‚
- **æ³¨æ„**ï¼šä»…ä¾›è¿ç§»ä¸å…±å­˜åœºæ™¯ä½¿ç”¨ã€‚

**`fromHook<T>(useStore): ReadonlyAtom<T>`**
- **ç”¨é€”**ï¼šå°† Hook é£æ ¼ store æ¡¥æ¥ä¸º Atomã€‚
- **æ³¨æ„**ï¼šä»…æ”¯æŒåªè¯»è®¢é˜…ï¼Œé¿å…åŒå†™ã€‚

### 12.2 Async API è§„èŒƒ (Core)

```typescript
type AsyncOptions<T> = {
  key: string;
  staleTime?: number;
  cacheTime?: number;
  retry?: number;
  retryDelay?: (attempt: number) => number;
  optimistic?: boolean;
};

type AsyncAtom<T> = Atom<T | undefined> & {
  status: Atom<'idle' | 'loading' | 'success' | 'error'>;
  error: Atom<Error | null>;
  refresh(): Promise<void>;
};

export function atomAsync<T>(
  fetcher: () => Promise<T>,
  options: AsyncOptions<T>,
): AsyncAtom<T>;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- `key` å¿…é¡»æ˜¾å¼ä¼ å…¥ï¼Œç”¨äºå»é‡ä¸ç¼“å­˜ã€‚
- `refresh` è§¦å‘ä¸€æ¬¡è¯·æ±‚ï¼Œè‹¥å¹¶å‘è¯·æ±‚åŒ keyï¼Œåˆ™åˆå¹¶ã€‚
- `optimistic` æ—¶å…è®¸å…ˆå†™å…¥æœ¬åœ°å€¼ï¼Œå¤±è´¥åå›æ»šã€‚

**API æ˜ç»†**ï¼š

**`atomAsync<T>(fetcher, options): AsyncAtom<T>`**
- **ç”¨é€”**ï¼šåˆ›å»ºå¸¦ç¼“å­˜ä¸å–æ¶ˆè¯­ä¹‰çš„å¼‚æ­¥çŠ¶æ€ã€‚
- **å‚æ•°**ï¼š
  - `fetcher`ï¼šè¿”å› Promise çš„è¯·æ±‚å‡½æ•°ã€‚
  - `options.key`ï¼šç¼“å­˜é”®ï¼Œå¿…é¡»æ˜¾å¼æä¾›ã€‚
  - `options.staleTime`ï¼šç¼“å­˜æ–°é²œæœŸï¼Œå•ä½æ¯«ç§’ã€‚
  - `options.cacheTime`ï¼šæ— è®¢é˜…åä¿ç•™æ—¶é—´ã€‚
  - `options.retry`ï¼šå¤±è´¥é‡è¯•æ¬¡æ•°ã€‚
  - `options.retryDelay`ï¼šé‡è¯•é€€é¿ç­–ç•¥ã€‚
  - `options.optimistic`ï¼šæ˜¯å¦å¯ç”¨ä¹è§‚æ›´æ–°ã€‚
- **è¿”å›**ï¼š`AsyncAtom<T>`ï¼ŒåŒ…å« `status/error/refresh`ã€‚
- **é”™è¯¯**ï¼š
  - `fetcher` æŠ›é”™æ—¶å†™å…¥ `error` atomã€‚
  - å¹¶å‘è¿‡æœŸå“åº”ä¼šè¢«ä¸¢å¼ƒï¼Œä¸è¦†ç›–æ–°å€¼ã€‚
- **ç¤ºä¾‹**ï¼š

```typescript
const user = atomAsync(fetchUser, {
  key: 'user:1',
  staleTime: 5_000,
  retry: 2,
});

user.refresh();
```

**ç»†åŒ–è¯­ä¹‰**ï¼š
- **çŠ¶æ€æµè½¬**ï¼š`idle -> loading -> success/error`ï¼Œ`refresh` è§¦å‘ `loading`ã€‚
- **å»é‡**ï¼šåŒ `key` åœ¨ `loading` çŠ¶æ€ä¸‹å¤ç”¨åŒä¸€è¯·æ±‚ã€‚
- **ç¼“å­˜æ·˜æ±°**ï¼šæ— è®¢é˜…è¾¾åˆ° `cacheTime` åæ¸…ç†ã€‚
- **ä¹è§‚æ›´æ–°**ï¼šå¤±è´¥æ—¶å›æ»šåˆ°ä¸Šä¸€æ¬¡ `success` å€¼ã€‚

### 12.3 Store çº§èƒ½åŠ› (Core)

```typescript
type Store = {
  atom<T>(initial: T): Atom<T>;
  computed<T>(read: () => T): Computed<T>;
  batch(fn: () => void): void;
  effect(fn: () => void): Effect;
  snapshot(): Record<string, unknown>;
};

export function createStore(): Store;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- `createStore` ç”¨äº SSR è¯·æ±‚çº§éš”ç¦»ã€‚
- `snapshot` æä¾›å¯è§‚æµ‹å¿«ç…§ç»™ DevTools ä¸è°ƒè¯•ã€‚

**API æ˜ç»†**ï¼š

**`createStore(): Store`**
- **ç”¨é€”**ï¼šåˆ›å»ºç‹¬ç«‹çš„ Storeï¼Œç”¨äºå¤šå®ä¾‹æˆ– SSRã€‚
- **è¿”å›**ï¼š`Store`ï¼ŒåŒ…å« `atom/computed/batch/effect`ã€‚
- **æ³¨æ„**ï¼šæ¯ä¸ª Store çš„èŠ‚ç‚¹ç›¸äº’éš”ç¦»ã€‚

**`Store.snapshot(): Record<string, unknown>`**
- **ç”¨é€”**ï¼šå¯¼å‡ºå½“å‰çŠ¶æ€å¿«ç…§ç»™è°ƒè¯•/å®¡è®¡ã€‚
- **æ³¨æ„**ï¼šé»˜è®¤ä»…å¯¼å‡ºå¯åºåˆ—åŒ–å­—æ®µã€‚

**ç»†åŒ–è¯´æ˜**ï¼š
- **ä¸€è‡´æ€§**ï¼šåŒä¸€æ‰¹æ¬¡å†…å¿«ç…§ä¸ºæ‰¹æ¬¡èµ·ç‚¹çŠ¶æ€ã€‚
- **éš”ç¦»**ï¼šä¸åŒ Store ä¹‹é—´å¿«ç…§ä¸å…±äº«ã€‚

### 12.4 æ¡†æ¶é€‚é…å™¨ API (React/Vue)

```typescript
// React
export function useAtom<T>(node: Atom<T> | Computed<T>): T;
export function useAtomValue<T>(node: Atom<T> | Computed<T>): T;
export function useSetAtom<T>(node: Atom<T>): Atom<T>['set'];

// Vue
export function useAtomRef<T>(node: Atom<T> | Computed<T>): { value: T };
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- é€‚é…å™¨åªè´Ÿè´£è®¢é˜…ä¸æ›´æ–°ï¼Œä¸æ”¹å˜æ ¸å¿ƒè¯­ä¹‰ã€‚
- React é€‚é…å™¨ä½¿ç”¨ `useSyncExternalStore` ä¿è¯å¹¶å‘å®‰å…¨ã€‚

**API æ˜ç»† (React)**ï¼š

**`useAtom<T>(node): T`**
- **ç”¨é€”**ï¼šè®¢é˜… atom/computed å¹¶è§¦å‘ç»„ä»¶æ›´æ–°ã€‚
- **æ³¨æ„**ï¼šä¾èµ–å˜åŒ–è§¦å‘é‡æ¸²æŸ“ï¼Œéµå®ˆ batch è¯­ä¹‰ã€‚

**`useAtomValue<T>(node): T`**
- **ç”¨é€”**ï¼šåªè¯»è®¢é˜…ï¼Œä¸æš´éœ² setã€‚

**`useSetAtom<T>(node): (next) => void`**
- **ç”¨é€”**ï¼šè·å–å†™å…¥å‡½æ•°ï¼Œä¾¿äºæ‹†åˆ†è¯»å†™ã€‚

**API æ˜ç»† (Vue)**ï¼š

**`useAtomRef<T>(node): Ref<T>`**
- **ç”¨é€”**ï¼šè¿”å› Vue `ref`ï¼Œä¿æŒå“åº”å¼ã€‚

### 12.5 DevTools äº‹ä»¶æ ¼å¼ (Core)

```typescript
type TraceExport = {
  protocolVersion: string;
  events: TraceEvent[];
  snapshots: TraceSnapshot[];
};

type TraceEvent = {
  id: string;
  ts: number;
  type: 'read' | 'write' | 'effect' | 'async' | 'sync';
  nodeId: string;
  payload?: unknown;
  batchId?: string;
  error?: string;
};

type TraceSnapshot = {
  nodes: Record<string, unknown>;
  edges: Array<{ from: string; to: string }>;
};
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- `type` ç”¨äºåŒºåˆ†è¯»/å†™/å‰¯ä½œç”¨/å¼‚æ­¥/åä½œäº‹ä»¶ã€‚
- `batchId` ç”¨äºå…³è”åŒä¸€æ‰¹æ¬¡å†…çš„å˜æ›´ã€‚
- `payload` åº”ä¿æŒå¯åºåˆ—åŒ–ï¼›æ•æ„Ÿå­—æ®µå¯è„±æ•ã€‚

**äº‹ä»¶ç¤ºä¾‹**ï¼š

```json
{
  "id": "evt_001",
  "ts": 1713000000000,
  "type": "write",
  "nodeId": "atom:count",
  "payload": { "prev": 1, "next": 2 },
  "batchId": "batch_01"
}
```

**å¿«ç…§è¦æ±‚**ï¼š
- `nodes` åªåŒ…å«å¯åºåˆ—åŒ–å€¼ã€‚
- `edges` ä»£è¡¨ä¾èµ–å›¾æ–¹å‘ï¼š`from -> to`ã€‚

### 12.6 ä¸€è‡´æ€§ä¸è¾¹ç•Œæ¡ˆä¾‹ (Core)

- **åµŒå¥— batch**ï¼šåªå½¢æˆä¸€ä¸ªé¡¶å±‚æ‰¹æ¬¡ï¼Œå†…éƒ¨ä¸é¢å¤–è§¦å‘é€šçŸ¥ã€‚
- **å¾ªç¯ä¾èµ–**ï¼šæ£€æµ‹åˆ°å¾ªç¯æ—¶æŠ›å‡ºé”™è¯¯å¹¶ä¸­æ­¢æœ¬æ¬¡è®¡ç®—ã€‚
- **å¼‚å¸¸æ¢å¤**ï¼š`computed` æŠ›é”™ä¼šæ ‡è®° error çŠ¶æ€ï¼Œä¸‹ä¸€æ¬¡ä¾èµ–å˜åŒ–æ—¶é‡è¯•ã€‚
- **å¹¶å‘å†™å…¥**ï¼šåŒä¸€æ‰¹æ¬¡å†…å†™å…¥æŒ‰æœ€åä¸€æ¬¡ä¸ºå‡†ã€‚
- **å¼‚æ­¥è¿‡æœŸ**ï¼šæ—§è¯·æ±‚è¿”å›æ—¶è‹¥ key å·²åˆ·æ–°ï¼Œç»“æœä¸¢å¼ƒã€‚

**è°ƒåº¦é¡ºåº**ï¼š
1) æ‰§è¡ŒåŒæ­¥å†™å…¥ï¼Œè®°å½•å˜æ›´ã€‚
2) ç»“æŸæ‰¹æ¬¡åè®¡ç®—ä¾èµ–å›¾ã€‚
3) è§¦å‘ computed æ›´æ–°ä¸ effect æ‰§è¡Œã€‚

**è¾¹ç•Œè¡Œä¸º**ï¼š
- computed å†…ä¸å¾—è¿›è¡Œå†™å…¥ï¼Œå¦åˆ™æŠ›å‡ºé”™è¯¯ã€‚
- effect çš„åŒæ­¥å¼‚å¸¸å†™å…¥ TraceEventï¼Œå¹¶ä¸é˜»æ–­åç»­æ›´æ–°ã€‚
 - effect é»˜è®¤åŒæ­¥æ‰§è¡Œï¼›å¦‚éœ€å¼‚æ­¥è°ƒåº¦ï¼Œéœ€ç”±é€‚é…å±‚æ˜¾å¼å¼•å…¥ã€‚

### 12.7 æœ€å°å®ç°ç»“æ„ (Core)

```
packages/
  singularity-core/
    src/
      atom.ts
      computed.ts
      batch.ts
      effect.ts
      store.ts
      async.ts
      devtools.ts
      index.ts
```

**æ¨¡å—èŒè´£**ï¼š
- `atom.ts`ï¼šåŸå­èŠ‚ç‚¹ä¸è®¢é˜…æœºåˆ¶
- `computed.ts`ï¼šä¾èµ–è¿½è¸ªä¸æ´¾ç”Ÿè®¡ç®—
- `batch.ts`ï¼šæ‰¹å¤„ç†ä¸è°ƒåº¦é˜Ÿåˆ—
- `effect.ts`ï¼šå‰¯ä½œç”¨æ³¨å†Œä¸æ¸…ç†
- `store.ts`ï¼šå¤šå®ä¾‹ä¸ SSR éš”ç¦»
- `async.ts`ï¼šç¼“å­˜/å–æ¶ˆ/é‡è¯•é€»è¾‘
- `devtools.ts`ï¼šäº‹ä»¶é‡‡é›†ä¸å¿«ç…§å¯¼å‡º

### 12.8 å…¼å®¹æ€§ä¸ç¨³å®šæ€§æ‰¿è¯º

- **API ç¨³å®š**ï¼šæ ¸å¿ƒ API è¿›å…¥ 1.0 åä»…é€šè¿‡ä¸»ç‰ˆæœ¬å˜æ›´ã€‚
- **è¡Œä¸ºç¨³å®š**ï¼šä¸€è‡´æ€§è¯­ä¹‰ä¸è°ƒåº¦è§„åˆ™ä¸å¾—åœ¨æ¬¡ç‰ˆæœ¬æ”¹å˜ã€‚
- **å¯è§‚æµ‹æ€§**ï¼šTraceEvent å­—æ®µä¿è¯å‘åå…¼å®¹ã€‚

---

## åä¸‰ã€çŠ¶æ€æœºä¸åä½œå±‚è§„æ ¼

> å¯¼è¯»ï¼šè¡¥å……çŠ¶æ€æœºä¸åä½œå±‚çš„å…·ä½“æ¥å£ã€‚

### 13.1 çŠ¶æ€æœº API è§„èŒƒ (Machine)

```typescript
type MachineConfig<TState extends string, TEvent extends string> = {
  id?: string;
  initial: TState;
  states: {
    [K in TState]: {
      on?: Partial<Record<TEvent, TState>>;
      entry?: Array<() => void>;
      exit?: Array<() => void>;
    };
  };
};

type Machine<TState extends string, TEvent extends string> = {
  state: Atom<TState>;
  send(event: TEvent): void;
};

export function machine<TState extends string, TEvent extends string>(
  config: MachineConfig<TState, TEvent>,
): Machine<TState, TEvent>;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- `send` è§¦å‘çŠ¶æ€è½¬æ¢ï¼Œè‹¥æ— åŒ¹é…è½¬æ¢åˆ™å¿½ç•¥ã€‚
- `entry/exit` åœ¨çŠ¶æ€åˆ‡æ¢æ—¶æ‰§è¡Œï¼Œéµå®ˆ batch è¯­ä¹‰ã€‚

**API æ˜ç»†**ï¼š

**`machine(config): Machine`**
- **ç”¨é€”**ï¼šå£°æ˜ä¸šåŠ¡æµç¨‹ä¸æœ‰é™çŠ¶æ€è½¬æ¢ã€‚
- **å‚æ•°**ï¼š
  - `config.initial`ï¼šåˆå§‹çŠ¶æ€ï¼Œå¿…é¡»åœ¨ `states` ä¸­å­˜åœ¨ã€‚
  - `config.states`ï¼šçŠ¶æ€å®šä¹‰ä¸è½¬ç§»è§„åˆ™ã€‚
  - `entry/exit`ï¼šçŠ¶æ€è¿›å…¥/é€€å‡ºå›è°ƒï¼Œå»ºè®®åªåšå‰¯ä½œç”¨è§¦å‘ï¼Œä¸åšå†™å…¥ã€‚
- **è¿”å›**ï¼š`Machine`ï¼ŒåŒ…å« `state` atom ä¸ `send`ã€‚
- **é”™è¯¯**ï¼š
  - åˆå§‹çŠ¶æ€éæ³•æ—¶æŠ›å‡ºé”™è¯¯ã€‚
  - entry/exit å‘ç”Ÿå¼‚å¸¸ä¼šå†™å…¥ TraceEventã€‚

**çŠ¶æ€è½¬æ¢é¡ºåº**ï¼š
1) æ‰§è¡Œå½“å‰çŠ¶æ€ `exit`
2) åˆ‡æ¢åˆ°ç›®æ ‡çŠ¶æ€
3) æ‰§è¡Œç›®æ ‡çŠ¶æ€ `entry`

**é™åˆ¶**ï¼š
- ä¸æ”¯æŒå±‚çº§/å¹¶è¡ŒçŠ¶æ€ï¼ˆä¿æŒè½»é‡ï¼‰ã€‚
- çŠ¶æ€æœºä¸ç®¡ç†ä¸šåŠ¡æ•°æ®ï¼Œæ•°æ®ç”± atom æ‰¿è½½ã€‚
- `entry/exit` å†…ä¸å»ºè®®ç›´æ¥å†™å…¥ atomï¼›å¦‚éœ€å†™å…¥ï¼Œå»ºè®®é€šè¿‡ effect è§£è€¦ã€‚

**äº‹ä»¶å¤„ç†é¡ºåº**ï¼š
- `send` ä»¥ FIFO å¤„ç†ï¼ŒåŒä¸€æ‰¹æ¬¡å†…äº‹ä»¶æŒ‰è°ƒç”¨é¡ºåºæ‰§è¡Œã€‚

**ç»†åŒ–è¯­ä¹‰**ï¼š
- åŒä¸€çŠ¶æ€å†…é‡å¤ `send` ç›¸åŒäº‹ä»¶å…è®¸å†æ¬¡è§¦å‘è½¬æ¢ã€‚
- æ— åŒ¹é…è½¬æ¢äº‹ä»¶å°†è¢«å¿½ç•¥ï¼Œä¸æŠ›é”™ã€‚

### 13.2 çŠ¶æ€æœºä¸æ•°æ®è§£è€¦ (Machine + Atom)

```typescript
const auth = machine({
  initial: 'idle',
  states: {
    idle: { on: { LOGIN: 'loading' } },
    loading: { on: { SUCCESS: 'authed', FAILURE: 'error' } },
    authed: { on: { LOGOUT: 'idle' } },
    error: { on: { RETRY: 'loading' } },
  },
});

const token = atom<string | null>(null);

effect(() => {
  if (auth.state.get() === 'authed') {
    token.set('token');
  }
});
```

**æœ€ä½³å®è·µ**ï¼š
- çŠ¶æ€æœºè´Ÿè´£æµç¨‹ï¼Œatom è´Ÿè´£æ•°æ®ã€‚
- å¤æ‚å‰¯ä½œç”¨ç”± effect ç®¡ç†ï¼Œé¿å…åœ¨ entry/exit ä¸­ç›´æ¥å†™å…¥ã€‚

### 13.3 åä½œå±‚ API è§„èŒƒ (Sync)

```typescript
type SyncOptions = {
  id: string;
  merge?: 'crdt';
  offline?: boolean;
};

type SyncAtom<T> = Atom<T> & {
  connect(): Promise<void>;
  disconnect(): void;
  status: Atom<'idle' | 'syncing' | 'error'>;
};

export function atomSync<T>(initial: T, options: SyncOptions): SyncAtom<T>;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- `connect` å»ºç«‹åä½œè¿æ¥ï¼Œ`disconnect` ä¿ç•™æœ¬åœ°å¯å†™ã€‚
- `offline` ä¸º true æ—¶å…è®¸ç¦»çº¿ç¼–è¾‘ï¼Œæ¢å¤ååˆå¹¶ã€‚

**API æ˜ç»†**ï¼š

**`atomSync<T>(initial, options): SyncAtom<T>`**
- **ç”¨é€”**ï¼šåˆ›å»ºåä½œçŠ¶æ€èŠ‚ç‚¹ï¼Œæä¾› CRDT åˆå¹¶è¯­ä¹‰ã€‚
- **å‚æ•°**ï¼š
  - `options.id`ï¼šåä½œæ–‡æ¡£å”¯ä¸€æ ‡è¯†ã€‚
  - `options.merge`ï¼šåˆå¹¶ç­–ç•¥ï¼Œå½“å‰ä¸º `crdt`ã€‚
  - `options.offline`ï¼šç¦»çº¿å†™å…¥å¼€å…³ã€‚
- **è¿”å›**ï¼š`SyncAtom<T>`ï¼Œæ”¯æŒè¿æ¥ç®¡ç†ä¸çŠ¶æ€ã€‚
- **é”™è¯¯**ï¼šè¿æ¥å¤±è´¥å†™å…¥ `status=error`ï¼Œæœ¬åœ°å†™å…¥ä¸å—å½±å“ã€‚

**çŠ¶æ€æµè½¬**ï¼š
`idle -> syncing -> idle`ï¼Œå¼‚å¸¸è¿›å…¥ `error`ã€‚

**è¿æ¥è¯­ä¹‰**ï¼š
- `connect`/`disconnect` å¯é‡å¤è°ƒç”¨ï¼Œåº”ä¸ºå¹‚ç­‰ã€‚
- `disconnect` ä¸æ¸…ç©ºæœ¬åœ°çŠ¶æ€ï¼Œä»…åœæ­¢åŒæ­¥ã€‚

**æ•°æ®çº¦æŸ**ï¼š
- æ¨è JSON å¯åºåˆ—åŒ–ç»“æ„ã€‚
- ä¸å»ºè®®å­˜æ”¾å‡½æ•°/DOM/å¾ªç¯å¼•ç”¨ã€‚

**åˆå¹¶è¯­ä¹‰**ï¼š
- åŒä¸€å­—æ®µå†²çªç”± CRDT è§„åˆ™åˆå¹¶ï¼Œä¸ä¿è¯æœ€åå†™å…¥ä¼˜å…ˆã€‚
- åä½œäº‹ä»¶è¿›å…¥ TraceEventï¼Œå¯ç”¨äºå›æ”¾ä¸å®¡è®¡ã€‚

### 13.4 åä½œå†²çªä¸åˆå¹¶ç­–ç•¥

- **å­—æ®µçº§åˆå¹¶**ï¼šåŒä¸€å­—æ®µå†²çªæŒ‰ CRDT è§„åˆ™åˆå¹¶ã€‚
- **æ—¶é—´çº¿å¯å›æ”¾**ï¼šæ‰€æœ‰åä½œäº‹ä»¶è¿›å…¥ TraceEvent æµã€‚
- **ç¦»çº¿ä¼˜å…ˆ**ï¼šæœ¬åœ°å†™å…¥ä¸é˜»å¡ï¼Œæ¢å¤è¿æ¥æ—¶è‡ªåŠ¨åŒæ­¥ã€‚

**ä¸€è‡´æ€§ä¿è¯**ï¼š
- **æœ€ç»ˆä¸€è‡´**ï¼šåŒæ­¥å®Œæˆåå‰¯æœ¬ä¸€è‡´ã€‚
- **å±€éƒ¨å¯ç”¨**ï¼šç¦»çº¿çŠ¶æ€ä¸‹å…è®¸æœ¬åœ°å†™å…¥ä¸å›æ”¾ã€‚

### 13.5 åä½œå®‰å…¨ä¸æƒé™è¾¹ç•Œ

- **é‰´æƒ**ï¼šç”±ä¸Šå±‚åº”ç”¨å®ç°ï¼Œåä½œå±‚ä¸å†…ç½®é‰´æƒé€»è¾‘ã€‚
- **æœ€å°æš´éœ²**ï¼šåªåŒæ­¥çŠ¶æ€ï¼Œä¸ä¼ è¾“æ‰§è¡Œé€»è¾‘ã€‚

---

## åå››ã€ç±»å‹ç³»ç»Ÿä¸è§„èŒƒçº¦æŸ

> å¯¼è¯»ï¼šè¯´æ˜ç±»å‹çº¦æŸä¸æ³›å‹è¾¹ç•Œã€‚

### 14.1 Atom/Computed æ³›å‹çº¦æŸ

```typescript
type ReadonlyAtom<T> = Pick<Atom<T>, 'id' | 'get' | 'subscribe'>;
type WritableAtom<T> = Atom<T>;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- å…¬å¼€ API ä¸­åŒºåˆ†åªè¯»ä¸å¯å†™ï¼Œé¿å…è¯¯ç”¨ã€‚

### 14.2 äº‹ä»¶ç±»å‹çº¦æŸ

```typescript
type EventMap = Record<string, unknown>;
type EventKey<T extends EventMap> = keyof T & string;
```

**è¯­ä¹‰è¯´æ˜**ï¼š
- çŠ¶æ€æœº `send` åªæ¥å—å·²å£°æ˜äº‹ä»¶ã€‚

### 14.3 ç±»å‹æ¨æ–­ç›®æ ‡

- **é›¶æ˜¾å¼ç±»å‹**ï¼šå¸¸è§åœºæ™¯æ— éœ€æ‰‹å†™æ³›å‹å‚æ•°ã€‚
- **è¾¹ç•Œå¯æ§**ï¼šå¤æ‚å¯¹è±¡åœ¨ `atom` ä¸­ä»ä¿æŒç±»å‹æ”¶æ•›ã€‚
- **äº‹ä»¶å®‰å…¨**ï¼šçŠ¶æ€æœºäº‹ä»¶åœ¨ç¼–è¯‘æœŸé™å®šã€‚

### 14.4 ç¤ºä¾‹ï¼šç±»å‹æ¨æ–­ä¸çº¦æŸ

```typescript
const user = atom({ id: 'u1', name: 'Ada' });
const name = computed(() => user.get().name);

type AuthEvents = { LOGIN: { id: string }; LOGOUT: {} };
type AuthEventKey = EventKey<AuthEvents>;
```

---

## åäº”ã€å…¼å®¹å±‚ä¸å…±å­˜ç­–ç•¥

> å¯¼è¯»ï¼šè¯´æ˜ä¸æ—§ç³»ç»Ÿå…±å­˜çš„æœ€å°ç­–ç•¥ã€‚

### 15.1 å…¼å®¹å±‚ API

```typescript
export const compat = {
  redux: <T>(getState: () => T, subscribe: (fn: () => void) => () => void) =>
    fromStore(getState, subscribe),
  zustand: <T>(useStore: () => T) => fromHook(useStore),
};
```

### 15.2 å…±å­˜è¾¹ç•Œ

- å…¼å®¹å±‚åªè¯»ï¼Œä¸ç›´æ¥å†™å…¥æ—§ç³»ç»Ÿã€‚
- å˜æ›´æµè¿›å…¥æ–°ç³»ç»Ÿï¼Œæ—§ç³»ç»Ÿä»…æä¾›å¿«ç…§ã€‚

### 15.3 è¿ç§»è·¯å¾„å»ºè®®

- **æ–°æ¨¡å—ä¼˜å…ˆ**ï¼šæ–°åŠŸèƒ½ä½¿ç”¨å¥‡ç‚¹ï¼Œæ—§æ¨¡å—ä¿æŒä¸å˜ã€‚
- **è¾¹ç•Œæ¸…æ™°**ï¼šé€šè¿‡é€‚é…å±‚æš´éœ²åªè¯»æ¥å£ã€‚
- **æ€§èƒ½è¯„ä¼°**ï¼šå…ˆè¯„ä¼°è®¢é˜…è§„æ¨¡ä¸æ›´æ–°é¢‘ç‡ã€‚

### 15.4 å…¼å®¹æ€§é£é™©

- **åŒå†™é£é™©**ï¼šé¿å…æ–°æ—§ç³»ç»ŸåŒæ—¶å†™å…¥åŒä¸€çŠ¶æ€ã€‚
- **è¯­ä¹‰å·®å¼‚**ï¼šæ—§ç³»ç»Ÿçš„å‰¯ä½œç”¨æ¨¡å‹å¯èƒ½ä¸ä¸€è‡´ã€‚

---

## åå…­ã€è°ƒåº¦ä¸é”™è¯¯å¤„ç†ç»†åˆ™

> å¯¼è¯»ï¼šè°ƒåº¦ä¸é”™è¯¯è§„åˆ™æ˜¯è¡Œä¸ºä¸€è‡´æ€§çš„ä¾æ®ã€‚

### 16.1 æ‰¹å¤„ç†ä¸è°ƒåº¦è§„åˆ™

- **å•ä¸€æ‰¹æ¬¡**ï¼šåµŒå¥— batch åˆå¹¶ä¸ºä¸€ä¸ªé¡¶å±‚æ‰¹æ¬¡
- **æäº¤æ—¶æœº**ï¼šæ‰¹æ¬¡ç»“æŸåç»Ÿä¸€æäº¤é€šçŸ¥
- **ä¼˜å…ˆçº§**ï¼šåŒæ­¥å†™å…¥ä¼˜å…ˆäºå¼‚æ­¥å›å†™

### 16.1.1 è°ƒåº¦é˜¶æ®µ

1) **é‡‡é›†**ï¼šè®°å½•å†™å…¥ä¸ä¾èµ–ã€‚
2) **è®¡ç®—**ï¼šè®¡ç®—æ´¾ç”Ÿä¸å‰¯ä½œç”¨ã€‚
3) **é€šçŸ¥**ï¼šç»Ÿä¸€è§¦å‘è®¢é˜…æ›´æ–°ã€‚

**ç»†åŒ–é¡ºåº**ï¼š
- å…ˆè®¡ç®— computedï¼Œå†æ‰§è¡Œ effectï¼Œå†é€šçŸ¥è®¢é˜…è€…ã€‚

### 16.2 å¼‚æ­¥å–æ¶ˆä¸å›æ”¾è§„åˆ™

- **å–æ¶ˆè¯­ä¹‰**ï¼šæ–°è¯·æ±‚è§¦å‘æ—¶å–æ¶ˆæ—§è¯·æ±‚ï¼Œå¹¶æ ‡è®°ä¸º `canceled`
- **å›æ”¾ä¸€è‡´æ€§**ï¼šå¼‚æ­¥ç»“æœè¿›å…¥æ—¶é—´çº¿æ—¶å¸¦ä¸Šå…³è” batchId
- **è¿‡æœŸå†™å…¥**ï¼šè‹¥ key å·²åˆ·æ–°ï¼Œæ—§å“åº”ä¸¢å¼ƒ

### 16.3 é”™è¯¯ä¼ æ’­è§„åˆ™

- **åŒæ­¥é”™è¯¯**ï¼šå‘è°ƒç”¨è€…æŠ›å‡ºï¼Œè¿›å…¥ TraceEvent
- **å¼‚æ­¥é”™è¯¯**ï¼šå†™å…¥ error atomï¼Œä¸é˜»æ–­åç»­åˆ·æ–°
- **åä½œé”™è¯¯**ï¼šé€šè¿‡äº‹ä»¶æµå‘Šè­¦ï¼Œä¸é˜»å¡æœ¬åœ°ç¼–è¾‘

### 16.4 é”™è¯¯åˆ†ç±»

- **é€»è¾‘é”™è¯¯**ï¼šå¾ªç¯ä¾èµ–ã€éæ³•å†™å…¥ã€‚
- **è¿è¡Œæ—¶é”™è¯¯**ï¼šç”¨æˆ·ä»£ç æŠ›é”™ã€‚
- **ç½‘ç»œé”™è¯¯**ï¼šå¼‚æ­¥è¯·æ±‚å¤±è´¥ã€‚

---

## åä¸ƒã€DevTools UI è®¾è®¡

> å¯¼è¯»ï¼šæè¿° DevTools äº¤äº’ç›®æ ‡ä¸åŸºæœ¬å¸ƒå±€ã€‚

### 17.1 é¢æ¿å¸ƒå±€

- **å·¦ä¾§**ï¼šçŠ¶æ€æ ‘ + æœç´¢
- **ä¸­é—´**ï¼šæ—¶é—´çº¿ (TraceEvent)
- **å³ä¾§**ï¼šå½“å‰èŠ‚ç‚¹è¯¦æƒ… + ä¾èµ–å›¾

### 17.2 äº¤äº’èƒ½åŠ›

- **æ—¶é—´æ—…è¡Œ**ï¼šå›æ”¾åˆ°ä»»æ„äº‹ä»¶
- **è¿‡æ»¤**ï¼šæŒ‰ nodeId/type ç­›é€‰
- **å¿«ç…§å¯¼å‡º**ï¼šJSON å¯¼å‡ºç”¨äºå®¡è®¡

### 17.3 æ•°æ®å¯¼å‡ºè§„èŒƒ

- **æ ¼å¼**ï¼š`TraceExport`ï¼ŒåŒ…å« `protocolVersion/events/snapshots`ã€‚
- **è„±æ•**ï¼šæ”¯æŒå­—æ®µçº§è„±æ•ã€‚
- **å®¹é‡**ï¼šé»˜è®¤ä¿ç•™æœ€è¿‘ N æ¡äº‹ä»¶ã€‚

### 17.4 åè®®ç‰ˆæœ¬

- **ç‰ˆæœ¬å­—æ®µ**ï¼šå¯¼å‡ºæ•°æ®åŒ…å« `protocolVersion`ã€‚
- **å…¼å®¹ç­–ç•¥**ï¼šæ¬¡ç‰ˆæœ¬å‘åå…¼å®¹ï¼Œä¸»ç‰ˆæœ¬å¯èƒ½ç ´åå…¼å®¹ã€‚

### 17.5 æ€§èƒ½ä¸ä½“éªŒ

- **è½»é‡é‡‡æ ·**ï¼šé»˜è®¤ä»…é‡‡æ ·å…³é”®äº‹ä»¶
- **å»¶è¿Ÿæ¸²æŸ“**ï¼šå¤§å‹çŠ¶æ€æ ‘æŒ‰éœ€å±•å¼€
- **å¯å…³é—­**ï¼šç”Ÿäº§ç¯å¢ƒé»˜è®¤ç¦ç”¨

**æ€§èƒ½æ¨¡å¼**ï¼š
- æä¾› `minimal` é‡‡æ ·æ¨¡å¼ï¼Œä»…è®°å½• write/async äº‹ä»¶ã€‚

---

## åå…«ã€æ€§èƒ½åŸºå‡†ç»†åŒ–

> å¯¼è¯»ï¼šç»™å‡ºåŸºå‡†åœºæ™¯ä¸ç»Ÿè®¡å£å¾„ã€‚

### 18.1 Benchmark åœºæ™¯

- **è¯»å¯†é›†**ï¼š1k è®¢é˜… + 10k æ¬¡åªè¯»è®¿é—®
- **å†™å¯†é›†**ï¼š1k è®¢é˜… + 1k è¿ç»­å†™å…¥ (batch)
- **å¼‚æ­¥å¯†é›†**ï¼š100 å¹¶å‘è¯·æ±‚ + å–æ¶ˆä¸é‡è¯•

### 18.2 ç»Ÿè®¡å£å¾„

- **å‡å€¼**ï¼šæ€»è€—æ—¶ / æ¬¡æ•°
- **P95**ï¼š95 åˆ†ä½è€—æ—¶
- **å†…å­˜**ï¼šæ“ä½œå‰åå †å†…å­˜å·®å€¼

### 18.3 åŸºçº¿ç›®æ ‡ (åˆç‰ˆ)

- **1k è®¢é˜…**ï¼šå•æ¬¡æ‰¹é‡æ›´æ–° < 8ms (P95)
- **1k è¿ç»­å†™**ï¼šæ‰¹æ¬¡æ¸²æŸ“åˆå¹¶ä¸º 1 æ¬¡
- **100 å¹¶å‘**ï¼šå–æ¶ˆè¯­ä¹‰æ— æ³„æ¼

### 18.4 Benchmark æ­¥éª¤

1) å‡†å¤‡å›ºå®šæ•°æ®è§„æ¨¡ä¸è®¾å¤‡ç¯å¢ƒ
2) æ‰§è¡Œ 3 è½®æµ‹è¯•å–å‡å€¼
3) è®°å½•å‡å€¼ä¸ P95

**æµ‹é‡æ–¹æ³•**ï¼š
- ä½¿ç”¨ `performance.now()` ç»Ÿè®¡å•æ¬¡æ‰¹æ¬¡è€—æ—¶ã€‚
- æ¯è½®è‡³å°‘ 100 æ¬¡è¿­ä»£ã€‚

### 18.5 æŠ¥å‘Šæ¨¡æ¿

```
ç¯å¢ƒ:
åœºæ™¯:
å‡å€¼:
P95:
å†…å­˜å·®:
å¤‡æ³¨:
```

---

## åä¹ã€Demo éª¨æ¶ä¸éªŒæ”¶è„šæœ¬

> å¯¼è¯»ï¼šDemo ä¸éªŒæ”¶è„šæœ¬æ˜¯éªŒè¯å…¥å£ã€‚

### 19.1 Demo ç›®å½•ç»“æ„

```
apps/
  playground/
    src/
      demos/
        m0-counter.tsx
        m1-auth-machine.tsx
        m2-collab-doc.tsx
```

### 19.2 éªŒæ”¶è„šæœ¬æ¨¡æ¿

```typescript
export function assertBatching(result: { renders: number }) {
  if (result.renders > 1) {
    throw new Error('batch failed');
  }
}
```

### 19.3 éªŒæ”¶æ ‡å‡†

- **M0**ï¼šè®¡æ•°å™¨ä¸æ´¾ç”Ÿæ­£å¸¸æ›´æ–°
- **M1**ï¼šçŠ¶æ€æœºä¸å¼‚æ­¥å–æ¶ˆæ­£ç¡®
- **M2**ï¼šåä½œäº‹ä»¶å¯å›æ”¾

---

## äºŒåã€API ç¤ºä¾‹ç”¨ä¾‹é›†

> å¯¼è¯»ï¼šæä¾›å…¸å‹ç”¨æ³•ç¤ºä¾‹ï¼Œä¾¿äºç†è§£ APIã€‚

### 20.1 åŸºæœ¬åŸå­ä¸æ´¾ç”Ÿ

```typescript
const count = atom(0);
const double = computed(() => count.get() * 2);

effect(() => {
  console.log('double', double.get());
});
```

### 20.2 æ‰¹å¤„ç†æ›´æ–°

```typescript
batch(() => {
  count.set(1);
  count.set(2);
});
```

### 20.3 å¼‚æ­¥è¯·æ±‚ä¸å–æ¶ˆ

```typescript
const user = atomAsync(fetchUser, { key: 'user:1', staleTime: 5_000 });
user.refresh();
```

### 20.4 çŠ¶æ€æœºé©±åŠ¨ UI

```typescript
const auth = machine({
  initial: 'idle',
  states: {
    idle: { on: { LOGIN: 'loading' } },
    loading: { on: { SUCCESS: 'authed', FAILURE: 'error' } },
    authed: { on: { LOGOUT: 'idle' } },
    error: { on: { RETRY: 'loading' } },
  },
});
```

### 20.5 Async çŠ¶æ€ä¸ UI

```typescript
const user = atomAsync(fetchUser, { key: 'user:1' });
effect(() => {
  console.log(user.status.get(), user.get());
});
```

### 20.6 SSR ä¸å¤š Store

```typescript
const store = createStore();
const local = store.atom(0);
store.batch(() => local.set(1));
```

### 20.7 åä½œçŠ¶æ€ç¤ºä¾‹

```typescript
const doc = atomSync({ title: '' }, { id: 'doc:1', offline: true });
await doc.connect();
doc.set({ title: 'Hello' });
```

---

## äºŒåä¸€ã€è¾¹ç•Œæµ‹è¯•æ¸…å•

> å¯¼è¯»ï¼šåˆ—å‡ºéœ€è¦è¦†ç›–çš„è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹ã€‚

- **å¾ªç¯ä¾èµ–**ï¼šcomputed äº’ç›¸ä¾èµ–æ—¶åº”æŠ›é”™
- **åµŒå¥— batch**ï¼šå¤šå±‚ batch åªè§¦å‘ä¸€æ¬¡æ¸²æŸ“
- **å¹¶å‘åˆ·æ–°**ï¼šåŒ key çš„ async åº”å»é‡
- **è¿‡æœŸå†™å…¥**ï¼šæ—§è¯·æ±‚å“åº”ä¸è¦†ç›–æ–°å€¼
- **åä½œæ–­è¿**ï¼šæ–­ç½‘åå¯ç»§ç»­ç¼–è¾‘ï¼Œæ¢å¤ååˆå¹¶

### 21.1 æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**ï¼šæ ¸å¿ƒåŸè¯­ä¸ä¾èµ–å›¾
- **é›†æˆæµ‹è¯•**ï¼šå¼‚æ­¥/çŠ¶æ€æœº/åä½œç»„åˆ
- **å›å½’æµ‹è¯•**ï¼šå·²ä¿®å¤ bug çš„å›ºå®šç”¨ä¾‹

---

## äºŒåäºŒã€å‘å¸ƒéªŒæ”¶æ¸…å•

> å¯¼è¯»ï¼šå‘å¸ƒå‰çš„éªŒæ”¶æ£€æŸ¥è¡¨ã€‚

- **åŠŸèƒ½**ï¼šM0/M1 demo å¯è¿è¡Œï¼ŒAPI è¡Œä¸ºç¨³å®š
- **æ€§èƒ½**ï¼šè¾¾åˆ°åŸºçº¿æŒ‡æ ‡ï¼ŒP95 å¯æ§
- **å¯è§‚æµ‹æ€§**ï¼šæ—¶é—´çº¿ä¸å¿«ç…§å¯å¯¼å‡º
- **ç¨³å®šæ€§**ï¼šé”™è¯¯æ¨¡å‹å¯é¢„æœŸï¼Œå¼‚å¸¸å¯æ¢å¤
- **å…¼å®¹æ€§**ï¼šReact é€‚é…å™¨é€šè¿‡åŸºç¡€ç”¨ä¾‹

### 22.1 å‘å¸ƒé—¨æ§›

- **API æ–‡æ¡£å®Œæ•´**ï¼šæ‰€æœ‰æ ¸å¿ƒ API æœ‰ç¤ºä¾‹ä¸è¾¹ç•Œè¯´æ˜
- **åŸºå‡†æŠ¥å‘Š**ï¼šé™„å¸¦ benchmark ç»“æœä¸ç¯å¢ƒ
- **å˜æ›´è®°å½•**ï¼šCHANGELOG è¦†ç›–æœ¬ç‰ˆæœ¬å˜åŒ–

---

## äºŒåä¸‰ã€ç‰ˆæœ¬è¿ç§»ç­–ç•¥ç»†åˆ™

> å¯¼è¯»ï¼šç‰ˆæœ¬è¿ç§»ç­–ç•¥æ¨¡æ¿ä¸åŸåˆ™ã€‚

### 23.1 ç ´åæ€§å˜æ›´ç­–ç•¥

- **ä¸»ç‰ˆæœ¬**ï¼šå…è®¸ç ´åæ€§å˜æ›´ï¼Œå¿…é¡»æä¾›è¿ç§»æŒ‡å—
- **æ¬¡ç‰ˆæœ¬**ï¼šä»…æ–°å¢ APIï¼Œä¿æŒå‘åå…¼å®¹
- **ä¿®è®¢ç‰ˆæœ¬**ï¼šä¿®å¤ bugï¼Œä¸æ”¹å˜è¡Œä¸º

### 23.2 è¿ç§»æŒ‡å—æ ¼å¼

- **èƒŒæ™¯**ï¼šä¸ºä½•æ”¹åŠ¨
- **å½±å“é¢**ï¼šå“ªäº› API å—å½±å“
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼šæ—§åˆ°æ–°çš„æ˜ å°„
- **é£é™©**ï¼šå¯èƒ½çš„è¡Œä¸ºå˜åŒ–

### 23.3 è¿ç§»ç¤ºä¾‹æ¨¡æ¿

```text
åŸ API: atomAsync(fetcher, { key })
æ–° API: atomAsync(fetcher, { key, staleTime })
è¿ç§»è¯´æ˜: é»˜è®¤ staleTime ä» 0 å˜ä¸º 5000
```

---

## äºŒåå››ã€æ¶æ„å†³ç­–è®°å½• (ADR) æ¨¡æ¿

> å¯¼è¯»ï¼šADR æ¨¡æ¿ç”¨äºè®°å½•å…³é”®å†³ç­–ã€‚

```text
ADR-0001: ä½¿ç”¨ Signal ä½œä¸ºæ ¸å¿ƒå“åº”å¼åŸè¯­
çŠ¶æ€: ææ¡ˆ / é€šè¿‡ / æ‹’ç»
ä¸Šä¸‹æ–‡: ...
å†³ç­–: ...
å½±å“: ...
å¤‡é€‰æ–¹æ¡ˆ: ...
```

**ä½¿ç”¨è§„åˆ™**ï¼š
- æ¯ä¸ªé‡å¤§å†³ç­–å¿…é¡»æœ‰ ADRã€‚
- ADR ä¸ç‰ˆæœ¬å‘å¸ƒç»‘å®šã€‚

---

## äºŒåäº”ã€å®‰å…¨ä¸åˆè§„

> å¯¼è¯»ï¼šå®‰å…¨ä¸åˆè§„çš„æœ€ä½è¦æ±‚ã€‚

### 25.1 æ•°æ®ä¸æ—¥å¿—

- **æœ€å°é‡‡é›†**ï¼šé»˜è®¤ä¸è®°å½•æ•æ„Ÿæ•°æ®
- **å¯è„±æ•**ï¼šTraceEvent æ”¯æŒå­—æ®µè„±æ•ç­–ç•¥
- **å¯æ¸…ç†**ï¼šæ”¯æŒæ‰‹åŠ¨æ¸…ç©ºä¸è¿‡æœŸæ¸…ç†

### 25.2 åä½œåˆè§„

- **å®¡è®¡éœ€æ±‚**ï¼šæ”¯æŒæ—¥å¿—å¯¼å‡ºä¸å›æ”¾
- **è®¿é—®æ§åˆ¶**ï¼šåä½œå±‚ç”±ä¸Šå±‚åº”ç”¨è´Ÿè´£é‰´æƒ

### 25.3 å®‰å…¨è¾¹ç•Œ

- **ä¸æ‰§è¡Œè¿œç«¯ä»£ç **ï¼šåªåŒæ­¥æ•°æ®
- **æœ€å°æƒé™**ï¼šç”±åº”ç”¨å†³å®šåä½œå¯å†™èŒƒå›´

---

## äºŒåå…­ã€è·¨å¹³å°ä¸è¿è¡Œæ—¶å…¼å®¹æ€§

> å¯¼è¯»ï¼šè·¨å¹³å°è¿è¡Œç¯å¢ƒä¸æ”¯æŒèŒƒå›´ã€‚

- **æµè§ˆå™¨**ï¼šç°ä»£æµè§ˆå™¨ï¼Œé™çº§åˆ° `setTimeout` è°ƒåº¦
- **SSR**ï¼šNode.js ç¯å¢ƒéš”ç¦» store
- **ç§»åŠ¨ç«¯**ï¼šReact Native é€šè¿‡é€‚é…å±‚æ”¯æŒ

### 26.1 ä¸æ”¯æŒèŒƒå›´

- è€æ—§æµè§ˆå™¨æ—  Proxy/WeakMap æ”¯æŒ
- é JS è¿è¡Œæ—¶

---

## äºŒåä¸ƒã€ç”Ÿæ€ä¸ç¤¾åŒºè·¯çº¿å›¾

> å¯¼è¯»ï¼šç”Ÿæ€ä¸ç¤¾åŒºå‘å±•çš„æ–¹å‘ã€‚

### 27.1 ç”Ÿæ€æ‰©å±•æ–¹å‘

- **å®˜æ–¹é€‚é…å™¨**ï¼šReact/Vue/Svelte/Solid
- **æ•°æ®å±‚é€‚é…**ï¼šGraphQL/REST å®¢æˆ·ç«¯æ¡¥æ¥
- **çŠ¶æ€æœºå¯è§†åŒ–**ï¼šå¯ç¼–è¾‘çš„çŠ¶æ€å›¾å·¥å…·

### 27.2 ç¤¾åŒºå‚ä¸

- **RFC æµç¨‹**ï¼šé‡å¤§å˜æ›´èµ° RFC
- **æ’ä»¶æœºåˆ¶**ï¼šç¤¾åŒºå¯æ‰©å±• DevTools ä¸é€‚é…å±‚

---

## äºŒåå…«ã€å­¦ä¹ è·¯å¾„ä¸åŸ¹è®­ææ–™

> å¯¼è¯»ï¼šå­¦ä¹ è·¯å¾„ä¸åŸ¹è®­ç´ ææ–¹å‘ã€‚

- **å…¥é—¨**ï¼š1 å°æ—¶ä¸Šæ‰‹æ•™ç¨‹
- **è¿›é˜¶**ï¼šçŠ¶æ€æœºä¸åä½œä¸“é¢˜
- **æ¶æ„**ï¼šå¤§å‹é¡¹ç›®çš„åˆ†åŸŸæ²»ç†æ¡ˆä¾‹

---

## äºŒåä¹ã€å¥‡ç‚¹é¡¹ç›® Todo List (æˆ‘çš„æ‰§è¡Œè®¡åˆ’)

> å¯¼è¯»ï¼šæ‰§è¡Œè®¡åˆ’ä¸é˜¶æ®µåˆ’åˆ†ã€‚

### 29.1 è§„æ ¼æ”¶æ•›

- **æ•´ç† API**ï¼šè¡¥å…¨ `atomAsync/atomSync/machine` çš„ç­¾åä¸è¯­ä¹‰è¾¹ç•Œ
- **è¡¥è¶³è¾¹ç•Œ**ï¼šå¾ªç¯ä¾èµ–ã€å¼‚å¸¸æ¢å¤ã€åµŒå¥— batch çš„æ˜ç¡®è§„åˆ™
- **å†»ç»“èŒƒå›´**ï¼šä¸º M0/M1 è®¾å®šä¸å¯å˜æ›´çš„æœ€å°èŒƒå›´

### 29.2 æ ¸å¿ƒåŸå‹

- **å®ç°æ ¸å¿ƒ**ï¼š`atom/computed/batch/effect` + è®¢é˜…ç³»ç»Ÿ
- **å¯è§‚æµ‹æ€§**ï¼šTraceEvent é‡‡é›†ä¸å¿«ç…§å¯¼å‡º
- **å¼‚æ­¥å±‚**ï¼š`atomAsync` ç¼“å­˜/å–æ¶ˆ/å»é‡
- **çŠ¶æ€æœº**ï¼š`machine` æœ€å°å®ç° + ä¸ atom ç»‘å®š

### 29.3 é€‚é…ä¸éªŒè¯

- **React é€‚é…å™¨**ï¼š`useAtom/useAtomValue/useSetAtom`
- **Vue é€‚é…å™¨**ï¼š`useAtomRef`
- **Demo**ï¼šM0/M1 çœŸå®åœºæ™¯ç¤ºä¾‹ + éªŒæ”¶è„šæœ¬
- **åŸºå‡†**ï¼šè·‘é€šæœ€å° benchmarkï¼Œè®°å½•å‡å€¼ä¸ P95

### 29.4 åä½œä¸æ‰©å±•

- **åä½œåŸå‹**ï¼š`atomSync` + CRDT åˆå¹¶ PoC
- **DevTools**ï¼šæ—¶é—´çº¿é¢æ¿åŸå‹
- **æ–‡æ¡£**ï¼šAPI å‚è€ƒã€è°ƒè¯•ä¸æ€§èƒ½æŒ‡å—

---

## ä¸‰åã€å·¥ç¨‹çº§æ–‡æ¡£éª¨æ¶

> å¯¼è¯»ï¼šé¢å‘çœŸå®ç”¨æˆ·ä¸è½åœ°å·¥ç¨‹çš„æ–‡æ¡£ç»“æ„ã€‚

### 30.1 å¿«é€Ÿä¸Šæ‰‹

- **å®‰è£…**ï¼šåŒ…ç»“æ„ä¸æœ€å°ä¾èµ–è¯´æ˜
- **Hello World**ï¼šatom/computed/batch æœ€å°ç¤ºä¾‹
- **5 åˆ†é’Ÿ Demo**ï¼šè®¡æ•°å™¨ + æ´¾ç”Ÿ + batch
- **é”™è¯¯æ¼”ç¤º**ï¼šå¸¸è§è¯¯ç”¨ä¸ä¿®æ­£

**å®‰è£… (ç¤ºä¾‹)**ï¼š

```bash
npm i @singularity/core @singularity/react
```

**Hello World**ï¼š

```typescript
import { atom, computed, effect } from '@singularity/core';

const count = atom(0);
const double = computed(() => count.get() * 2);

effect(() => {
  console.log('double', double.get());
});

count.set(1);
```

**5 åˆ†é’Ÿ Demo (React)**ï¼š

```tsx
import { atom, computed, batch } from '@singularity/core';
import { useAtom } from '@singularity/react';

const count = atom(0);
const double = computed(() => count.get() * 2);

export function Counter() {
  const value = useAtom(count);
  const doubled = useAtom(double);

  return (
    <div>
      <button
        onClick={() => {
          batch(() => {
            count.set((n) => n + 1);
            count.set((n) => n + 1);
          });
        }}
      >
        +2
      </button>
      <div>count: {value}</div>
      <div>double: {doubled}</div>
    </div>
  );
}
```

**é”™è¯¯æ¼”ç¤º**ï¼š

```typescript
// Bad: computed ä¸­æ‰§è¡Œ set ä¼šå¯¼è‡´å¾ªç¯
const bad = computed(() => {
  count.set(1);
  return count.get();
});
```

```text
å»ºè®®: computed ä¸­åªè¯»ï¼Œä¸æ‰§è¡Œå†™å…¥æ“ä½œã€‚
```

### 30.2 å…¥é—¨æ•™ç¨‹ (Hands-on)

- **ç¬¬ 1 ç« **ï¼šçŠ¶æ€åŸè¯­ä¸è®¢é˜…
- **ç¬¬ 2 ç« **ï¼šcomputed ä¸ä¾èµ–å›¾
- **ç¬¬ 3 ç« **ï¼šbatch ä¸æ¸²æŸ“åˆå¹¶
- **ç¬¬ 4 ç« **ï¼šeffect ä¸æ¸…ç†

**ç¬¬ 1 ç« ï¼šçŠ¶æ€åŸè¯­ä¸è®¢é˜…**  
ç›®æ ‡ï¼šç†è§£ atom ä¸ subscribe çš„æœ€å°ä½¿ç”¨æ–¹å¼ã€‚

```typescript
const a = atom(0);
const unsub = a.subscribe(() => console.log(a.get()));
a.set(1);
unsub();
```

**ç¬¬ 2 ç« ï¼šcomputed ä¸ä¾èµ–å›¾**  
ç›®æ ‡ï¼šç†è§£æ´¾ç”Ÿå€¼ä¸ä¾èµ–è¿½è¸ªã€‚

```typescript
const price = atom(100);
const tax = atom(0.1);
const total = computed(() => price.get() * (1 + tax.get()));
```

**ç¬¬ 3 ç« ï¼šbatch ä¸æ¸²æŸ“åˆå¹¶**  
ç›®æ ‡ï¼šç†è§£æ‰¹å¤„ç†å¦‚ä½•åˆå¹¶é€šçŸ¥ã€‚

```typescript
batch(() => {
  price.set(120);
  tax.set(0.2);
});
```

**ç¬¬ 4 ç« ï¼šeffect ä¸æ¸…ç†**  
ç›®æ ‡ï¼šç†è§£ effect ç”Ÿå‘½å‘¨æœŸã€‚

```typescript
const e = effect(() => {
  console.log('total', total.get());
});
e.dispose();
```

### 30.3 API å‚è€ƒ

- **Core**ï¼š`atom/computed/batch/effect`
- **Async**ï¼š`atomAsync` é€‰é¡¹ä¸ç¼“å­˜è¯­ä¹‰
- **Machine**ï¼š`machine` é…ç½®ä¸äº‹ä»¶è¯­ä¹‰
- **Sync**ï¼š`atomSync` åä½œè¿æ¥ä¸çŠ¶æ€
- **Store**ï¼š`createStore/snapshot` ä¸ SSR çº¦æŸ
- **Adapters**ï¼šReact/Vue Hooks ä¸è®¢é˜…è¯­ä¹‰

### 30.4 API å‚è€ƒæ¨¡æ¿

```
å‡½æ•°åï¼š
ç­¾åï¼š
å‚æ•°ï¼š
è¿”å›ï¼š
é”™è¯¯ï¼š
ç¤ºä¾‹ï¼š
æ³¨æ„äº‹é¡¹ï¼š
```

### 30.5 æ ¸å¿ƒæ¦‚å¿µ

- State Node ä¸ä¾èµ–å›¾
- ä¸€è‡´æ€§è¯­ä¹‰ä¸è°ƒåº¦è§„åˆ™
- å¯è§‚æµ‹åè®®ä¸æ—¶é—´çº¿

**State Node**  
State Node æ˜¯å¥‡ç‚¹çš„ç»Ÿä¸€æŠ½è±¡ï¼ŒåŒ…å« atom/computed/async/sync å››ç±»èŠ‚ç‚¹ã€‚  
åŸåˆ™ï¼šå¯è®¢é˜…ã€å¯ç»„åˆã€å¯è§‚å¯Ÿã€‚

**ä¸€è‡´æ€§è¯­ä¹‰**  
åŒä¸€æ‰¹æ¬¡è¯»å–çš„æ˜¯æ‰¹æ¬¡å¼€å§‹æ—¶çš„å¿«ç…§ï¼›å†™å…¥åœ¨æ‰¹æ¬¡ç»“æŸæ—¶ç»Ÿä¸€é€šçŸ¥ã€‚

**å¯è§‚æµ‹åè®®**  
æ‰€æœ‰è¯»å†™ä¸å¼‚æ­¥äº‹ä»¶è¿›å…¥ TraceEvent æµï¼Œå¯è¢« DevTools è§£æã€‚

### 30.6 å®è·µæŒ‡å—

- å°å‹é¡¹ç›®æœ€ä½³å®è·µ
- è¶…å¤§å‹é¡¹ç›®åˆ†åŸŸæ²»ç†
- å¼‚æ­¥ä¸åä½œåœºæ™¯æ¨¡å¼

**å°å‹é¡¹ç›®**  
åªä½¿ç”¨ atom/computed/batchï¼Œé¿å…å¼•å…¥çŠ¶æ€æœºä¸åä½œå±‚ã€‚

**è¶…å¤§å‹é¡¹ç›®**  
æŒ‰åŸŸæ‹†åˆ† Storeï¼Œé‡‡ç”¨ç»Ÿä¸€å‘½åè§„èŒƒä¸å®¡è®¡æ—¶é—´çº¿ã€‚

**å¼‚æ­¥ä¸åä½œ**  
async ä¸ sync åªåœ¨éœ€è¦æ—¶å¼•å…¥ï¼Œé¿å…è¿‡æ—©å¤æ‚åŒ–ã€‚

### 30.7 æ€§èƒ½ä¸è°ƒè¯•

- Benchmark å£å¾„ä¸ç»“æœæ¨¡æ¿
- DevTools ä½¿ç”¨ä¸æ’é”™
- æ€§èƒ½é€€åŒ–å®šä½æ¸…å•

**Benchmark æ¨¡æ¿**  
è®°å½•è®¾å¤‡ã€æµè§ˆå™¨ã€æ“ä½œæ¬¡æ•°ã€å‡å€¼ä¸ P95ã€‚

**æ’é”™æ¸…å•**  
1) æ˜¯å¦æœ‰ computed ä¸­çš„å†™å…¥  
2) æ˜¯å¦å­˜åœ¨è¿‡åº¦è®¢é˜…  
3) æ˜¯å¦å­˜åœ¨æœªé‡Šæ”¾çš„ effect

### 30.8 è¿ç§»ä¸é›†æˆ

- ä¸ Redux/Zustand/Jotai å…±å­˜
- GraphQL/REST æ•°æ®å±‚åä½œ
- æ—§ç³»ç»Ÿåªè¯»æ¡¥æ¥ç¤ºä¾‹

**åªè¯»æ¡¥æ¥ç¤ºä¾‹**ï¼š

```typescript
const legacy = fromStore(getState, subscribe);
const total = computed(() => legacy.get().total);
```

### 30.9 æ•…éšœæ’æŸ¥ä¸ FAQ

- å¸¸è§è¯¯ç”¨ä¸ä¿®å¤
- æ€§èƒ½é€€åŒ–ä¸å®šä½æµç¨‹
- è¯Šæ–­æ¸…å•ä¸è‡ªæŸ¥æ­¥éª¤

**å¸¸è§é—®é¢˜**  
Q: ä¸ºä»€ä¹ˆ computed ä¸æ›´æ–°ï¼Ÿ  
A: ç¡®è®¤ computed å†…éƒ¨è¯»å–äº† atom çš„ getã€‚

Q: ä¸ºä»€ä¹ˆæ‰¹å¤„ç†æ²¡ç”Ÿæ•ˆï¼Ÿ  
A: ç¡®è®¤æ›´æ–°å‘ç”Ÿåœ¨ batch å†…éƒ¨ã€‚

---

## ä¸‰åä¸€ã€å‚è€ƒèµ„æº

> å¯¼è¯»ï¼šå‚è€ƒèµ„æ–™å…¥å£ã€‚

### ç°æœ‰åº“æ·±åº¦ç ”ç©¶

- [Zustand](https://github.com/pmndrs/zustand) - æç®€ Flux
- [Jotai](https://github.com/pmndrs/jotai) - åŸå­åŒ–çŠ¶æ€
- [XState](https://github.com/statelyai/xstate) - çŠ¶æ€æœº
- [Yjs](https://github.com/yjs/yjs) - CRDT åä½œ
- [Legend-State](https://github.com/LegendApp/legend-state) - Signal æ€§èƒ½

### å­¦æœ¯è®ºæ–‡

- [Statecharts: A Visual Formalism for Complex Systems (1987)](https://www.wisdom.weizmann.ac.il/~harel/papers/Statecharts.History.pdf)
- [CRDTs: Consistency without Consensus](https://crdt.tech/)

### ç›¸å…³è®¨è®º

- [The Evolution of State Management](https://leerob.io/blog/react-state-management)
- [Signals: Fine-grained Reactivity](https://dev.to/ryansolid/a-hands-on-introduction-to-fine-grained-reactivity-3ndf)

---

_æ–‡æ¡£åˆ›å»ºäº 2026-01-06ï¼ŒæŒç»­æ›´æ–°ä¸­..._
