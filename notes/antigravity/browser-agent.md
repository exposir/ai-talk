<!--
- [INPUT]: 依赖 notes/antigravity/CLAUDE.md 的模块定位与索引
- [OUTPUT]: 输出 浏览器子代理 文档
- [POS]: 位于 notes/antigravity 模块的 浏览器子代理 笔记
- [PROTOCOL]: 变更时更新此头部，然后检查 CLAUDE.md
-->

# 浏览器子代理

Antigravity 内置浏览器，并配有专门的 Browser Subagent 用于网页交互。

---

## 核心能力

Browser Subagent 可以自动化执行：

| 操作 | 说明               |
| ---- | ------------------ |
| 导航 | 打开 URL、前进后退 |
| 点击 | 按钮、链接、元素   |
| 输入 | 表单填写、文本输入 |
| 滚动 | 页面滚动、元素滚动 |
| 读取 | DOM 内容、页面文本 |
| 截图 | 捕获页面状态       |
| 录屏 | 记录操作过程       |

---

## 使用场景

### 1. 自动化测试

```
使用浏览器测试登录功能：
1. 打开 http://localhost:3000/login
2. 输入测试账号
3. 点击登录按钮
4. 验证跳转到首页
5. 截图保存结果
```

### 2. 视觉验证

```
打开应用，检查响应式布局：
- 桌面端 (1920x1080)
- 平板端 (768x1024)
- 手机端 (375x667)
每个分辨率截图保存
```

### 3. 调试辅助

```
应用报错了，帮我：
1. 打开 http://localhost:3000
2. 打开开发者工具
3. 重现问题操作
4. 截取控制台错误
```

### 4. 网页研究

```
访问 https://tailwindcss.com/docs
总结 Grid 布局的使用方法
```

---

## 工作原理

### DOM 模式

通过读取 DOM 结构理解页面：

```
分析当前页面结构，找到登录表单
```

适合：

- 结构化内容
- 表单交互
- 元素定位

### 截图模式

通过视觉识别理解页面：

```
看这个页面截图，告诉我布局问题
```

适合：

- 视觉验证
- 样式检查
- 非结构化内容

---

## 操作示例

### 基础导航

```
打开浏览器访问 https://example.com
```

### 表单填写

```
在登录页面：
- 邮箱输入框填写 test@example.com
- 密码输入框填写 password123
- 点击"登录"按钮
```

### 元素交互

```
找到页面中的"添加购物车"按钮并点击
等待购物车数量更新
截图保存
```

### 复杂流程

```
完成以下用户注册流程测试：
1. 访问 /register
2. 填写所有必填字段
3. 上传头像
4. 同意服务条款
5. 提交表单
6. 验证成功页面
7. 录制整个过程
```

---

## 浏览器控制

### 窗口管理

```
调整浏览器窗口大小为 1280x720
```

### 多标签页

```
新建标签页打开 API 文档
在原标签页继续开发
```

### 开发者工具

```
打开浏览器开发者工具
切换到 Network 标签
监控 API 请求
```

---

## 安全设置

### 限制访问域名

```json
{
  "browser": {
    "allowedDomains": ["localhost", "*.example.com"],
    "blockedDomains": ["*.bank.com", "*.payment.com"]
  }
}
```

### 禁用自动填充

敏感信息不会被自动填充：

```json
{
  "browser": {
    "autoFill": {
      "passwords": false,
      "creditCards": false
    }
  }
}
```

---

## 与其他工具集成

### Playwright 对比

| 特性         | Browser Subagent | Playwright |
| ------------ | ---------------- | ---------- |
| 自然语言指令 | ✅               | ❌         |
| 视觉理解     | ✅               | ❌         |
| 代码生成     | ✅               | ✅         |
| CI/CD        | ❌               | ✅         |
| 复杂测试     | 基础             | 高级       |

### 最佳组合

1. **开发阶段**：用 Browser Subagent 快速测试
2. **自动化阶段**：让 Agent 生成 Playwright 测试代码
3. **CI/CD 阶段**：运行 Playwright 测试

---

## 录屏功能

### 自动录制

所有浏览器操作自动录制为 WebP 视频。

### 录屏命名

```
RecordingName: login_flow_demo
```

### 嵌入文档

```markdown
![登录流程演示](./recordings/login_flow_demo.webp)
```

---

## 常见问题

### Q: 浏览器操作很慢？

A: Browser Subagent 需要理解页面，比脚本慢是正常的。复杂测试建议生成代码。

### Q: 无法识别元素？

A: 尝试使用更具体的描述，或切换到截图模式。

### Q: 动态内容如何处理？

A: 指定等待条件：

```
点击提交后，等待"成功"提示出现
```
